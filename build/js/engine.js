function e(){}function t(e){return e()}function n(){return Object.create(null)}function r(e){e.forEach(t)}function a(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(t,...n){if(null==t){for(const e of n)e(void 0);return e}const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function s(e){let t;return i(e,(e=>t=e))(),t}function c(e,t,n){e.$$.on_destroy.push(i(t,n))}function u(e,t,n,r){if(e){const a=l(e,t,n,r);return e[0](a)}}function l(e,t,n,r){return e[1]&&r?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](r(t))):n.ctx}function f(e,t,n,r){if(e[2]&&r){const a=e[2](r(n));if(void 0===t.dirty)return a;if("object"==typeof a){const e=[],n=Math.max(t.dirty.length,a.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|a[r];return e}return t.dirty|a}return t.dirty}function m(e,t,n,r,a,o){if(a){const i=l(t,n,r,o);e.p(i,a)}}function p(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function d(e){return null==e?"":e}function g(e,t,n){return e.set(n),t}function h(e,t){e.appendChild(t)}function v(e,t,n){const r=function(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;if(t&&t.host)return t;return e.ownerDocument}(e);if(!r.getElementById(t)){const e=A("style");e.id=t,e.textContent=n,function(e,t){h(e.head||e,t),t.sheet}(r,e)}}function b(e,t,n){e.insertBefore(t,n||null)}function M(e){e.parentNode&&e.parentNode.removeChild(e)}function x(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function A(e){return document.createElement(e)}function y(e){return document.createTextNode(e)}function E(){return y(" ")}function R(){return y("")}function L(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function F(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function P(e,t){t=""+t,e.data!==t&&(e.data=t)}function w(e,t,n){e.classList.toggle(t,!!n)}let _;function T(e){_=e}function S(){if(!_)throw new Error("Function called outside component initialization");return _}function B(e){S().$$.on_mount.push(e)}function C(){const e=S();return(t,n,{cancelable:r=!1}={})=>{const a=e.$$.callbacks[t];if(a){const o=function(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}(t,n,{cancelable:r});return a.slice().forEach((t=>{t.call(e,o)})),!o.defaultPrevented}return!0}}const D=[],U=[];let $=[];const I=[],N=Promise.resolve();let O=!1;function V(e){$.push(e)}const k=new Set;let Y=0;function j(){if(0!==Y)return;const e=_;do{try{for(;Y<D.length;){const e=D[Y];Y++,T(e),z(e.$$)}}catch(e){throw D.length=0,Y=0,e}for(T(null),D.length=0,Y=0;U.length;)U.pop()();for(let e=0;e<$.length;e+=1){const t=$[e];k.has(t)||(k.add(t),t())}$.length=0}while(D.length);for(;I.length;)I.pop()();O=!1,k.clear(),T(e)}function z(e){if(null!==e.fragment){e.update(),r(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(V)}}const G=new Set;let H;function W(){H={r:0,c:[],p:H}}function q(){H.r||r(H.c),H=H.p}function X(e,t){e&&e.i&&(G.delete(e),e.i(t))}function K(e,t,n,r){if(e&&e.o){if(G.has(e))return;G.add(e),H.c.push((()=>{G.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}function J(e){return void 0!==e?.length?e:Array.from(e)}function Q(e){e&&e.c()}function Z(e,n,o){const{fragment:i,after_update:s}=e.$$;i&&i.m(n,o),V((()=>{const n=e.$$.on_mount.map(t).filter(a);e.$$.on_destroy?e.$$.on_destroy.push(...n):r(n),e.$$.on_mount=[]})),s.forEach(V)}function ee(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];$.forEach((r=>-1===e.indexOf(r)?t.push(r):n.push(r))),n.forEach((e=>e())),$=t}(n.after_update),r(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function te(e,t){-1===e.$$.dirty[0]&&(D.push(e),O||(O=!0,N.then(j)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function ne(t,a,o,i,s,c,u=null,l=[-1]){const f=_;T(t);const m=t.$$={fragment:null,ctx:[],props:c,update:e,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a.context||(f?f.$$.context:[])),callbacks:n(),dirty:l,skip_bound:!1,root:a.target||f.$$.root};u&&u(m.root);let p=!1;if(m.ctx=o?o(t,a.props||{},((e,n,...r)=>{const a=r.length?r[0]:n;return m.ctx&&s(m.ctx[e],m.ctx[e]=a)&&(!m.skip_bound&&m.bound[e]&&m.bound[e](a),p&&te(t,e)),n})):[],m.update(),p=!0,r(m.before_update),m.fragment=!!i&&i(m.ctx),a.target){if(a.hydrate){const e=function(e){return Array.from(e.childNodes)}(a.target);m.fragment&&m.fragment.l(e),e.forEach(M)}else m.fragment&&m.fragment.c();a.intro&&X(t.$$.fragment),Z(t,a.target,a.anchor),j()}T(f)}class re{$$=void 0;$$set=void 0;$destroy(){ee(this,1),this.$destroy=e}$on(t,n){if(!a(n))return e;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const e=r.indexOf(n);-1!==e&&r.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");const ae=[];function oe(t,n=e){let r;const a=new Set;function i(e){if(o(t,e)&&(t=e,r)){const e=!ae.length;for(const e of a)e[1](),ae.push(e,t);if(e){for(let e=0;e<ae.length;e+=2)ae[e][0](ae[e+1]);ae.length=0}}}function s(e){i(e(t))}return{set:i,update:s,subscribe:function(o,c=e){const u=[o,c];return a.add(u),1===a.size&&(r=n(i,s)||e),o(t),()=>{a.delete(u),0===a.size&&r&&(r(),r=null)}}}}function ie(t,n,o){const s=!Array.isArray(t),c=s?[t]:t;if(!c.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const u=n.length<2;return l=(t,o)=>{let l=!1;const f=[];let m=0,p=e;const d=()=>{if(m)return;p();const r=n(s?f[0]:f,t,o);u?t(r):p=a(r)?r:e},g=c.map(((e,t)=>i(e,(e=>{f[t]=e,m&=~(1<<t),l&&d()}),(()=>{m|=1<<t}))));return l=!0,d(),function(){r(g),p(),l=!1}},{subscribe:oe(o,l).subscribe};var l}const se=function(){const e=oe([]),t=oe(0),{subscribe:n,update:r}=e;function a(e){try{r((n=>{const r=e(n);return t.update((e=>e+1)),r}))}catch(e){console.log(e)}}return{subscribe:n,set:function(e){a((t=>e))},update:a,get revision(){return s(t)}}}();var ce=1e-6,ue="undefined"!=typeof Float32Array?Float32Array:Array;function le(){var e=new ue(16);return ue!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function fe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function me(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pe(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],c=t[6],u=t[7],l=t[8],f=t[9],m=t[10],p=t[11],d=t[12],g=t[13],h=t[14],v=t[15],b=n*s-r*i,M=n*c-a*i,x=n*u-o*i,A=r*c-a*s,y=r*u-o*s,E=a*u-o*c,R=l*g-f*d,L=l*h-m*d,F=l*v-p*d,P=f*h-m*g,w=f*v-p*g,_=m*v-p*h,T=b*_-M*w+x*P+A*F-y*L+E*R;return T?(T=1/T,e[0]=(s*_-c*w+u*P)*T,e[1]=(a*w-r*_-o*P)*T,e[2]=(g*E-h*y+v*A)*T,e[3]=(m*y-f*E-p*A)*T,e[4]=(c*F-i*_-u*L)*T,e[5]=(n*_-a*F+o*L)*T,e[6]=(h*x-d*E-v*M)*T,e[7]=(l*E-m*x+p*M)*T,e[8]=(i*w-s*F+u*R)*T,e[9]=(r*F-n*w-o*R)*T,e[10]=(d*y-g*x+v*b)*T,e[11]=(f*x-l*y-p*b)*T,e[12]=(s*L-i*P-c*R)*T,e[13]=(n*P-r*L+a*R)*T,e[14]=(g*M-d*A-h*b)*T,e[15]=(l*A-f*M+m*b)*T,e):null}function de(e){var t=e[0],n=e[1],r=e[2],a=e[3],o=e[4],i=e[5],s=e[6],c=e[7],u=e[8],l=e[9],f=e[10],m=e[11],p=e[12],d=e[13],g=e[14],h=e[15];return(t*i-n*o)*(f*h-m*g)-(t*s-r*o)*(l*h-m*d)+(t*c-a*o)*(l*g-f*d)+(n*s-r*i)*(u*h-m*p)-(n*c-a*i)*(u*g-f*p)+(r*c-a*s)*(u*d-l*p)}function ge(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],c=t[5],u=t[6],l=t[7],f=t[8],m=t[9],p=t[10],d=t[11],g=t[12],h=t[13],v=t[14],b=t[15],M=n[0],x=n[1],A=n[2],y=n[3];return e[0]=M*r+x*s+A*f+y*g,e[1]=M*a+x*c+A*m+y*h,e[2]=M*o+x*u+A*p+y*v,e[3]=M*i+x*l+A*d+y*b,M=n[4],x=n[5],A=n[6],y=n[7],e[4]=M*r+x*s+A*f+y*g,e[5]=M*a+x*c+A*m+y*h,e[6]=M*o+x*u+A*p+y*v,e[7]=M*i+x*l+A*d+y*b,M=n[8],x=n[9],A=n[10],y=n[11],e[8]=M*r+x*s+A*f+y*g,e[9]=M*a+x*c+A*m+y*h,e[10]=M*o+x*u+A*p+y*v,e[11]=M*i+x*l+A*d+y*b,M=n[12],x=n[13],A=n[14],y=n[15],e[12]=M*r+x*s+A*f+y*g,e[13]=M*a+x*c+A*m+y*h,e[14]=M*o+x*u+A*p+y*v,e[15]=M*i+x*l+A*d+y*b,e}function he(e,t,n){var r,a,o,i,s,c,u,l,f,m,p,d,g=n[0],h=n[1],v=n[2];return t===e?(e[12]=t[0]*g+t[4]*h+t[8]*v+t[12],e[13]=t[1]*g+t[5]*h+t[9]*v+t[13],e[14]=t[2]*g+t[6]*h+t[10]*v+t[14],e[15]=t[3]*g+t[7]*h+t[11]*v+t[15]):(r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],c=t[5],u=t[6],l=t[7],f=t[8],m=t[9],p=t[10],d=t[11],e[0]=r,e[1]=a,e[2]=o,e[3]=i,e[4]=s,e[5]=c,e[6]=u,e[7]=l,e[8]=f,e[9]=m,e[10]=p,e[11]=d,e[12]=r*g+s*h+f*v+t[12],e[13]=a*g+c*h+m*v+t[13],e[14]=o*g+u*h+p*v+t[14],e[15]=i*g+l*h+d*v+t[15]),e}function ve(e,t,n){var r=n[0],a=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function be(e,t,n){var r=Math.sin(n),a=Math.cos(n),o=t[4],i=t[5],s=t[6],c=t[7],u=t[8],l=t[9],f=t[10],m=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*a+u*r,e[5]=i*a+l*r,e[6]=s*a+f*r,e[7]=c*a+m*r,e[8]=u*a-o*r,e[9]=l*a-i*r,e[10]=f*a-s*r,e[11]=m*a-c*r,e}function Me(e,t,n){var r=Math.sin(n),a=Math.cos(n),o=t[0],i=t[1],s=t[2],c=t[3],u=t[8],l=t[9],f=t[10],m=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a-u*r,e[1]=i*a-l*r,e[2]=s*a-f*r,e[3]=c*a-m*r,e[8]=o*r+u*a,e[9]=i*r+l*a,e[10]=s*r+f*a,e[11]=c*r+m*a,e}function xe(e,t,n){var r=Math.sin(n),a=Math.cos(n),o=t[0],i=t[1],s=t[2],c=t[3],u=t[4],l=t[5],f=t[6],m=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a+u*r,e[1]=i*a+l*r,e[2]=s*a+f*r,e[3]=c*a+m*r,e[4]=u*a-o*r,e[5]=l*a-i*r,e[6]=f*a-s*r,e[7]=m*a-c*r,e}function Ae(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function ye(e,t,n,r){var a=t[0],o=t[1],i=t[2],s=t[3],c=a+a,u=o+o,l=i+i,f=a*c,m=a*u,p=a*l,d=o*u,g=o*l,h=i*l,v=s*c,b=s*u,M=s*l,x=r[0],A=r[1],y=r[2];return e[0]=(1-(d+h))*x,e[1]=(m+M)*x,e[2]=(p-b)*x,e[3]=0,e[4]=(m-M)*A,e[5]=(1-(f+h))*A,e[6]=(g+v)*A,e[7]=0,e[8]=(p+b)*y,e[9]=(g-v)*y,e[10]=(1-(f+d))*y,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Ee,Re=function(e,t,n,r,a){var o,i=1/Math.tan(t/2);return e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(o=1/(r-a),e[10]=(a+r)*o,e[14]=2*a*r*o):(e[10]=-1,e[14]=-2*r),e};function Le(e,t,n,r,a,o,i){var s=1/(t-n),c=1/(r-a),u=1/(o-i);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*s,e[13]=(a+r)*c,e[14]=(i+o)*u,e[15]=1,e}function Fe(e,t,n,r){var a,o,i,s,c,u,l,f,m,p,d=t[0],g=t[1],h=t[2],v=r[0],b=r[1],M=r[2],x=n[0],A=n[1],y=n[2];return Math.abs(d-x)<ce&&Math.abs(g-A)<ce&&Math.abs(h-y)<ce?me(e):(l=d-x,f=g-A,m=h-y,a=b*(m*=p=1/Math.hypot(l,f,m))-M*(f*=p),o=M*(l*=p)-v*m,i=v*f-b*l,(p=Math.hypot(a,o,i))?(a*=p=1/p,o*=p,i*=p):(a=0,o=0,i=0),s=f*i-m*o,c=m*a-l*i,u=l*o-f*a,(p=Math.hypot(s,c,u))?(s*=p=1/p,c*=p,u*=p):(s=0,c=0,u=0),e[0]=a,e[1]=s,e[2]=l,e[3]=0,e[4]=o,e[5]=c,e[6]=f,e[7]=0,e[8]=i,e[9]=u,e[10]=m,e[11]=0,e[12]=-(a*d+o*g+i*h),e[13]=-(s*d+c*g+u*h),e[14]=-(l*d+f*g+m*h),e[15]=1,e)}function Pe(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function we(e,t){var n=t[0],r=t[1],a=t[2],o=n*n+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function _e(e,t,n){var r=t[0],a=t[1],o=t[2],i=n[0],s=n[1],c=n[2];return e[0]=a*c-o*s,e[1]=o*i-r*c,e[2]=r*s-a*i,e}function Te(e,t,n,r){var a=t[0],o=t[1],i=t[2];return e[0]=a+r*(n[0]-a),e[1]=o+r*(n[1]-o),e[2]=i+r*(n[2]-i),e}function Se(e,t,n){var r=t[0],a=t[1],o=t[2],i=n[3]*r+n[7]*a+n[11]*o+n[15];return i=i||1,e[0]=(n[0]*r+n[4]*a+n[8]*o+n[12])/i,e[1]=(n[1]*r+n[5]*a+n[9]*o+n[13])/i,e[2]=(n[2]*r+n[6]*a+n[10]*o+n[14])/i,e}function Be(){return new Array(3).fill(0)}function Ce(e,t){return e[0]*=t,e[1]*=t,e[2]*=t,e}function De(e){for(let t=0,n=e.length;t<n;t+=3){const n=e[t+0],r=e[t+1],a=e[t+2],o=1/Math.sqrt(n*n+r*r+a*a);e[t+0]*=o,e[t+1]*=o,e[t+2]*=o}}function Ue(e){const t=[];for(let n=0;n<e.length;n+=9){const r=Be(),a=Be(),o=Be();r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],a[0]=e[n+3],a[1]=e[n+4],a[2]=e[n+5],o[0]=e[n+6],o[1]=e[n+7],o[2]=e[n+8];const i=Be();Pe(i,o,a);const s=Be();Pe(s,r,a);const c=Be();_e(c,i,s),we(c,c),t.push(...c,...c,...c)}return t}Ee=new ue(3),ue!=Float32Array&&(Ee[0]=0,Ee[1]=0,Ee[2]=0);const $e=Math.PI/180;function Ie(e){return e*$e}function Ne(){return new Float32Array(16)}function Oe(e){return new Float32Array(e)}var Ve="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\n#define SHADER_NAME defaultVertex\r\n    \r\nin vec3 position;\r\nin vec3 normal;\r\nin vec2 uv;\r\n${instances ?\r\n`\r\nin mat4 modelMatrix;\r\nin mat4 modelViewMatrix;\r\nin mat3 normalMatrix;\r\n` : `\r\nuniform mat4 modelMatrix;\r\nuniform mat4 modelViewMatrix;\r\nuniform mat3 normalMatrix;\r\n`}\r\n\r\n\r\nuniform float time;\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\n\r\n// Pass the color attribute down to the fragment shader\r\nout vec3 vertexColor;\r\nout vec3 vNormal;\r\nout vec3 vertex;\r\nout vec3 vViewPosition;\r\nout highp vec2 vUv;\r\n\r\n${declarations}\r\n\r\nvoid main() {\r\n    vec3 objectNormal = vec3( normal );\r\n    vec3 transformedNormal = objectNormal;\r\n    vec3 animatedPosition = position;\r\n    ${positionModifier}\r\n\r\n    vUv = vec3( uv, 1 ).xy;\r\n    // Pass the color down to the fragment shader (debug)\r\n    vertexColor = vec3(1.27,1.27,1.27);\r\n    // Pass the vertex down to the fragment shader TODO, change to support modelViewMatrix\r\n    vertex = vec3(modelMatrix * vec4(animatedPosition, 1.0));\r\n\r\n    transformedNormal = normalMatrix * transformedNormal;\r\n    vNormal = normalize( transformedNormal );\r\n    //vNormal = normal;\r\n    vec3 transformed = vec3( animatedPosition );\r\n    vec4 mvPosition = vec4( transformed, 1.0 );\r\n    mvPosition = modelViewMatrix * mvPosition;\r\n    gl_Position = projectionMatrix * mvPosition;\r\n    vViewPosition = -mvPosition.xyz;\r\n}";const ke=(e,t)=>{const n=Function.constructor(...Object.entries(t).map((([e,t])=>(""===t&&(t='""'),`${e}${null!=t?`=${t}`:""}`))),`return \`${e}\``);return e=>n(...Object.keys(t).map((t=>null!=e[t]?e[t]:void 0)))};function Ye(e){return Array.isArray(e)?[...e]:"number"==typeof e?je(e):"string"==typeof e&&e.startsWith("#")?je(parseInt(e.replace("#","0x"))):e}function je(e){return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255]}function ze(e,t){return 3===t?e:e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Ge(e){return e.map((e=>Math.floor(255*e))).reduce(((e,t)=>e+t.toString(16).padStart(2,"0")),"#")}function He(e){return"#"+e.toString(16).padStart(6,"0")}function We(e){return parseInt(e.slice(1),16)}function qe(e){return[parseInt(e.slice(1,3),16)/255,parseInt(e.slice(3,5),16)/255,parseInt(e.slice(5,7),16)/255]}function Xe(e){Ke={...Ke,...e}}let Ke={programMap:new Map,vaoMap:new Map,bufferMap:new Map,gl:null,program:null,vao:null,canvas:null,backgroundColor:null,ambientLightColor:null,toneMappings:null,existingProgram:!1};const Je=Math.PI/180;const Qe=function(){const e=oe({position:[0,0,-1],target:[0,0,0],fov:80,near:.1,far:1e3,up:[0,1,0]}),{subscribe:t,update:n}=e,r=oe(0);function a(e){n((t=>{const n={...t,...e(t)};return r.update((e=>e+1)),function(e){const{canvas:t}=Ke;o=Fe(Ne(),e.position,e.target,e.up),i=Re(Ne(),(n=e.fov,n*Je),t.width/t.height,e.near,e.far);var n}(n),n}))}let o,i;return{subscribe:t,set:function(e){a((t=>e))},update:a,get revision(){return s(r)},get view(){return o},get projection(){return i}}}();function Ze(e){return"matrix"in e}function et(e){return"matrices"in e}const tt=0;function nt(){const e=Ke.canvas.getContext("webgl2");wt=e.getParameter(e.DEPTH_FUNC),Ke.gl=e,e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.frontFace(e.CCW),e.cullFace(e.BACK)}function rt(e=!0){return function(){const{gl:t}=Ke;t.frontFace(e?t.CCW:t.CW)}}function at(){const{gl:e}=Ke;e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)}function ot(){const{gl:e}=Ke;e.disable(e.BLEND)}function it(){const{gl:e,program:t}=Ke,n=e.getUniformLocation(t,"time");e.uniform1f(n,performance.now())}function st(e,t,n){return function(){const{gl:r}=Ke,a=e.attributes.positionsSize??3,o=e.attributes.elements?e.attributes.elements.length:e.attributes.positions.length/a,i=e.attributes.elements instanceof Uint32Array?r.UNSIGNED_INT:r.UNSIGNED_SHORT;t?e.attributes.elements?r.drawElementsInstanced(r[n],o,i,0,t):r.drawArraysInstanced(r[n],0,o,t):e.attributes.elements?r.drawElements(r[n],o,i,0):r.drawArrays(r[n],0,o),r.bindVertexArray(null)}}function ct(){const{gl:e,vao:t}=Ke;e.bindVertexArray(t)}function ut(e){return function(){const{gl:t}=Ke,n=t.createProgram();Ke.programMap.set(e,n),Ke.vaoMap.set(e,new Map),Ke.program=n}}function lt(){const{gl:e,program:t}=Ke;e.linkProgram(t),e.getProgramParameter(t,e.LINK_STATUS)||console.error("ERROR linking program!",e.getProgramInfoLog(t))}function ft(){const{gl:e,program:t}=Ke;e.validateProgram(t),e.getProgramParameter(t,e.VALIDATE_STATUS)||console.error("ERROR validating program!",e.getProgramInfoLog(t))}function mt(){const{gl:e,program:t}=Ke;e.useProgram(t)}function pt(){const{gl:e}=Ke;e.viewport(0,0,e.canvas.width,e.canvas.height)}function dt(){const{gl:e,backgroundColor:t}=Ke;e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height),e.scissor(0,0,e.canvas.width,e.canvas.height),Ke.frameBufferWidth=e.canvas.width,Ke.frameBufferHeight=e.canvas.height,e.clearColor(...t),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}function gt(e,t,n,r){return function(){const{gl:a,program:o}=Ke;let i="",s="",c="",u="";const[l]=t,f=l.animations?.filter((({type:e})=>"vertex"===e));f?.length>0&&(c+=f.reduce(((e,t)=>e+t.shader({declaration:!0})),""),u+=f.reduce(((e,t)=>e+t.shader({position:!0})),""),i+=c,s+=u);const m=ke(Ve,{instances:!1,declarations:"",positionModifier:""})({instances:l.instances>=1,declarations:i,positionModifier:s});let p="",d="",g="";e.specular&&(p=e.specular.shader({declaration:!0}),d=e.specular.shader({material:!0}),g=e.specular.shader({irradiance:!0}));let h="",v="";e.diffuseMap&&(h=e.diffuseMap.shader({declaration:!0,declarationNormal:!1,mapType:e.diffuseMap.type}),v=e.diffuseMap.shader({diffuseMapSample:!0,mapType:e.diffuseMap.type,coordinateSpace:e.diffuseMap.coordinateSpace}));let b="",M="";e.normalMap&&(b=e.normalMap.shader({declaration:!0,declarationNormal:!0,mapType:e.normalMap.type}),M=e.normalMap.shader({normalMapSample:!0,mapType:e.normalMap.type}));let x="",A="";e.roughnessMap&&(x=e.roughnessMap.shader({declaration:!0,declarationNormal:!1,mapType:e.roughnessMap.type}),A=e.roughnessMap.shader({roughnessMapSample:!0,mapType:e.roughnessMap.type}));let y="",E="";e.envMap&&(y=e.envMap.shader({declaration:!0,...e.envMap.shaderDefines}),E=e.envMap.shader({irradiance:!0}));var R;ht(a,o,m,ke("#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\nprecision highp sampler2D;\r\nprecision highp samplerCube;\r\n\r\n#define SHADER_NAME defaultFragment\r\n\r\n${defines}\r\n\r\n#define RECIPROCAL_PI 0.3183098861837907\r\n\r\nuniform vec3 diffuse;\r\nuniform float opacity;\r\nuniform float metalness;\r\nuniform vec3 ambientLightColor;\r\nuniform vec3 cameraPosition;\r\nuniform mat4 viewMatrix;\r\n//uniform mat3 normalMatrix;\r\n\r\nin vec3 vertex;\r\nin vec3 vNormal;\r\nin highp vec2 vUv;\r\nin vec3 vViewPosition;\r\n\r\nout vec4 fragColor;\r\n\r\nfloat pow4(const in float x) {\r\n    float x2 = x * x;\r\n    return x2 * x2;\r\n}\r\nfloat pow2(const in float x) {\r\n    return x * x;\r\n}\r\n\r\nfloat saturate(const in float a) {\r\n    return clamp(a, 0.0f, 1.0f);\r\n}\r\n\r\nstruct ReflectedLight {\r\n\tvec3 directDiffuse;\r\n\tvec3 directSpecular;\r\n\tvec3 indirectDiffuse;\r\n\tvec3 indirectSpecular;\r\n};\r\n\r\nstruct PhysicalMaterial {\r\n\tvec3 diffuseColor;\r\n\tfloat diffuseAlpha;\r\n\tfloat roughness;\r\n\tvec3 specularColor;\r\n\tfloat specularF90;\r\n\tfloat ior;\r\n};\r\n\r\nvec3 BRDF_Lambert(const in vec3 diffuseColor) {\r\n\treturn RECIPROCAL_PI * diffuseColor;\r\n}\r\n\r\n\r\n${declarations}\r\n\r\nvec4 sRGBTransferOETF(in vec4 value) {\r\n\treturn vec4(mix(pow(value.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), value.rgb * 12.92, vec3(lessThanEqual(value.rgb, vec3(0.0031308)))), value.a);\r\n}\r\n\r\nvec4 linearToOutputTexel(vec4 value) {\r\n\treturn (sRGBTransferOETF(value));\r\n}\r\n\r\nvoid main() {\r\n    PhysicalMaterial material;\r\n\tmaterial.diffuseAlpha = 1.0;\r\n\tmaterial.diffuseColor = diffuse.rgb * (1.0 - metalness);\r\n\t${roughnessMapSample}\r\n\t${material}\r\n\t${diffuseMapSample}\r\n\t\r\n\r\n\tvec3 normal = normalize( vNormal );\r\n\tvec3 geometryPosition = - vViewPosition;\r\n    vec3 geometryNormal = normal;\r\n    vec3 geometryViewDir = normalize( vViewPosition );\r\n\t${normalMapSample}\r\n\t\r\n\r\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\r\n\r\n    reflectedLight.indirectDiffuse += ambientLightColor * BRDF_Lambert(material.diffuseColor);\r\n\r\n    vec3 totalIrradiance = vec3(0.0f);\r\n    ${irradiance}\r\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse + reflectedLight.directDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;\r\n    fragColor = vec4(outgoingLight, opacity*material.diffuseAlpha);\r\n    //fragColor = vec4(totalIrradiance, 1.0f);\r\n    ${toneMapping}\r\n\tfragColor = linearToOutputTexel(fragColor);\r\n\t//fragColor = vec4(pointLights[0].position - geometryPosition,1.0);\r\n\t//fragColor = vec4(material.roughness,material.roughness,material.roughness,1.0);\r\n}",{defines:"",declarations:"",diffuseMapSample:"",normalMapSample:"",roughnessMapSample:"",material:"",irradiance:"",toneMapping:"",numPointLights:0})({defines:(R={...n?{NUM_POINT_LIGHTS:n}:void 0},["",...Object.entries(R).map((([e,t])=>`#define ${e} ${t}`))].join("\n")),declarations:[...n?[r({declaration:!0,irradiance:!1})]:[],...Ke.toneMappings?.length>0?[...Ke.toneMappings.map((e=>e.shader({declaration:!0,exposure:e.exposure})))]:[],...e.specular?[p]:[],...e.diffuseMap?[h]:[],...e.normalMap?[b]:[],...e.roughnessMap?[x]:[],...e.envMap?[y]:[]].join("\n"),diffuseMapSample:v,normalMapSample:M,roughnessMapSample:A,material:[...e.specular?[d]:[]].join("\n"),irradiance:[...n?[r({declaration:!1,irradiance:!0,specularIrradiance:g})]:[],...e.envMap?[E]:[]].join("\n"),toneMapping:[...Ke.toneMappings?.length>0?[...Ke.toneMappings.map((e=>e.shader({color:!0})))]:[]].join("\n"),numPointLights:n}))}}function ht(e,t,n,r){const a=e.createShader(e.VERTEX_SHADER);e.shaderSource(a,n),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)||console.error("ERROR compiling vertex shader!",e.getShaderInfoLog(a)),e.attachShader(t,a),e.deleteShader(a);const o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(o,r),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)||console.error("ERROR compiling fragment shader!",e.getShaderInfoLog(o)),e.attachShader(t,o),e.deleteShader(o)}function vt(e,t,n,r){return function(){const{gl:a}=Ke,o=a.createTexture();r(o),a.bindTexture(a.TEXTURE_2D,o),a.texStorage2D(a.TEXTURE_2D,1,a.RGBA8,e,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);const i=a.createFramebuffer();n(i),a.bindFramebuffer(a.FRAMEBUFFER,i),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,o,0),a.bindTexture(a.TEXTURE_2D,null),a.bindFramebuffer(a.FRAMEBUFFER,null)}}function bt(){const{gl:e}=Ke;e.bindTexture(e.TEXTURE_2D,null)}function Mt({diffuse:e,metalness:t,opacity:n}){return function(){const{gl:r,program:a}=Ke,o=r.getUniformLocation(a,"diffuse");if(null==o)return;r.uniform3fv(o,new Float32Array(e.map(ze))),null==t&&console.log("metalness is null, material won't display correctly");const i=r.getUniformLocation(a,"metalness");r.uniform1f(i,t);const s=r.getUniformLocation(a,"opacity");r.uniform1f(s,n??1)}}function xt(e,t){const{gl:n,program:r,ambientLightColor:a}=Ke,o=e??r,i=t??a,s=n.getUniformLocation(o,"ambientLightColor");n.uniform3fv(s,new Float32Array(i))}function At(e){return function(){const{gl:t,program:n}=Ke,{projection:r,view:a}=e,o=t.getUniformLocation(n,"projectionMatrix");t.uniformMatrix4fv(o,!1,r);const i=t.getUniformLocation(n,"cameraPosition");t.uniform3fv(i,s(e).position);const c=t.getUniformLocation(n,"viewMatrix");t.uniformMatrix4fv(c,!1,a);null!=t.getUniformLocation(n,"view")&&t.uniformMatrix4fv(c,!1,a)}}function yt(e,t,n){const r=e.getUniformLocation(t,"modelMatrix");null!=r&&e.uniformMatrix4fv(r,!1,n.value);const a=e.getUniformLocation(t,"modelViewMatrix");null!=a&&e.uniformMatrix4fv(a,!1,n.modelView)}function Et(e,t){return Ze(t)?function(){const{gl:e,program:n}=Ke;yt(e,n,t.matrix)}:function(){const{gl:n,program:r,vaoMap:a}=Ke,o=a.get(e).get(t);t.matrices.modelViewBuffer=Rt(n,r,o,"modelViewMatrix",t.matrices.modelView,4,t.matrices.modelViewBuffer),t.matrices.buffer=Rt(n,r,o,"modelMatrix",t.matrices.value,4,t.matrices.buffer)}}function Rt(e,t,n,r,a,o,i=null){e.bindVertexArray(n);const s=e.getAttribLocation(t,r);let c;if(null==i){c=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,c),e.bufferData(e.ARRAY_BUFFER,a.byteLength,e.DYNAMIC_DRAW);const t=4*o*o;for(let n=0;n<o;++n){const r=s+n;e.enableVertexAttribArray(r);const a=n*o*4;e.vertexAttribPointer(r,o,e.FLOAT,!1,t,a),e.vertexAttribDivisor(r,1)}}else c=i,e.bindBuffer(e.ARRAY_BUFFER,i);return e.bufferSubData(e.ARRAY_BUFFER,0,a),e.bindVertexArray(null),c}function Lt(e,t){return Ze(t)?function(){const{gl:e,program:n}=Ke,r=e.getUniformLocation(n,"normalMatrix");null!=r&&e.uniformMatrix3fv(r,!1,t.matrix.normalMatrix)}:function(){const{gl:n,program:r,vaoMap:a}=Ke;if(null==n.getAttribLocation(r,"normalMatrix"))return;const o=a.get(e).get(t);t.matrices.normalMatrixBuffer=Rt(n,r,o,"normalMatrix",t.matrices.normalMatrices,3,t.matrices.normalMatrixBuffer)}}function Ft(e){let t,n;e.data?(t=e.data,n=e.interleaved):t=e;return{data:t.buffer&&t.buffer instanceof ArrayBuffer?t:new Float32Array(t),interleaved:n,...n?{byteStride:e.byteStride,byteOffset:e.byteOffset}:{byteStride:0,byteOffset:0}}}function Pt(e,t){return function(){const{gl:n,program:r,vaoMap:a,bufferMap:o}=Ke,{positions:i,normals:s,elements:c,uvs:u,positionsSize:l}=t.attributes;let f,m;if(a.has(e)&&a.get(e).has(t))f=a.get(e).get(t);else{if(e.existingVAO&&e.existingVAO.get(t))return f=e.existingVAO.get(t),e.existingVAO.delete(t),a.get(e).set(t,f),void(Ke.vao=f);f=n.createVertexArray(),a.get(e).set(t,f)}Ke.vao=f,o.has(t)?m=o.get(t):(m=[],o.set(t,m)),n.bindVertexArray(f);const{data:p,interleaved:d,byteStride:g,byteOffset:h}=Ft(i),v=n.createBuffer();m.push(v),n.bindBuffer(n.ARRAY_BUFFER,v),n.bufferData(n.ARRAY_BUFFER,p,n.STATIC_DRAW);const b=n.getAttribLocation(r,"position");n.bindBuffer(n.ARRAY_BUFFER,v);const M=null!=l?l:3;if(n.vertexAttribPointer(b,M,n.FLOAT,!1,g,h),n.enableVertexAttribArray(b),t.attributes.normals){const{data:e,interleaved:t,byteStride:a,byteOffset:o}=Ft(s);if(!t){const t=n.createBuffer();m.push(t),n.bindBuffer(n.ARRAY_BUFFER,t),n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,t)}const i=n.getAttribLocation(r,"normal");-1!=i&&(n.vertexAttribPointer(i,3,n.FLOAT,!1,a,o),n.enableVertexAttribArray(i))}if(c){let e=Array.isArray(c)?new Uint16Array(c):c;const t=n.createBuffer();m.push(t),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)}if(u){const e=Array.isArray(u)?new Float32Array(u):u,t=n.createBuffer();m.push(t),n.bindBuffer(n.ARRAY_BUFFER,t),n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW);const a=n.getAttribLocation(r,"uv");-1!=a&&(n.bindBuffer(n.ARRAY_BUFFER,t),n.vertexAttribPointer(a,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(a))}const x=["positions","normals","uvs","elements"];Object.entries(t.attributes).filter((([e])=>!x.includes(e))).forEach((([e,t])=>{if("object"==typeof t&&"itemSize"in t&&"array"in t){const a=Array.isArray(t.array)?new Float32Array(t.array):t.array,o=n.createBuffer();m.push(o),n.bindBuffer(n.ARRAY_BUFFER,o),n.bufferData(n.ARRAY_BUFFER,a,n.STATIC_DRAW);const i=n.getAttribLocation(r,e);-1!=i&&(n.bindBuffer(n.ARRAY_BUFFER,o),n.vertexAttribPointer(i,t.itemSize,n.FLOAT,!1,0,0),n.enableVertexAttribArray(i))}})),n.bindVertexArray(null)}}let wt;function _t(e){return function(){const{gl:t}=Ke;t.depthFunc(t[e])}}function Tt(){const{gl:e}=Ke;e.depthFunc(wt)}function St(e,t){if(null==e||null==t||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Bt(e,t){return"material"in e?e.material===t.material:e.createProgram===t.createProgram&&St(e.meshes,t.meshes)}function Ct(e,t){const{programMap:n,vaoMap:r}=Ke;let a,o;if(n.forEach(((t,n)=>{n.material===e.material&&(a=n,o=t)})),null!=a){const e=r.get(a);null!=e&&(r.delete(a),r.set(t,e)),n.delete(a),n.set(t,o)}}function Dt(e){return Ke.existingProgram=!0,function(){const{programMap:t}=Ke,n=t.get(e);Ke.program=n}}const Ut=e=>({type:"point",position:[0,0,0],color:[1,1,1],intensity:3,cutoffDistance:5,decayExponent:1,...e,shader:ke("${declaration?\r\n`\r\nstruct LightParams {\r\n    vec3 irradiance;\r\n    vec3 direction;\r\n    vec3 color;\r\n    float distance;\r\n};\r\n\r\nstruct PointLight {\r\n    vec3 position;\r\n    vec3 color;\r\n    float cutoffDistance;\r\n    float decayExponent;\r\n};\r\n\r\nlayout(std140) uniform PointLights {\r\n    PointLight pointLights[NUM_POINT_LIGHTS];\r\n};\r\n\r\nfloat getDistanceAttenuation(const in float lightDistance, const in float cutoffDistance, const in float decayExponent) {\r\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\r\n\t// page 32, equation 26: E[window1]\r\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\r\n    float distanceFalloff = 1.0f / max(pow(lightDistance, decayExponent), 0.01f);\r\n    if(cutoffDistance > 0.0f) {\r\n        distanceFalloff *= pow2(saturate(1.0f - pow4(lightDistance / cutoffDistance)));\r\n    }\r\n    return distanceFalloff;\r\n\r\n}\r\n\r\nLightParams getDirectDiffuse(const in PointLight pointLight,const in vec3 geometryPosition, const in vec3 normal,const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\r\n    LightParams lightParams = LightParams(vec3(0.0f), vec3(0.0f), vec3(0.0f), 0.0f);\r\n    vec3 lVector = pointLight.position - geometryPosition;\r\n    lightParams.distance = length(lVector);\r\n    lightParams.direction = normalize(lVector);\r\n    float dotNL = saturate(dot(normal, lightParams.direction));\r\n    lightParams.color = pointLight.color;\r\n    lightParams.color *= getDistanceAttenuation(lightParams.distance, pointLight.cutoffDistance, pointLight.decayExponent);\r\n    lightParams.irradiance = dotNL * lightParams.color;\r\n    \r\n    reflectedLight.directDiffuse += lightParams.irradiance * BRDF_Lambert(material.diffuseColor);\r\n    return lightParams;\r\n}\r\n\r\nfloat calculatePointLightBrightness(float lightDistance, float cutoffDistance, float decayExponent) {\r\n    return getDistanceAttenuation(lightDistance, cutoffDistance, decayExponent);\r\n}\r\n` : ''\r\n}\r\n${irradiance?\r\n`\r\n    vec3 irradiance = vec3(0.0f);\r\n    vec3 direction = vec3(0.0f);\r\n    for(int i = 0; i < NUM_POINT_LIGHTS; i++) {\r\n        PointLight pointLight = pointLights[i];\r\n        LightParams lightParams = getDirectDiffuse(pointLight, geometryPosition, normal, material, reflectedLight);\r\n        totalIrradiance += reflectedLight.directDiffuse;\r\n        ${specularIrradiance}\r\n    }\r\n` : ''\r\n}\r\n",{declaration:!1,irradiance:!1,specularIrradiance:""}),setupLights:Vt,updateOneLight:kt});let $t=null;const It=e=>{$t=e},Nt=()=>$t;function Ot(e,t,n){t.preMultipliedColor=[...t.color];const r=Se(Be(),t.position,Qe.view);Ce(t.preMultipliedColor,t.intensity),e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+4]=t.preMultipliedColor[0],e[n+5]=t.preMultipliedColor[1],e[n+6]=t.preMultipliedColor[2],e[n+7]=t.cutoffDistance,e[n+8]=t.decayExponent,e[n+9]=0,e[n+10]=0,e[n+11]=0,e[n+12]=0}function Vt(e){return function(){const{gl:t,program:n}=Ke;if(!Nt()){const e=t.getUniformBlockIndex(n,"PointLights");t.uniformBlockBinding(n,e,tt)}!function(e){const{gl:t}=Ke,n=e.length,r=new Float32Array(12*n);for(let t=0;t<n;t++)Ot(r,s(e[t]),12*t);let a=Nt();if(a)t.bindBuffer(t.UNIFORM_BUFFER,a);else{const e=t.createBuffer();t.bindBufferBase(t.UNIFORM_BUFFER,tt,e),It(e)}t.bufferData(t.UNIFORM_BUFFER,r,t.DYNAMIC_DRAW)}(e)}}function kt(e,t){const{gl:n}=Ke,r=e.filter((e=>"point"===s(e).type)).findIndex((e=>e===t)),a=Nt();if(-1!==r){const e=new Float32Array(12),o=12*r;Ot(e,s(t),0),n.bindBuffer(n.UNIFORM_BUFFER,a),n.bufferSubData(n.UNIFORM_BUFFER,o*Float32Array.BYTES_PER_ELEMENT,e)}}const Yt=e=>{const t=oe(e),{subscribe:n,set:r}=t,a={subscribe:n,set:e=>{r(e),kt(s(jt),a),jt.set(s(jt))}};return a};const jt=function(){const e=oe([]),{subscribe:t,set:n}=e,r=oe(0);return{subscribe:t,set:e=>{n(e),r.update((e=>e+1))},get revision(){return s(r)}}}(),zt=ie([jt],(([e])=>e.length));function Gt(e){const t=oe(e),{subscribe:n,set:r,update:a}=t;return{subscribe:n,set:e=>{r(e),Ht.set(s(Ht)),se.set(s(se))},update:a}}const Ht=function(){const e=oe([]),{subscribe:t,set:n,update:r}=e,a=oe(0);return{subscribe:t,set:e=>{n(e),a.update((e=>e+1))},update:r,get revision(){return s(a)}}}();function Wt(e){return e?.opacity<1||e?.transparent}function qt(e){if(0===e.length)return e;let t=!1;const{projection:n,view:r}=Qe,a=ge(Ne(),n,r);e.forEach((e=>{(t||Wt(e.material))&&(t=!0,e.meshes.forEach(((e,t)=>{if(e.matrix){const t=Ae(Be(),e.matrix.value);e.clipSpacePosition=Se(Be(),t,a)}else e.clipSpacePosition=[0,0,Number.MAX_VALUE]})),e.meshes=e.meshes.sort(((e,t)=>t.clipSpacePosition[2]-e.clipSpacePosition[2])))}));return e.sort(((e,t)=>null==e.material||null==t.material||null==e.meshes[0].clipSpacePosition||null==t.meshes[0].clipSpacePosition?0:t.meshes[0].clipSpacePosition[2]-e.meshes[0].clipSpacePosition[2]))}const Xt=function(){const e={canvas:null,loop:null,backgroundColor:16777215,ambientLightColor:[16777215,0],toneMappings:[],enabled:!1};let t=e,n=new Map;const r=oe(e),{subscribe:a,update:o}=r,i=oe(0);function c([e,t]){n.set("ambientLightColor",Ye(e).map((e=>e*t)))}function u(e){o((r=>{const a=e(r);var o;i.update((e=>e+1)),a.canvas!==t.canvas&&function(e){const t=e.getBoundingClientRect(),n={canvas:{width:t.width,height:t.height}};e.width=t.width,e.height=t.height,Xe({...Ke,...n})}(a.canvas),null!=t.loop&&a.loop!==t.loop&&a.loop,a.backgroundColor!==t.backgroundColor&&(o=a.backgroundColor,n.set("backgroundColor",[...Ye(o),1]));return null!=n.get("ambientLightColor")&&4===n.get("ambientLightColor").length||c(a.ambientLightColor),St(a.ambientLightColor,t.ambientLightColor)||c(a.ambientLightColor),St(a.toneMappings,t.toneMappings)||a.toneMappings,a.enabled!==t.enabled&&a.enabled,t=a,a}))}return{subscribe:a,set:function(e){u((t=>e))},update:u,get processed(){const e=s(r);return Object.entries(e).map((([e,t])=>n.has(e)?[e,n.get(e)]:[e,t])).reduce(((e,[t,n])=>(e[t]=n,e)),{})},get revision(){return s(i)}}}();function Kt(e){return e?.opacity<1||e?.transparent}Xt.subscribe((e=>{}));const Jt=oe([]);function Qt(e,t){return(Kt(e.material)?1:-1)-(Kt(t.material)?1:-1)}function Zt(e,t){return e.order-t.order}const en=ie([se,zt,Ht,Jt],(([e,t,n,r])=>{let a=r.filter((e=>e.order<0)).reduce(((e,t)=>e.concat(...t.programs)),[]).map((t=>({...t,...t.updateProgram?{}:{updateProgram:[]},...t.allMeshes?{meshes:e}:{}}))),o=r.filter((e=>0===e.order)).reduce(((e,t)=>e.concat(...t.programs)),[]).map((t=>({...t,...t.updateProgram?{}:{updateProgram:[]},...t.allMeshes?{meshes:e}:{}}))),i=r.filter((e=>e.order>0)).reduce(((e,t)=>e.concat(...t.programs)),[]).map((t=>({...t,...t.updateProgram?{}:{updateProgram:[]},...t.allMeshes?{meshes:e}:{}}))).sort(Zt);const c=new Set(e.filter((e=>et(e)||e.animations?.some((e=>"vertex"===e.type))))),u=qt(Array.from(n).reduce(((t,n)=>{const r=e.filter((e=>e.material===n)),{currentNormalMeshes:a,currentSpecialMeshes:o}=r.reduce(((e,t)=>(c.has(t)?e.currentSpecialMeshes.push(t):e.currentNormalMeshes.push(t),e)),{currentNormalMeshes:[],currentSpecialMeshes:[]});return a.length>0&&t.push({material:s(n),meshes:a}),o.forEach((e=>{const r=e.animations?.some((e=>e.requireTime));t.push({requireTime:r,material:s(n),meshes:[e]})})),t}),[]).sort(Qt)),l=t;let f;l>0&&(f=s(s(jt)[0]).shader);const m=[...a,...o,...u.map(((e,t)=>{if(e.material.program)return e.material.program.meshes=e.meshes,Ct(e,e.material.program),e.material.program;const n=0===t,r={...e,useProgram:mt,setupProgram:null,setFrameBuffer:null,setupMaterial:[xt],updateProgram:[],bindTextures:[],createProgram:ut,selectProgram:Dt,setupCamera:void 0};return Ct(e,r),r.setupProgram=[gt(e.material,e.meshes,l,f),lt,ft],n&&0===o.length&&(r.setFrameBuffer=dt),e.material?.specular&&r.setupMaterial.push(e.material.specular.setupSpecular),e.material?.diffuseMap&&(r.setupMaterial.push(e.material.diffuseMap.setupTexture),r.bindTextures.push(e.material.diffuseMap.bindTexture)),e.material?.normalMap&&(r.setupMaterial.push(e.material.normalMap.setupTexture),r.bindTextures.push(e.material.normalMap.bindTexture)),e.material?.roughnessMap&&(r.setupMaterial.push(e.material.roughnessMap.setupTexture),r.bindTextures.push(e.material.roughnessMap.bindTexture)),e.material?.envMap&&(r.setupMaterial.push(e.material.envMap.setupTexture),r.bindTextures.push(e.material.envMap.bindTexture)),e.requireTime&&r.updateProgram.push(it),r.updateProgram.push(...Array.from(s(jt).reduce(((e,t)=>{const n=s(t);return e.has(n.setupLights)?e.set(n.setupLights,[...e.get(n.setupLights),t]):e.set(n.setupLights,[t]),e}),new Map)).map((([e,t])=>e(t)))),r})),...i];return function(e){const{programMap:t,vaoMap:n,gl:r}=Ke;t.forEach(((a,o)=>{if(!e.some((e=>Bt(e,o)))){const e=n.get(o);if(e){for(const t of e.values())r.deleteVertexArray(t);n.delete(o)}const i=s(se);o.meshes.forEach((e=>{if(!i.includes(e)){const t=Ke.bufferMap.get(e);t&&(t.forEach((e=>{r.deleteBuffer(e)})),Ke.bufferMap.delete(e))}})),r.deleteProgram(a),t.delete(o)}})),e.forEach((e=>{const a=Array.from(t).find((([t])=>Bt(t,e)));if(a){const[t,o]=a;e.meshes.forEach((r=>{const a=function(e,t){for(const[n,r]of t)for(const[t,n]of r)if(t===e)return n;return null}(r,n);a&&(n.get(t).delete(r),e.existingVAO=e.existingVAO||new Map,e.existingVAO.set(r,a))}));const i=n.get(t);i.forEach(((t,n)=>{e.meshes.includes(n)||(r.deleteVertexArray(t),i.delete(n))}))}}))}(m),m})),tn=Ne();function nn(e){return s(en).find((t=>!0!==t.allMeshes&&t.meshes.includes(e)))}me(tn);const rn=(e,t,n)=>{let r=n||tn,a=new Float32Array(16),o=new Float32Array(9),i=Qe.revision;function c(){an(a,r),on(o,a)}c();const u={set:n=>{r=n,c();const a=nn(e);!function(e,t){const{gl:n,programMap:r}=Ke,a=r.get(e);n.useProgram(a),yt(n,a,t)}(a,u),function(e,t){const{gl:n,programMap:r}=Ke,a=r.get(e),o=n.getUniformLocation(a,"normalMatrix");n.uniformMatrix3fv(o,!1,t.normalMatrix)}(a,u),t(s(Xt))},get value(){return r},get modelView(){return Qe.revision!==i&&(c(),i=Qe.revision),a},get normalMatrix(){return Qe.revision!==i&&(c(),i=Qe.revision),o}};return u};function an(e,t){ge(e,Qe.view,t)}function on(e,t){return function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10]}(e,t),e=function(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],c=t[6],u=t[7],l=t[8],f=l*i-s*u,m=-l*o+s*c,p=u*o-i*c,d=n*f+r*m+a*p;return d?(d=1/d,e[0]=f*d,e[1]=(-l*r+a*u)*d,e[2]=(s*r-a*i)*d,e[3]=m*d,e[4]=(l*n-a*c)*d,e[5]=(-s*n+a*o)*d,e[6]=p*d,e[7]=(-u*n+r*c)*d,e[8]=(i*n-r*o)*d,e):null}(e,e),e=function(e,t){if(e===t){var n=t[1],r=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}(e,e),e}const sn=(e,t,n,r)=>{let a=Array.isArray(n)?function(e){const t=e.reduce(((e,t)=>e+t.length),0),n=new Float32Array(t);let r=0;return e.forEach((e=>{n.set(e,r),r+=e.length})),n}(n):n;const o=[],i=new Float32Array(16*r),s=[],c=new Float32Array(9*r),u=[];let l,f,m,p=Qe.revision;for(let e=0;e<r;++e){const t=16*e*4,n=16;o.push(new Float32Array(a.buffer,t,n)),s.push(new Float32Array(i.buffer,t,n)),u.push(new Float32Array(c.buffer,9*e*4,9))}function d(e,t){an(s[t],e),on(u[t],s[t])}function g(){o.forEach(((e,t)=>{d(e,t)}))}return g(),{set:e=>{a=e},get value(){return a},get windows(){return o},set buffer(e){l=e},get buffer(){return l},setInstance(t,n){o[t].set(n),d(o[t],t);const r=nn(e);!function(e,t,n,r,a){const{gl:o,vaoMap:i}=Ke;o.bindVertexArray(i.get(e).get(t)),o.bindBuffer(o.ARRAY_BUFFER,a),o.bufferSubData(o.ARRAY_BUFFER,64*r,n),o.bindVertexArray(null)}(r,e,s[t],t,f),function(e,t,n,r,a){const{gl:o,vaoMap:i}=Ke;o.bindVertexArray(i.get(e).get(t)),o.bindBuffer(o.ARRAY_BUFFER,a),o.bufferSubData(o.ARRAY_BUFFER,36*r,n),o.bindVertexArray(null)}(r,e,u[t],t,m)},getInstance:e=>o[e],get modelView(){return Qe.revision!==p&&(g(),p=Qe.revision),i},getModelViewInstance:e=>s[e],get modelViewWindows(){return s},set modelViewBuffer(e){f=e},get modelViewBuffer(){return f},get normalMatrices(){return Qe.revision!==p&&(g(),p=Qe.revision),c},set normalMatrixBuffer(e){m=e},get normalMatrixBuffer(){return m}}};function cn(e,t=!1,n=[0,0,0]){t&&console.log("symmetry");const r={...e};return Ze(r)?r.matrix=rn(r,Xt.set,r.matrix):et(r)&&(r.matrices=sn(r,Xt.set,r.matrices,r.instances)),r}const un=8900331;function ln(e,t){let n,r;function a(t){let a="mousemove",o="mouseup",s=t;"touchstart"===t.type&&(a="touchmove",o="touchend",s=t.touches[0]),e.addEventListener(a,i,{passive:!1}),n=s.clientX,r=s.clientY,e.addEventListener(o,l,{passive:!1}),t.preventDefault(),t.stopPropagation()}function o(e,t){const n=Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2));return{radius:n,polar:Math.acos(Math.max(-1,Math.min(1,(e[1]-t[1])/n))),azimuth:Math.atan2(e[0]-t[0],e[2]-t[2])}}function i(e){let a=e;"touchmove"===e.type&&(a=e.touches[0]);const i=a.clientX-n,c=a.clientY-r,l=s(t),{position:f,target:m,fov:p}=l,{radius:d,polar:g,azimuth:h}=o(f,m),v=u(d,Math.max(.01,Math.min(Math.PI-.01,g-c/100)),h-i/100);v[0]=v[0]+m[0],v[1]=v[1]+m[1],v[2]=v[2]+m[2],t.set({position:v,target:m,fov:p}),n=a.clientX,r=a.clientY}function c(e){const n=s(t),{position:r,target:a,fov:i}=n,{radius:c,polar:l,azimuth:f}=o(r,a),m=u(c+.001*e.deltaY*c,l,f);m[0]=m[0]+a[0],m[1]=m[1]+a[1],m[2]=m[2]+a[2],t.set({position:m,target:a,fov:i})}function u(e,t,n){const r=Math.sin(t)*e;return[r*Math.sin(n),Math.cos(t)*e,r*Math.cos(n)]}function l(t){let n="mousemove",r="mouseup";"touchend"===t.type&&(n="touchmove",r="touchend"),e.removeEventListener(n,i,{passive:!1}),e.removeEventListener(r,l,{passive:!1})}return e.addEventListener("touchstart",a,{passive:!1}),e.addEventListener("mousedown",a,{passive:!1}),e.addEventListener("wheel",c,{passive:!1}),{delta(e,n,r){const a=s(t),{position:i,target:c,fov:l}=a,{radius:f,polar:m,azimuth:p}=o(i,c),d=u(f+e,m+n,p+r);d[0]=d[0]+c[0],d[1]=d[1]+c[1],d[2]=d[2]+c[2],t.set({position:d,target:c,fov:l})},destroy(){e.removeEventListener("touchstart",a),e.removeEventListener("mousedown",a),e.removeEventListener("wheel",c)}}}const fn={0:"POINTS",1:"LINES",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN"};function mn(e){v(e,"svelte-7mcxv8","button.svelte-7mcxv8.svelte-7mcxv8{position:relative;font-family:Arial;font-size:20px;padding:10px}ul.svelte-7mcxv8.svelte-7mcxv8{position:relative;display:none;font-family:Arial;font-size:20px}li.svelte-7mcxv8.svelte-7mcxv8{padding:10px;background-color:white;width:fit-content}li.svelte-7mcxv8 a.svelte-7mcxv8{text-decoration:none;color:black}.menuOpened.svelte-7mcxv8.svelte-7mcxv8{display:block}.current.svelte-7mcxv8.svelte-7mcxv8{color:red}")}function pn(e,t,n){const r=e.slice();return r[3]=t[n],r}function dn(t){let n,r,a,o=t[3].name+"";return{c(){n=A("li"),r=A("a"),a=y(o),F(r,"href",t[3].href),F(r,"class","svelte-7mcxv8"),F(n,"class","svelte-7mcxv8")},m(e,t){b(e,n,t),h(n,r),h(r,a)},p:e,d(e){e&&M(n)}}}function gn(t){let n;return{c(){n=A("li"),n.textContent=`${t[3].name}`,F(n,"class","current svelte-7mcxv8")},m(e,t){b(e,n,t)},p:e,d(e){e&&M(n)}}}function hn(e){let t;let n=function(e,t){return window.location.pathname===e[3].href.substring(1)?gn:dn}(e),r=n(e);return{c(){r.c(),t=R()},m(e,n){r.m(e,n),b(e,t,n)},p(e,t){r.p(e,t)},d(e){e&&M(t),r.d(e)}}}function vn(t){let n,r,a,o,i,s=J(t[2]),c=[];for(let e=0;e<s.length;e+=1)c[e]=hn(pn(t,s,e));return{c(){n=A("button"),n.textContent="examples",r=E(),a=A("ul");for(let e=0;e<c.length;e+=1)c[e].c();F(n,"class","svelte-7mcxv8"),F(a,"class","svelte-7mcxv8"),w(a,"menuOpened",t[0])},m(e,s){b(e,n,s),b(e,r,s),b(e,a,s);for(let e=0;e<c.length;e+=1)c[e]&&c[e].m(a,null);o||(i=L(n,"click",t[1]),o=!0)},p(e,[t]){if(4&t){let n;for(s=J(e[2]),n=0;n<s.length;n+=1){const r=pn(e,s,n);c[n]?c[n].p(r,t):(c[n]=hn(r),c[n].c(),c[n].m(a,null))}for(;n<c.length;n+=1)c[n].d(1);c.length=s.length}1&t&&w(a,"menuOpened",e[0])},i:e,o:e,d(e){e&&(M(n),M(r),M(a)),x(c,e),o=!1,i()}}}function bn(e,t,n){let r=!1;return[r,function(){n(0,r=!r)},[{name:"Normal map and specular",href:"./golf-ball"},{name:"GLTF loader",href:"./"},{name:"Obj loader",href:"./venus"},{name:"Cube",href:"./cube"},{name:"rock",href:"./rock"},{name:"GLTF",href:"./gltf"},{name:"Contact Shadow",href:"./contact-shadow"},{name:"Transparency",href:"./transparency"},{name:"Instances",href:"./instances"},{name:"Matrix",href:"./matrix"},{name:"Texture",href:"./texture"},{name:"Lights",href:"./lights"},{name:"Vertex Animation",href:"./vertex-anim"},{name:"Scene Update",href:"./scene-update"},{name:"Skybox HDR",href:"./skybox"},{name:"Skybox Cube Map",href:"./skybox-cube"},{name:"Draco Compressed GLTF",href:"./draco-gltf"}]]}class Mn extends re{constructor(e){super(),ne(this,e,bn,vn,o,{},mn)}}const xn=oe({init:!1});function An(e,t){return function(){const{vaoMap:n}=Ke,r=n.get(e).get(t);Ke.vao=r}}const yn=[],En=new Map;En.set(Xt,0),En.set(se,0),En.set(Qe,0),En.set(Ht,0),En.set(jt,0);const Rn=new Map;const Ln=oe(0),Fn=ie([Xt,en,Qe,Ln],(([e,t,n,r])=>{if(!e.enabled||4===r||1===r||0===t.length)return yn;const a=function(){const e=new Map;return En.get(Xt)!==Xt.revision&&e.set(Xt,"renderer"),En.get(se)!==se.revision&&e.set(se,"scene"),En.get(Qe)!==Qe.revision&&e.set(Qe,"camera"),En.get(Ht)!==Ht.revision&&e.set(Ht,"materials"),En.get(jt)!==jt.revision&&e.set(jt,"lights"),En.set(Xt,Xt.revision),En.set(se,se.revision),En.set(Qe,Qe.revision),En.set(Ht,Ht.revision),En.set(jt,jt.revision),e}();if(0===a.size&&2!==r&&!t.some((e=>"requireTime"in e)))return yn;const o=Xt.processed;const i=[];Xe({canvas:e.canvas,backgroundColor:o.backgroundColor,ambientLightColor:o.ambientLightColor,...e.toneMappings.length>0?{toneMappings:e.toneMappings}:void 0});const c=function(e){return 1===e.size&&(e.has(Qe)||e.has(jt))||2===e.size&&e.has(Qe)&&e.has(jt)}(a),u=function(e){return Array.from(e.values()).join("-")}(a);if(c){if(Rn.has(u))return Rn.get(u)}else Rn.clear();s(xn).init||i.push(nt);const l=qt(t);let f=!1;i.push(ot);let m=!1;return i.push(...l.reduce(((e,t)=>{Ke.existingProgram=!1,Wt(t.material)&&!f&&(f=!0,e.push(at));const n=Ke.programMap.has(t);return m=m||!n,[...e,...n?[t.selectProgram(t),t.useProgram,...t.bindTextures?[...t.bindTextures]:[],...t.updateProgram]:[t.createProgram(t),...t.setupProgram,t.useProgram,...t.setupMaterial,...t.updateProgram],...t.setupCamera?[t.setupCamera(Qe)]:[...a.has(Qe)||!Ke.existingProgram?[At(Qe)]:[]],...t.setFrameBuffer?[t.setFrameBuffer]:[],...t.meshes.reduce(((e,n)=>[...e,...Ke.vaoMap.has(t)&&Ke.vaoMap.get(t).has(n)?[An(t,n),...null==n.matrix&&null==n.matrices||!Ze(n)&&!a.has(Qe)?[]:[Et(t,n),Lt(t,n)]]:[Pt(t,n),...t.material?[Mt(t.material)]:[],...null!=n.matrix||null!=n.matrices?[Et(t,n),Lt(t,n)]:[],...n.animations?.map((e=>e.setupAnimation))||[]],...null!=n.matrix||null!=n.matrices?[...et(n)?[rt(de(n.matrices.getInstance(0))>0)]:[rt(de(n.matrix.value)>0)]]:[],ct,st(n,n.instances,n.drawMode)]),[]),...t.postDraw?[t.postDraw]:[]]}),[])),!c||m||Rn.has(u)||Rn.set(u,i),i}),yn);ie([Fn],(([e])=>{if(0===e.length)return 0;if(!s(xn).init&&0===s(Ln))return Ln.set(1),e.forEach((e=>{e()})),xn.set({init:!0}),Ln.set(2),1;if(2===s(Ln))return Ln.set(3),requestAnimationFrame((async function e(){Ln.set(4);const t=s(Xt);t.loop&&t.loop(),Ln.set(3),s(Fn).forEach((e=>{e()})),Ln.set(4),requestAnimationFrame(e)})),2})).subscribe((e=>{})),Fn.subscribe((e=>{}));export{vt as $,cn as A,be as B,Yt as C,Ut as D,ln as E,s as F,Me as G,ve as H,U as I,Oe as J,xe as K,Ie as L,Mn as M,Se as N,_e as O,Pe as P,we as Q,fn as R,re as S,Ke as T,ht as U,Ae as V,Be as W,Le as X,Fe as Y,lt as Z,ft as _,E as a,mt as a0,Dt as a1,bt as a2,Ue as a3,ke as a4,v as a5,F as a6,L as a7,r as a8,u as a9,De as aA,Ve as aB,pt as aC,_t as aD,dt as aE,Tt as aF,pe as aG,w as aa,h as ab,m as ac,p as ad,f as ae,y as af,P as ag,C as ah,d as ai,He as aj,Ge as ak,We as al,J as am,R as an,W as ao,q as ap,x as aq,qe as ar,fe as as,le as at,ut as au,ge as av,ye as aw,ue as ax,Te as ay,Ce as az,b,Q as c,K as d,A as e,M as f,ee as g,c as h,ne as i,Qe as j,se as k,jt as l,Z as m,e as n,B as o,Ht as p,Jt as q,Xt as r,o as s,X as t,g as u,un as v,Gt as w,me as x,Ne as y,he as z};

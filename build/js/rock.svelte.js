import{S as e,i as s,s as a,M as t,e as n,a as i,c as o,b as r,m as l,n as c,t as m,d as f,f as p,g as u,h as d,o as g,j as h,r as w,l as y,k as x,p as M,q as b,u as k,v as j,w as v,x as A,y as $,z as I,A as C,B as D,C as E,D as P,E as z,F as S,G as T,H as q,I as B,J as F}from"./engine.js";import{l as G,m as H,i as J,c as L}from"./gltf-loader.js";import{c as K}from"./specular.js";import{c as N}from"./texture.js";import{c as O}from"./plane.js";import{c as Q,g as R,h as U,a as V,b as W}from"./environment-map-texture.js";import{l as X}from"./rgbe-loader.js";import{c as Y}from"./skybox.js";function Z(e){let s,a,d,g;return d=new t({}),{c(){s=n("canvas"),a=i(),o(d.$$.fragment)},m(t,n){r(t,s,n),e[1](s),r(t,a,n),l(d,t,n),g=!0},p:c,i(e){g||(m(d.$$.fragment,e),g=!0)},o(e){f(d.$$.fragment,e),g=!1},d(t){t&&(p(s),p(a)),e[1](null),u(d,t)}}}function _(e,s,a){let t,n,i,o,r,l,c,m,f,p;d(e,h,(e=>a(6,t=e))),d(e,w,(e=>a(7,n=e))),d(e,y,(e=>a(8,i=e))),d(e,x,(e=>a(9,o=e))),d(e,M,(e=>a(10,r=e))),d(e,b,(e=>a(11,l=e)));let u=0;function Z(){u+=.01;const e=t.position;e[1]+=.01;const s=t.target;s[1]+=.01,k(h,t={...t,position:e,target:s},t);const a=S(m);a.position[1]+=.01;const n=S(f);n.position[1]+=.01,m.set({...a}),f.set({...n});for(let e=0;e<15;e++){const s=.001*performance.now()+e*Math.PI*2/15,a=4,t=Math.cos(s)*a,n=Math.sin(s)*a,i=A($());I(i,i,[t,n+u+4,0]),T(i,i,.003*performance.now()+e*Math.PI*2/15),q(i,i,[.6,.6,.6]),p.matrices.setInstance(e,i)}}return g((async()=>{k(w,n={...n,canvas:c,backgroundColor:j,ambientLightColor:[16777215,.1],toneMappings:[Q({exposure:1})]},n),k(h,t={...t,position:[0,3,21],target:[0,3,0],fov:36},t);const e=await X("skyboxes/rogland-clear-night-4k.hdr"),s=R(1),a=await Y({typedArray:e.data,convertToCube:U,width:e.width,height:e.height,cubeSize:2048,toneMapping:s}),u=V(e);k(b,l=[a,u],l);const d=W({envMap:u.getTexture,width:u.width,height:u.height,lodMax:u.lodMax}),g=await G("models/rock-left.gltf","models/rock-left.bin"),S=H(g.scene).find(J),T=L(g,S),q=await N({url:"textures/rock-diffuse.jpg",type:"diffuse"}),B=await N({url:"textures/rock-normal.png",type:"normal"}),_=v({metalness:T.material.metalness,diffuse:[.67,.68,.81],specular:K({roughness:1,ior:1.4,intensity:.5,color:[1,1,1]}),diffuseMap:q,normalMap:B,envMap:d});const ee=A($());let se=new Array(60).fill(0).map(((e,s)=>{let a=F(ee);return I(a,a,[-10,2*s-4,0]),a}));delete T.matrix;const ae=C({...T,material:_,instances:60,matrices:se}),te=await G("models/rock-right.gltf","models/rock-right.bin"),ne=H(te.scene).find(J),ie=L(te,ne),oe=A($());let re=new Array(60).fill(0).map(((e,s)=>{let a=F(oe);return I(a,a,[10,2*s-4,0]),a}));delete ie.matrix;const le=C({...ie,material:_,instances:60,matrices:re}),ce=await G("models/ennemi1.gltf","models/ennemi1.bin"),me=H(ce.scene).find(J),fe=L(ce,me),pe=await N({url:"models/ennemi1-diffuse.png",type:"diffuse"}),ue=await N({url:"models/ennemi1-roughness.png",type:"roughness"}),de=v({...fe.material,metalness:.8090909123420715,specular:K({roughness:1,ior:1.4,intensity:.8,color:[1,1,1]}),diffuse:[1,1,1],diffuseMap:pe,roughnessMap:ue,envMap:d}),ge=new Array(15).fill(0).map(((e,s)=>A($())));delete fe.matrix,p=C({...fe,matrices:ge,instances:15,material:de});const he=O(100,100,1,1),we=await N({url:"textures/background.jpg",type:"diffuse"}),ye=v({diffuse:[.67,.68,.81],metalness:0,diffuseMap:we}),xe=A($());I(xe,xe,[0,0,-70]),D(xe,xe,Math.PI/2);const Me=new Array(5).fill(0).map(((e,s)=>{let a=F(xe);return I(a,a,[0,0,100*-s]),a})),be=C({...he,material:ye,instances:5,matrices:Me});m=E(P({color:[.996078431372549,.9529411764705882,.6627450980392157],intensity:4,position:[0,9,3],cutoffDistance:120,decayExponent:.001})),f=E(P({position:[-3,-3,1],color:[.6313725490196078,.6235294117647059,.996078431372549],intensity:3,cutoffDistance:15,decayExponent:.25})),k(M,r=[...r,_,de,ye],r),k(x,o=[...o,ae,le,p,be],o),k(y,i=[...i,m,f],i),k(w,n={...n,loop:Z,enabled:!0},n),z(c,h)})),[c,function(e){B[e?"unshift":"push"]((()=>{c=e,a(0,c)}))}]}class ee extends e{constructor(e){super(),s(this,e,_,Z,a,{})}}export{ee as default};

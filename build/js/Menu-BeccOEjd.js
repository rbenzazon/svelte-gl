function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function a(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(e,...n){if(null==e){for(const t of n)t(void 0);return t}const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function s(t){let e;return i(t,(t=>e=t))(),e}function c(t,e,n){t.$$.on_destroy.push(i(e,n))}function u(t,e,n,r){if(t){const a=l(t,e,n,r);return t[0](a)}}function l(t,e,n,r){return t[1]&&r?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](r(e))):n.ctx}function f(t,e,n,r){if(t[2]&&r){const a=t[2](r(n));if(void 0===e.dirty)return a;if("object"==typeof a){const t=[],n=Math.max(e.dirty.length,a.length);for(let r=0;r<n;r+=1)t[r]=e.dirty[r]|a[r];return t}return e.dirty|a}return e.dirty}function p(t,e,n,r,a,o){if(a){const i=l(e,n,r,o);t.p(i,a)}}function m(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let t=0;t<n;t++)e[t]=-1;return e}return-1}function d(t){return null==t?"":t}function g(t,e,n){return t.set(n),e}function h(t,e){t.appendChild(e)}function v(t,e,n){const r=function(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;if(e&&e.host)return e;return t.ownerDocument}(t);if(!r.getElementById(e)){const t=A("style");t.id=e,t.textContent=n,function(t,e){h(t.head||t,e),e.sheet}(r,t)}}function b(t,e,n){t.insertBefore(e,n||null)}function M(t){t.parentNode&&t.parentNode.removeChild(t)}function x(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function A(t){return document.createElement(t)}function y(t){return document.createTextNode(t)}function L(){return y(" ")}function R(){return y("")}function E(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function P(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function w(t,e){e=""+e,t.data!==e&&(t.data=e)}function F(t,e,n){t.classList.toggle(e,!!n)}let _;function S(t){_=t}function T(){if(!_)throw new Error("Function called outside component initialization");return _}function B(t){T().$$.on_mount.push(t)}function C(){const t=T();return(e,n,{cancelable:r=!1}={})=>{const a=t.$$.callbacks[e];if(a){const o=function(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}(e,n,{cancelable:r});return a.slice().forEach((e=>{e.call(t,o)})),!o.defaultPrevented}return!0}}const $=[],D=[];let N=[];const I=[],U=Promise.resolve();let O=!1;function k(t){N.push(t)}const Y=new Set;let V=0;function j(){if(0!==V)return;const t=_;do{try{for(;V<$.length;){const t=$[V];V++,S(t),W(t.$$)}}catch(t){throw $.length=0,V=0,t}for(S(null),$.length=0,V=0;D.length;)D.pop()();for(let t=0;t<N.length;t+=1){const e=N[t];Y.has(e)||(Y.add(e),e())}N.length=0}while($.length);for(;I.length;)I.pop()();O=!1,Y.clear(),S(t)}function W(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(k)}}const z=new Set;let q;function H(){q={r:0,c:[],p:q}}function G(){q.r||r(q.c),q=q.p}function X(t,e){t&&t.i&&(z.delete(t),t.i(e))}function K(t,e,n,r){if(t&&t.o){if(z.has(t))return;z.add(t),q.c.push((()=>{z.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}else r&&r()}function J(t){return void 0!==t?.length?t:Array.from(t)}function Q(t){t&&t.c()}function Z(t,n,o){const{fragment:i,after_update:s}=t.$$;i&&i.m(n,o),k((()=>{const n=t.$$.on_mount.map(e).filter(a);t.$$.on_destroy?t.$$.on_destroy.push(...n):r(n),t.$$.on_mount=[]})),s.forEach(k)}function tt(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];N.forEach((r=>-1===t.indexOf(r)?e.push(r):n.push(r))),n.forEach((t=>t())),N=e}(n.after_update),r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function et(t,e){-1===t.$$.dirty[0]&&($.push(t),O||(O=!0,U.then(j)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function nt(e,a,o,i,s,c,u=null,l=[-1]){const f=_;S(e);const p=e.$$={fragment:null,ctx:[],props:c,update:t,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a.context||(f?f.$$.context:[])),callbacks:n(),dirty:l,skip_bound:!1,root:a.target||f.$$.root};u&&u(p.root);let m=!1;if(p.ctx=o?o(e,a.props||{},((t,n,...r)=>{const a=r.length?r[0]:n;return p.ctx&&s(p.ctx[t],p.ctx[t]=a)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](a),m&&et(e,t)),n})):[],p.update(),m=!0,r(p.before_update),p.fragment=!!i&&i(p.ctx),a.target){if(a.hydrate){const t=function(t){return Array.from(t.childNodes)}(a.target);p.fragment&&p.fragment.l(t),t.forEach(M)}else p.fragment&&p.fragment.c();a.intro&&X(e.$$.fragment),Z(e,a.target,a.anchor),j()}S(f)}class rt{$$=void 0;$$set=void 0;$destroy(){tt(this,1),this.$destroy=t}$on(e,n){if(!a(n))return t;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const t=r.indexOf(n);-1!==t&&r.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");const at=[];function ot(e,n=t){let r;const a=new Set;function i(t){if(o(e,t)&&(e=t,r)){const t=!at.length;for(const t of a)t[1](),at.push(t,e);if(t){for(let t=0;t<at.length;t+=2)at[t][0](at[t+1]);at.length=0}}}function s(t){i(t(e))}return{set:i,update:s,subscribe:function(o,c=t){const u=[o,c];return a.add(u),1===a.size&&(r=n(i,s)||t),o(e),()=>{a.delete(u),0===a.size&&r&&(r(),r=null)}}}}function it(e,n,o){const s=!Array.isArray(e),c=s?[e]:e;if(!c.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const u=n.length<2;return l=(e,o)=>{let l=!1;const f=[];let p=0,m=t;const d=()=>{if(p)return;m();const r=n(s?f[0]:f,e,o);u?e(r):m=a(r)?r:t},g=c.map(((t,e)=>i(t,(t=>{f[e]=t,p&=~(1<<e),l&&d()}),(()=>{p|=1<<e}))));return l=!0,d(),function(){r(g),m(),l=!1}},{subscribe:ot(o,l).subscribe};var l}const st=function(){const t=ot([]),e=ot(0),{subscribe:n,update:r}=t;function a(t){try{r((n=>{const r=t(n);return e.update((t=>t+1)),r}))}catch(t){console.log(t)}}return{subscribe:n,set:function(t){a((e=>t))},update:a,get revision(){return s(e)}}}();var ct=1e-6,ut="undefined"!=typeof Float32Array?Float32Array:Array;function lt(){var t=new ut(16);return ut!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function ft(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pt(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],c=e[6],u=e[7],l=e[8],f=e[9],p=e[10],m=e[11],d=e[12],g=e[13],h=e[14],v=e[15],b=n*s-r*i,M=n*c-a*i,x=n*u-o*i,A=r*c-a*s,y=r*u-o*s,L=a*u-o*c,R=l*g-f*d,E=l*h-p*d,P=l*v-m*d,w=f*h-p*g,F=f*v-m*g,_=p*v-m*h,S=b*_-M*F+x*w+A*P-y*E+L*R;return S?(S=1/S,t[0]=(s*_-c*F+u*w)*S,t[1]=(a*F-r*_-o*w)*S,t[2]=(g*L-h*y+v*A)*S,t[3]=(p*y-f*L-m*A)*S,t[4]=(c*P-i*_-u*E)*S,t[5]=(n*_-a*P+o*E)*S,t[6]=(h*x-d*L-v*M)*S,t[7]=(l*L-p*x+m*M)*S,t[8]=(i*F-s*P+u*R)*S,t[9]=(r*P-n*F-o*R)*S,t[10]=(d*y-g*x+v*b)*S,t[11]=(f*x-l*y-m*b)*S,t[12]=(s*E-i*w-c*R)*S,t[13]=(n*w-r*E+a*R)*S,t[14]=(g*M-d*A-h*b)*S,t[15]=(l*A-f*M+p*b)*S,t):null}function mt(t){var e=t[0],n=t[1],r=t[2],a=t[3],o=t[4],i=t[5],s=t[6],c=t[7],u=t[8],l=t[9],f=t[10],p=t[11],m=t[12],d=t[13],g=t[14],h=t[15];return(e*i-n*o)*(f*h-p*g)-(e*s-r*o)*(l*h-p*d)+(e*c-a*o)*(l*g-f*d)+(n*s-r*i)*(u*h-p*m)-(n*c-a*i)*(u*g-f*m)+(r*c-a*s)*(u*d-l*m)}function dt(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=e[4],c=e[5],u=e[6],l=e[7],f=e[8],p=e[9],m=e[10],d=e[11],g=e[12],h=e[13],v=e[14],b=e[15],M=n[0],x=n[1],A=n[2],y=n[3];return t[0]=M*r+x*s+A*f+y*g,t[1]=M*a+x*c+A*p+y*h,t[2]=M*o+x*u+A*m+y*v,t[3]=M*i+x*l+A*d+y*b,M=n[4],x=n[5],A=n[6],y=n[7],t[4]=M*r+x*s+A*f+y*g,t[5]=M*a+x*c+A*p+y*h,t[6]=M*o+x*u+A*m+y*v,t[7]=M*i+x*l+A*d+y*b,M=n[8],x=n[9],A=n[10],y=n[11],t[8]=M*r+x*s+A*f+y*g,t[9]=M*a+x*c+A*p+y*h,t[10]=M*o+x*u+A*m+y*v,t[11]=M*i+x*l+A*d+y*b,M=n[12],x=n[13],A=n[14],y=n[15],t[12]=M*r+x*s+A*f+y*g,t[13]=M*a+x*c+A*p+y*h,t[14]=M*o+x*u+A*m+y*v,t[15]=M*i+x*l+A*d+y*b,t}function gt(t,e,n){var r,a,o,i,s,c,u,l,f,p,m,d,g=n[0],h=n[1],v=n[2];return e===t?(t[12]=e[0]*g+e[4]*h+e[8]*v+e[12],t[13]=e[1]*g+e[5]*h+e[9]*v+e[13],t[14]=e[2]*g+e[6]*h+e[10]*v+e[14],t[15]=e[3]*g+e[7]*h+e[11]*v+e[15]):(r=e[0],a=e[1],o=e[2],i=e[3],s=e[4],c=e[5],u=e[6],l=e[7],f=e[8],p=e[9],m=e[10],d=e[11],t[0]=r,t[1]=a,t[2]=o,t[3]=i,t[4]=s,t[5]=c,t[6]=u,t[7]=l,t[8]=f,t[9]=p,t[10]=m,t[11]=d,t[12]=r*g+s*h+f*v+e[12],t[13]=a*g+c*h+p*v+e[13],t[14]=o*g+u*h+m*v+e[14],t[15]=i*g+l*h+d*v+e[15]),t}function ht(t,e,n){var r=n[0],a=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function vt(t,e,n){var r=Math.sin(n),a=Math.cos(n),o=e[4],i=e[5],s=e[6],c=e[7],u=e[8],l=e[9],f=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*a+u*r,t[5]=i*a+l*r,t[6]=s*a+f*r,t[7]=c*a+p*r,t[8]=u*a-o*r,t[9]=l*a-i*r,t[10]=f*a-s*r,t[11]=p*a-c*r,t}function bt(t,e,n){var r=Math.sin(n),a=Math.cos(n),o=e[0],i=e[1],s=e[2],c=e[3],u=e[8],l=e[9],f=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*a-u*r,t[1]=i*a-l*r,t[2]=s*a-f*r,t[3]=c*a-p*r,t[8]=o*r+u*a,t[9]=i*r+l*a,t[10]=s*r+f*a,t[11]=c*r+p*a,t}function Mt(t,e,n){var r=Math.sin(n),a=Math.cos(n),o=e[0],i=e[1],s=e[2],c=e[3],u=e[4],l=e[5],f=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*a+u*r,t[1]=i*a+l*r,t[2]=s*a+f*r,t[3]=c*a+p*r,t[4]=u*a-o*r,t[5]=l*a-i*r,t[6]=f*a-s*r,t[7]=p*a-c*r,t}function xt(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function At(t,e,n,r){var a=e[0],o=e[1],i=e[2],s=e[3],c=a+a,u=o+o,l=i+i,f=a*c,p=a*u,m=a*l,d=o*u,g=o*l,h=i*l,v=s*c,b=s*u,M=s*l,x=r[0],A=r[1],y=r[2];return t[0]=(1-(d+h))*x,t[1]=(p+M)*x,t[2]=(m-b)*x,t[3]=0,t[4]=(p-M)*A,t[5]=(1-(f+h))*A,t[6]=(g+v)*A,t[7]=0,t[8]=(m+b)*y,t[9]=(g-v)*y,t[10]=(1-(f+d))*y,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var yt,Lt=function(t,e,n,r,a){var o,i=1/Math.tan(e/2);return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(o=1/(r-a),t[10]=(a+r)*o,t[14]=2*a*r*o):(t[10]=-1,t[14]=-2*r),t};function Rt(t,e,n,r,a,o,i){var s=1/(e-n),c=1/(r-a),u=1/(o-i);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*s,t[13]=(a+r)*c,t[14]=(i+o)*u,t[15]=1,t}function Et(t,e,n,r){var a,o,i,s,c,u,l,f,p,m,d=e[0],g=e[1],h=e[2],v=r[0],b=r[1],M=r[2],x=n[0],A=n[1],y=n[2];return Math.abs(d-x)<ct&&Math.abs(g-A)<ct&&Math.abs(h-y)<ct?ft(t):(l=d-x,f=g-A,p=h-y,a=b*(p*=m=1/Math.hypot(l,f,p))-M*(f*=m),o=M*(l*=m)-v*p,i=v*f-b*l,(m=Math.hypot(a,o,i))?(a*=m=1/m,o*=m,i*=m):(a=0,o=0,i=0),s=f*i-p*o,c=p*a-l*i,u=l*o-f*a,(m=Math.hypot(s,c,u))?(s*=m=1/m,c*=m,u*=m):(s=0,c=0,u=0),t[0]=a,t[1]=s,t[2]=l,t[3]=0,t[4]=o,t[5]=c,t[6]=f,t[7]=0,t[8]=i,t[9]=u,t[10]=p,t[11]=0,t[12]=-(a*d+o*g+i*h),t[13]=-(s*d+c*g+u*h),t[14]=-(l*d+f*g+p*h),t[15]=1,t)}function Pt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function wt(t,e){var n=e[0],r=e[1],a=e[2],o=n*n+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function Ft(t,e,n){var r=e[0],a=e[1],o=e[2],i=n[0],s=n[1],c=n[2];return t[0]=a*c-o*s,t[1]=o*i-r*c,t[2]=r*s-a*i,t}function _t(t,e,n,r){var a=e[0],o=e[1],i=e[2];return t[0]=a+r*(n[0]-a),t[1]=o+r*(n[1]-o),t[2]=i+r*(n[2]-i),t}function St(t,e,n){var r=e[0],a=e[1],o=e[2],i=n[3]*r+n[7]*a+n[11]*o+n[15];return i=i||1,t[0]=(n[0]*r+n[4]*a+n[8]*o+n[12])/i,t[1]=(n[1]*r+n[5]*a+n[9]*o+n[13])/i,t[2]=(n[2]*r+n[6]*a+n[10]*o+n[14])/i,t}function Tt(){return new Array(3).fill(0)}function Bt(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function Ct(t){for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],r=t[e+1],a=t[e+2],o=1/Math.sqrt(n*n+r*r+a*a);t[e+0]*=o,t[e+1]*=o,t[e+2]*=o}}function $t(t){const e=[];for(let n=0;n<t.length;n+=9){const r=Tt(),a=Tt(),o=Tt();r[0]=t[n],r[1]=t[n+1],r[2]=t[n+2],a[0]=t[n+3],a[1]=t[n+4],a[2]=t[n+5],o[0]=t[n+6],o[1]=t[n+7],o[2]=t[n+8];const i=Tt();Pt(i,o,a);const s=Tt();Pt(s,r,a);const c=Tt();Ft(c,i,s),wt(c,c),e.push(...c,...c,...c)}return e}yt=new ut(3),ut!=Float32Array&&(yt[0]=0,yt[1]=0,yt[2]=0);const Dt=Math.PI/180;function Nt(t){return t*Dt}function It(){return new Float32Array(16)}function Ut(t){return new Float32Array(t)}var Ot="#version 300 es\r\nprecision mediump float;\r\n\r\n#define SHADER_NAME defaultVertex\r\n    \r\nin vec3 position;\r\nin vec3 normal;\r\nin vec2 uv;\r\n${instances ?\r\n`\r\nin mat4 world;\r\nin mat4 normalMatrix;\r\n` : `\r\nuniform mat4 world;\r\nuniform mat4 normalMatrix;\r\n`}\r\n\r\n\r\nuniform float time;\r\nuniform mat4 view;\r\nuniform mat4 projection;\r\n\r\n// Pass the color attribute down to the fragment shader\r\nout vec3 vertexColor;\r\nout vec3 vNormal;\r\nout vec3 vertex;\r\nout vec3 vViewPosition;\r\nout highp vec2 vUv;\r\n\r\n${declarations}\r\n\r\nvoid main() {\r\n    vec3 modifiedNormal = normal;\r\n    vec3 animatedPosition = position;\r\n    ${positionModifier}\r\n\r\n    vUv = vec3( uv, 1 ).xy;\r\n    // Pass the color down to the fragment shader\r\n    vertexColor = vec3(1.27,1.27,1.27);\r\n    // Pass the vertex down to the fragment shader\r\n    //vertex = vec3(world * vec4(position, 1.0));\r\n    vertex = vec3(world * vec4(animatedPosition, 1.0));\r\n    // Pass the normal down to the fragment shader\r\n    // todo : use modifiedNormal when effect is done\r\n    vNormal = vec3(normalMatrix * vec4(modifiedNormal , 1.0));\r\n    //vNormal = normal;\r\n    \r\n    // Pass the position down to the fragment shader\r\n    gl_Position = projection * view * world * vec4(animatedPosition, 1.0);\r\n    vViewPosition = -gl_Position.xyz;\r\n}";const kt=(t,e)=>{const n=Function.constructor(...Object.entries(e).map((([t,e])=>(""===e&&(e='""'),`${t}${null!=e?`=${e}`:""}`))),`return \`${t}\``);return t=>n(...Object.keys(e).map((e=>null!=t[e]?t[e]:void 0)))};function Yt(t){return Array.isArray(t)?[...t]:"number"==typeof t?Vt(t):"string"==typeof t&&t.startsWith("#")?Vt(parseInt(t.replace("#","0x"))):t}function Vt(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]}function jt(t,e){return 3===e?t:t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Wt(t){return t.map((t=>Math.floor(255*t))).reduce(((t,e)=>t+e.toString(16).padStart(2,"0")),"#")}function zt(t){return"#"+t.toString(16).padStart(6,"0")}function qt(t){return parseInt(t.slice(1),16)}function Ht(t){return[parseInt(t.slice(1,3),16)/255,parseInt(t.slice(3,5),16)/255,parseInt(t.slice(5,7),16)/255]}function Gt(t,e){if(null==t||null==e||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}const Xt=function(){const t=ot({position:[0,0,-1],target:[0,0,0],fov:80,near:.1,far:1e3,up:[0,1,0]}),{subscribe:e,update:n}=t,r=ot(0);function a(t){n((e=>{const n={...e,...t(e)};return r.update((t=>t+1)),n}))}return{subscribe:e,set:function(t){a((e=>t))},update:a,get revision(){return s(r)}}}();function Kt(t){return"matrix"in t}function Jt(t){return"matrices"in t}const Qt=t=>({type:"point",position:[0,0,0],color:[1,1,1],intensity:3,cutoffDistance:5,decayExponent:1,...t,shader:kt("${declaration?\r\n`\r\n\r\nfloat pow4(const in float x) {\r\n    float x2 = x * x;\r\n    return x2 * x2;\r\n}\r\nfloat pow2(const in float x) {\r\n    return x * x;\r\n}\r\n\r\nfloat saturate(const in float a) {\r\n    return clamp(a, 0.0f, 1.0f);\r\n}\r\n\r\nstruct LightParams {\r\n    vec3 irradiance;\r\n    vec3 direction;\r\n    vec3 color;\r\n    float distance;\r\n};\r\n\r\nstruct PointLight {\r\n    vec3 position;\r\n    vec3 color;\r\n    float cutoffDistance;\r\n    float decayExponent;\r\n};\r\n\r\nlayout(std140) uniform PointLights {\r\n    PointLight pointLights[NUM_POINT_LIGHTS];\r\n};\r\n\r\nfloat getDistanceAttenuation(const in float lightDistance, const in float cutoffDistance, const in float decayExponent) {\r\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\r\n\t// page 32, equation 26: E[window1]\r\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\r\n    float distanceFalloff = 1.0f / max(pow(lightDistance, decayExponent), 0.01f);\r\n    if(cutoffDistance > 0.0f) {\r\n        distanceFalloff *= pow2(saturate(1.0f - pow4(lightDistance / cutoffDistance)));\r\n    }\r\n    return distanceFalloff;\r\n\r\n}\r\n\r\nLightParams getDirectDiffuse(const in PointLight pointLight,const in vec3 vertexPosition, const in vec3 normal,const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\r\n    LightParams lightParams = LightParams(vec3(0.0f), vec3(0.0f), vec3(0.0f), 0.0f);\r\n    vec3 lVector = pointLight.position - vertexPosition;\r\n    lightParams.distance = length(lVector);\r\n    lightParams.direction = normalize(lVector);\r\n    float dotNL = saturate(dot(normal, lightParams.direction));\r\n    lightParams.color = pointLight.color;\r\n    lightParams.color *= getDistanceAttenuation(lightParams.distance, pointLight.cutoffDistance, pointLight.decayExponent);\r\n    lightParams.irradiance = dotNL * lightParams.color;\r\n    \r\n    reflectedLight.directDiffuse += lightParams.irradiance * BRDF_Lambert(material.diffuseColor);\r\n    return lightParams;\r\n}\r\n\r\nfloat calculatePointLightBrightness(float lightDistance, float cutoffDistance, float decayExponent) {\r\n    return getDistanceAttenuation(lightDistance, cutoffDistance, decayExponent);\r\n}\r\n` : ''\r\n}\r\n${irradiance?\r\n`\r\n    vec3 irradiance = vec3(0.0f);\r\n    vec3 direction = vec3(0.0f);\r\n    for(int i = 0; i < NUM_POINT_LIGHTS; i++) {\r\n        PointLight pointLight = pointLights[i];\r\n        \r\n\r\n        LightParams lightParams = getDirectDiffuse(pointLight, vertex, normal, material, reflectedLight);\r\n        totalIrradiance += reflectedLight.directDiffuse;\r\n        ${specularIrradiance}\r\n    }\r\n` : ''\r\n}\r\n",{declaration:!1,irradiance:!1,specularIrradiance:""}),setupLights:re,updateOneLight:ae});let Zt=null;const te=t=>{Zt=t},ee=()=>Zt;function ne(t,e,n){e.preMultipliedColor=[...e.color],Bt(e.preMultipliedColor,e.intensity),t[n]=e.position[0],t[n+1]=e.position[1],t[n+2]=e.position[2],t[n+4]=e.preMultipliedColor[0],t[n+5]=e.preMultipliedColor[1],t[n+6]=e.preMultipliedColor[2],t[n+7]=e.cutoffDistance,t[n+8]=e.decayExponent,t[n+9]=0,t[n+10]=0,t[n+11]=0,t[n+12]=0}function re(t){return function(){const{gl:e,program:n}=Ae;ee()||function(t){const{gl:e}=Ae,n=t.length,r=new Float32Array(12*n);for(let e=0;e<n;e++)ne(r,s(t[e]),12*e);const a=e.createBuffer();te(a),e.bindBufferBase(e.UNIFORM_BUFFER,Pe,a),e.bufferData(e.UNIFORM_BUFFER,r,e.DYNAMIC_DRAW)}(t);const r=e.getUniformBlockIndex(n,"PointLights");e.uniformBlockBinding(n,r,Pe)}}function ae(t,e){const{gl:n}=Ae,r=t.filter((t=>"point"===s(t).type)).findIndex((t=>t===e)),a=ee();if(-1!==r){const t=new Float32Array(12),o=12*r;ne(t,s(e),0),n.bindBuffer(n.UNIFORM_BUFFER,a),n.bufferSubData(n.UNIFORM_BUFFER,o*Float32Array.BYTES_PER_ELEMENT,t)}}const oe=t=>{const e=ot(t),{subscribe:n,set:r}=e,a={subscribe:n,set:t=>{r(t),ae(s(ie),a),ie.set(s(ie))}};return a};const ie=function(){const t=ot([]),{subscribe:e,set:n}=t,r=ot(0);return{subscribe:e,set:t=>{n(t),r.update((t=>t+1))},get revision(){return s(r)}}}(),se=it([ie],(([t])=>t.length));function ce(t){const e=ot(t),{subscribe:n,set:r,update:a}=e;return{subscribe:n,set:t=>{r(t),ue.set(s(ue)),st.set(s(st))},update:a}}const ue=function(){const t=ot([]),{subscribe:e,set:n,update:r}=t,a=ot(0);return{subscribe:e,set:t=>{n(t),a.update((t=>t+1))},update:r,get revision(){return s(a)}}}(),le=ot([]);function fe(t){return t?.opacity<1||t?.transparent}function pe(t,e){return(fe(t.material)?1:-1)-(fe(e.material)?1:-1)}function me(t){if(0===t.length||null==s(he).canvas)return t;let e=!1;const n=s(he).canvas,{projection:r,view:a}=We(s(Xt),n.width,n.height),o=dt(It(),r,a);t.forEach((t=>{(e||fe(t.material))&&(e=!0,t.meshes.forEach(((t,e)=>{const n=xt(Tt(),t.matrix);t.clipSpacePosition=St(Tt(),n,o)})),t.meshes=t.meshes.sort(((t,e)=>e.clipSpacePosition[2]-t.clipSpacePosition[2])))}));return t.sort(((t,e)=>null==t.material||null==e.material||null==t.meshes[0].clipSpacePosition||null==e.meshes[0].clipSpacePosition?0:e.meshes[0].clipSpacePosition[2]-t.meshes[0].clipSpacePosition[2]))}const de=it([st,se,ue,le],(([t,e,n,r])=>{let a=r.filter((t=>t.order<0)).reduce(((t,e)=>t.concat(...e.programs)),[]).map((e=>({...e,...e.updateProgram?{}:{updateProgram:[]},...e.allMeshes?{meshes:t}:{}}))),o=r.filter((t=>t.order>0)).reduce(((t,e)=>t.concat(...e.programs)),[]).map((e=>({...e,...e.updateProgram?{}:{updateProgram:[]},...e.allMeshes?{meshes:t}:{}})));const i=new Set(t.filter((t=>Jt(t)||t.animations?.some((t=>"vertex"===t.type))))),c=me(Array.from(n).reduce(((e,n)=>{const r=t.filter((t=>t.material===n)),{currentNormalMeshes:a,currentSpecialMeshes:o}=r.reduce(((t,e)=>(i.has(e)?t.currentSpecialMeshes.push(e):t.currentNormalMeshes.push(e),t)),{currentNormalMeshes:[],currentSpecialMeshes:[]});return a.length>0&&e.push({material:s(n),meshes:a}),o.forEach((t=>{const r=t.animations?.some((t=>t.requireTime));e.push({requireTime:r,material:s(n),meshes:[t]})})),e}),[]).sort(pe)),u=e;let l;u>0&&(l=s(s(ie)[0]).shader);const f=[...a,...c.map(((t,e)=>{if(t.material.program)return t.material.program.meshes=t.meshes,be(t,t.material.program),t.material.program;const n=0===e,r={...t,useProgram:Ue,setupProgram:null,setFrameBuffer:null,setupMaterial:[je],updateProgram:[],bindTextures:[],createProgram:De,selectProgram:Me,setupCamera:void 0};return be(t,r),r.setupProgram=[Ye(t.material,t.meshes,u,l),Ne,Ie],n&&(r.setFrameBuffer=ke),t.material?.specular&&r.setupMaterial.push(t.material.specular.setupSpecular),t.material?.diffuseMap&&(r.setupMaterial.push(t.material.diffuseMap.setupTexture),r.bindTextures.push(t.material.diffuseMap.bindTexture)),t.material?.normalMap&&(r.setupMaterial.push(t.material.normalMap.setupTexture),r.bindTextures.push(t.material.normalMap.bindTexture)),t.material?.roughnessMap&&(r.setupMaterial.push(t.material.roughnessMap.setupTexture),r.bindTextures.push(t.material.roughnessMap.bindTexture)),t.requireTime&&r.updateProgram.push(Be),r.setupMaterial.push(...Array.from(s(ie).reduce(((t,e)=>{const n=s(e);return t.has(n.setupLights)?t.set(n.setupLights,[...t.get(n.setupLights),e]):t.set(n.setupLights,[e]),t}),new Map)).map((([t,e])=>t(e)))),r})),...o];return function(t){const{programMap:e,vaoMap:n}=Ae;e.forEach(((r,a)=>{t.some((t=>t.material===a.material))||(e.delete(a),n.delete(a))})),t.forEach((t=>{let r;if(e.forEach(((e,n)=>{n.material===t.material&&(r=n)})),null!=r){const e=n.get(r);e.forEach(((n,r)=>{t.meshes.includes(r)||e.delete(r)}))}}))}(f),f}));function ge(){return s(de).filter((t=>0!==t.meshes?.length&&!0!==t.allMeshes))}const he=function(){const t={canvas:null,loop:null,backgroundColor:16777215,ambientLightColor:[16777215,0],toneMappings:[],enabled:!1};let e=t,n=new Map;const r=ot(t),{subscribe:a,update:o}=r,i=ot(0);function c(t){o((r=>{const a=t(r);var o;if(i.update((t=>t+1)),null!=e.canvas&&a.canvas!==e.canvas&&a.canvas,null!=e.loop&&a.loop!==e.loop&&a.loop,a.backgroundColor!==e.backgroundColor&&(o=a.backgroundColor,n.set("backgroundColor",[...Yt(o),1])),!Gt(a.ambientLightColor,e.ambientLightColor)){!function([t,e]){n.set("ambientLightColor",Yt(t).map((t=>t*e)))}(a.ambientLightColor);const t=ge();t&&t.forEach((t=>{je(Ae.programMap.get(t),n.get("ambientLightColor"))}))}return Gt(a.toneMappings,e.toneMappings)||a.toneMappings,a.enabled!==e.enabled&&a.enabled,e=a,a}))}return{subscribe:a,set:function(t){c((e=>t))},update:c,get processed(){const t=s(r);return Object.entries(t).map((([t,e])=>n.has(t)?[t,n.get(t)]:[t,e])).reduce(((t,[e,n])=>(t[e]=n,t)),{})},get revision(){return s(i)}}}(),ve=ot({init:!1});function be(t,e){const{programMap:n,vaoMap:r}=Ae;let a,o;if(n.forEach(((e,n)=>{n.material===t.material&&(a=n,o=e)})),null!=a){const t=r.get(a);null!=t&&(r.delete(a),r.set(e,t)),n.delete(a),n.set(e,o)}}function Me(t){return Ae.existingProgram=!0,function(){const{programMap:e}=Ae,n=e.get(t);Ae.program=n}}function xe(t,e){return function(){const{vaoMap:n}=Ae,r=n.get(t).get(e);Ae.vao=r}}let Ae={programMap:new Map,vaoMap:new Map,gl:null,program:null,vao:null,canvas:null,backgroundColor:null,ambientLightColor:null,toneMappings:null,existingProgram:!1};const ye=[],Le=new Map;Le.set(he,0),Le.set(st,0),Le.set(Xt,0),Le.set(ue,0),Le.set(ie,0);const Re=ot(0),Ee=it([he,de,Xt,Re],(([t,e,n,r])=>{if(!t.enabled||4===r||1===r||0===e.length)return ye;const a=function(){const t=new Set;return Le.get(he)!==he.revision&&t.add(he),Le.get(st)!==st.revision&&t.add(st),Le.get(Xt)!==Xt.revision&&t.add(Xt),Le.get(ue)!==ue.revision&&t.add(ue),Le.get(ie)!==ie.revision&&t.add(ie),Le.set(he,he.revision),Le.set(st,st.revision),Le.set(Xt,Xt.revision),Le.set(ue,ue.revision),Le.set(ie,ie.revision),t}();if(0===a.size&&2!==r&&!e.some((t=>"requireTime"in t)))return ye;const o=he.processed;let i={canvas:t.canvas,backgroundColor:o.backgroundColor,ambientLightColor:o.ambientLightColor,...t.toneMappings.length>0?{toneMappings:t.toneMappings}:void 0};const c=[];Ae={...Ae,...i};s(ve).init||c.push(Fe);const u=me(e);let l=!1;return c.push(Te),c.push(...u.reduce(((t,e)=>(Ae.existingProgram=!1,fe(e.material)&&!l&&(l=!0,t.push(Se)),[...t,...Ae.programMap.has(e)?[e.selectProgram(e),e.useProgram,...e.bindTextures?[...e.bindTextures]:[],...e.updateProgram]:[e.createProgram(e),...e.setupProgram,e.useProgram,...e.setupMaterial,...e.updateProgram],...e.setupCamera?[e.setupCamera(n)]:[...a.has(Xt)||!Ae.existingProgram?[ze(n)]:[]],...e.setFrameBuffer?[e.setFrameBuffer]:[],...e.meshes.reduce(((t,n)=>[...t,...Ae.vaoMap.has(e)&&Ae.vaoMap.get(e).has(n)?[xe(e,n),...Kt(n)?[qe(e,n,n.matrix),Ge(e,n)]:[]]:[Je(e,n),...e.material?[Ve(e.material)]:[],qe(e,n,Kt(n)?n.matrix:n.matrices,n.instances),Ge(e,n,n.instances),...n.animations?.map((t=>t.setupAnimation))||[]],...null!=n.matrix?[...Jt(n)?[_e(mt(s(n.matrices[0]))>0)]:[_e(mt(s(n.matrix))>0)]]:[],$e,Ce(n,n.instances,n.drawMode)]),[]),...e.postDraw?[e.postDraw]:[]])),[])),c}),ye);it([Ee],(([t])=>{if(0===t.length)return 0;if(!s(ve).init&&0===s(Re))return Re.set(1),t.forEach((t=>{t()})),ve.set({init:!0}),Re.set(2),1;if(2===s(Re))return Re.set(3),requestAnimationFrame((async function t(){Re.set(4);const e=s(he);e.loop&&e.loop(),Re.set(3),s(Ee).forEach((t=>{t()})),Re.set(4),requestAnimationFrame(t)})),2})).subscribe((t=>{}));const Pe=0,we=Math.PI/180;function Fe(){const t=Ae.canvas.getBoundingClientRect();Ae.canvas.width=t.width,Ae.canvas.height=t.height;const e=Ae.canvas.getContext("webgl2");Ae.gl=e,e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.frontFace(e.CCW),e.cullFace(e.BACK)}function _e(t=!0){return function(){const{gl:e}=Ae;e.frontFace(t?e.CCW:e.CW)}}function Se(){const{gl:t}=Ae;t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)}function Te(){const{gl:t}=Ae;t.disable(t.BLEND)}function Be(){const{gl:t,program:e}=Ae,n=t.getUniformLocation(e,"time");t.uniform1f(n,performance.now())}function Ce(t,e,n){return function(){const{gl:r,program:a}=Ae,o=t.attributes.positionsSize??3,i=t.attributes.elements?t.attributes.elements.length:t.attributes.positions.length/o;e?t.attributes.elements?r.drawElementsInstanced(r[n],i,r.UNSIGNED_SHORT,0,e):r.drawArraysInstanced(r[n],0,i,e):t.attributes.elements?r.drawElements(r[n],i,r.UNSIGNED_SHORT,0):r.drawArrays(r[n],0,i),r.bindVertexArray(null)}}function $e(){const{gl:t,vao:e}=Ae;t.bindVertexArray(e)}function De(t){return function(){const{gl:e}=Ae,n=e.createProgram();Ae.programMap.set(t,n),Ae.vaoMap.set(t,new Map),Ae.program=n}}function Ne(){const{gl:t,program:e}=Ae;t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)||console.error("ERROR linking program!",t.getProgramInfoLog(e))}function Ie(){const{gl:t,program:e}=Ae;t.validateProgram(e),t.getProgramParameter(e,t.VALIDATE_STATUS)||console.error("ERROR validating program!",t.getProgramInfoLog(e))}function Ue(){const{gl:t,program:e}=Ae;t.useProgram(e)}function Oe(){const{gl:t}=Ae;t.viewport(0,0,t.canvas.width,t.canvas.height)}function ke(){const{gl:t,backgroundColor:e}=Ae;t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,t.canvas.width,t.canvas.height),Ae.frameBufferWidth=t.canvas.width,Ae.frameBufferHeight=t.canvas.height,t.clearColor(...e),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}function Ye(t,e,n,r){return function(){const{gl:a,program:o}=Ae;let i="",s="",c="",u="";const[l]=e,f=l.animations?.filter((({type:t})=>"vertex"===t));f?.length>0&&(c+=f.reduce(((t,e)=>t+e.shader({declaration:!0})),""),u+=f.reduce(((t,e)=>t+e.shader({position:!0})),""),i+=c,s+=u);const p=kt(Ot,{instances:!1,declarations:"",positionModifier:""})({instances:l.instances>1,declarations:i,positionModifier:s}),m=a.createShader(a.VERTEX_SHADER);a.shaderSource(m,p),a.compileShader(m),a.getShaderParameter(m,a.COMPILE_STATUS)||console.error("ERROR compiling vertex shader!",a.getShaderInfoLog(m));let d="",g="";t.specular&&(g=t.specular.shader({declaration:!0}),d=t.specular.shader({irradiance:!0}));let h="",v="";t.diffuseMap&&(h=t.diffuseMap.shader({declaration:!0,declarationNormal:!1,mapType:t.diffuseMap.type}),v=t.diffuseMap.shader({diffuseMapSample:!0,mapType:t.diffuseMap.type,coordinateSpace:t.diffuseMap.coordinateSpace}));let b="",M="";t.normalMap&&(b=t.normalMap.shader({declaration:!0,declarationNormal:!0,mapType:t.normalMap.type}),M=t.normalMap.shader({normalMapSample:!0,mapType:t.normalMap.type}));let x="",A="";t.roughnessMap&&(x=t.roughnessMap.shader({declaration:!0,declarationNormal:!1,mapType:t.roughnessMap.type}),A=t.roughnessMap.shader({roughnessMapSample:!0,mapType:t.roughnessMap.type}));const y=kt("#version 300 es\r\nprecision mediump float;\r\n\r\n#define SHADER_NAME defaultFragment\r\n\r\n${defines}\r\n\r\n#define RECIPROCAL_PI 0.3183098861837907\r\n\r\nuniform vec3 diffuse;\r\nuniform float opacity;\r\nuniform float metalness;\r\nuniform vec3 ambientLightColor;\r\nuniform vec3 cameraPosition;\r\n//uniform mat3 normalMatrix;\r\n\r\nin vec3 vertex;\r\nin vec3 vNormal;\r\nin highp vec2 vUv;\r\nin vec3 vViewPosition;\r\n\r\nout vec4 fragColor;\r\n\r\nstruct ReflectedLight {\r\n\tvec3 directDiffuse;\r\n\tvec3 directSpecular;\r\n\tvec3 indirectDiffuse;\r\n\tvec3 indirectSpecular;\r\n};\r\n\r\nstruct PhysicalMaterial {\r\n\tvec3 diffuseColor;\r\n\tfloat diffuseAlpha;\r\n\tfloat roughness;\r\n\tvec3 specularColor;\r\n\tfloat specularF90;\r\n\tfloat ior;\r\n};\r\n\r\nvec3 BRDF_Lambert(const in vec3 diffuseColor) {\r\n\treturn RECIPROCAL_PI * diffuseColor;\r\n}\r\n\r\n\r\n${declarations}\r\n\r\nvec4 sRGBTransferOETF(in vec4 value) {\r\n\treturn vec4(mix(pow(value.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), value.rgb * 12.92, vec3(lessThanEqual(value.rgb, vec3(0.0031308)))), value.a);\r\n}\r\n\r\nvec4 linearToOutputTexel(vec4 value) {\r\n\treturn (sRGBTransferOETF(value));\r\n}\r\n\r\nvoid main() {\r\n    PhysicalMaterial material;\r\n\tmaterial.diffuseAlpha = 1.0;\r\n\tmaterial.diffuseColor = diffuse.rgb * (1.0 - metalness);\r\n\t${diffuseMapSample}\r\n\t\r\n\r\n\tvec3 normal = normalize( vNormal );\r\n\t${normalMapSample}\r\n\t${roughnessMapSample}\r\n\r\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\r\n\r\n    reflectedLight.indirectDiffuse += ambientLightColor * BRDF_Lambert(material.diffuseColor);\r\n\r\n    vec3 totalIrradiance = vec3(0.0f);\r\n    ${irradiance}\r\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse + reflectedLight.directDiffuse + reflectedLight.directSpecular;\r\n    fragColor = vec4(outgoingLight, opacity*material.diffuseAlpha);\r\n    //fragColor = vec4(totalIrradiance, 1.0f);\r\n    ${toneMapping}\r\n\tfragColor = linearToOutputTexel(fragColor);\r\n}",{defines:"",declarations:"",diffuseMapSample:"",normalMapSample:"",roughnessMapSample:"",irradiance:"",toneMapping:"",numPointLights:0})({defines:(L={...n?{NUM_POINT_LIGHTS:n}:void 0},["",...Object.entries(L).map((([t,e])=>`#define ${t} ${e}`))].join("\n")),declarations:[...n?[r({declaration:!0,irradiance:!1})]:[],...Ae.toneMappings?.length>0?[...Ae.toneMappings.map((t=>t.shader({declaration:!0,exposure:t.exposure})))]:[],...t.specular?[g]:[],...t.diffuseMap?[h]:[],...t.normalMap?[b]:[],...t.roughnessMap?[x]:[]].join("\n"),diffuseMapSample:v,normalMapSample:M,roughnessMapSample:A,irradiance:[...n?[r({declaration:!1,irradiance:!0,specularIrradiance:d})]:[]].join("\n"),toneMapping:[...Ae.toneMappings?.length>0?[...Ae.toneMappings.map((t=>t.shader({color:!0})))]:[]].join("\n"),numPointLights:n});var L;const R=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(R,y),a.compileShader(R),a.getShaderParameter(R,a.COMPILE_STATUS)||console.error("ERROR compiling fragment shader!",a.getShaderInfoLog(R)),a.attachShader(o,m),a.attachShader(o,R)}}function Ve({diffuse:t,metalness:e,opacity:n}){return function(){const{gl:r,program:a}=Ae,o=r.getUniformLocation(a,"diffuse");if(null==o)return;r.uniform3fv(o,new Float32Array(t.map(jt))),null==e&&console.log("metalness is null, material won't display correctly");const i=r.getUniformLocation(a,"metalness");r.uniform1f(i,e);const s=r.getUniformLocation(a,"opacity");r.uniform1f(s,n??1)}}function je(t,e){const{gl:n,program:r,ambientLightColor:a}=Ae,o=t??r,i=e??a,s=n.getUniformLocation(o,"ambientLightColor");n.uniform3fv(s,new Float32Array(i))}function We(t,e,n){return{projection:Lt(It(),(r=t.fov,r*we),e/n,t.near,t.far),view:Et(It(),t.position,t.target,t.up)};var r}function ze(t){return function(){const{gl:e,program:n,canvas:r}=Ae,{projection:a,view:o}=We(t,r.width,r.height),i=e.getUniformLocation(n,"projection");e.uniformMatrix4fv(i,!1,a);const s=e.getUniformLocation(n,"view");e.uniformMatrix4fv(s,!1,o);const c=e.getUniformLocation(n,"cameraPosition");e.uniform3fv(c,t.position)}}function qe(t,e,n,r){return null==r?function(){const{gl:t,program:e}=Ae,r=t.getUniformLocation(e,"world");null!=r&&(n||(n=ft(It())),t.uniformMatrix4fv(r,!1,s(n)))}:function(){if(null==n)return;const{gl:a,program:o,vaoMap:i}=Ae;let c;c=null==Ae.transformMatricesWindows?[]:Ae.transformMatricesWindows;const u=n.reduce(((t,e)=>[...t,...s(e)]),[]),l=new Float32Array(u);for(let t=0;t<r;++t){const e=16*t*4,n=16;c.push(new Float32Array(l.buffer,e,n))}const f=i.get(t).get(e);a.bindVertexArray(f);const p=a.createBuffer();var m;m={matrixBuffer:p,transformMatricesWindows:c},Ae={...Ae,...m};const d=a.getAttribLocation(o,"world");a.bindBuffer(a.ARRAY_BUFFER,p),a.bufferData(a.ARRAY_BUFFER,l.byteLength,a.DYNAMIC_DRAW);for(let t=0;t<4;++t){const e=d+t;a.enableVertexAttribArray(e);const n=16*t;a.vertexAttribPointer(e,4,a.FLOAT,!1,64,n),a.vertexAttribDivisor(e,1)}a.bufferSubData(a.ARRAY_BUFFER,0,l),a.bindVertexArray(null)}}function He(t,e,n,r){const{gl:a,vaoMap:o,matrixBuffer:i}=Ae;a.bindVertexArray(o.get(t).get(e)),a.bindBuffer(a.ARRAY_BUFFER,i);a.bufferSubData(a.ARRAY_BUFFER,64*r,n),a.bindVertexArray(null),function(t,e,n,r){const{gl:a,vaoMap:o,normalMatrixBuffer:i}=Ae;a.bindVertexArray(o.get(t).get(e)),a.bindBuffer(a.ARRAY_BUFFER,i);const s=64;a.bufferSubData(a.ARRAY_BUFFER,r*s,n),a.bindVertexArray(null)}(t,e,Xe(n),r)}function Ge(t,e,n){return null==n?function(){const{gl:t,program:n}=Ae,r=t.getUniformLocation(n,"normalMatrix");if(null==r)return;const a=Xe(s(e.matrix));t.uniformMatrix4fv(r,!1,a)}:function(){const{gl:r,program:a,vaoMap:o,transformMatricesWindows:i}=Ae,s=r.getAttribLocation(a,"normalMatrix");if(null==s)return;const c=o.get(t).get(e);r.bindVertexArray(c);const u=[];for(let t=0;t<n;t++)u.push(...Xe(i[t]));const l=new Float32Array(u),f=r.createBuffer();Ae.normalMatrixBuffer=f,r.bindBuffer(r.ARRAY_BUFFER,f),r.bufferData(r.ARRAY_BUFFER,l.byteLength,r.DYNAMIC_DRAW),r.bufferSubData(r.ARRAY_BUFFER,0,l);for(let t=0;t<4;++t){const e=s+t;r.enableVertexAttribArray(e);const n=16*t;r.vertexAttribPointer(e,4,r.FLOAT,!1,64,n),r.vertexAttribDivisor(e,1)}r.bindVertexArray(null)}}function Xe(t){const e=lt();return pt(e,t),function(t,e){if(t===e){var n=e[1],r=e[2],a=e[3],o=e[6],i=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=a,t[13]=i,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(e,e),e}function Ke(t){let e,n;t.data?(e=t.data,n=t.interleaved):e=t;return{data:e.buffer&&e.buffer instanceof ArrayBuffer?e:new Float32Array(e),interleaved:n,...n?{byteStride:t.byteStride,byteOffset:t.byteOffset}:{}}}function Je(t,e){return function(){const{gl:n,program:r,vaoMap:a}=Ae,{positions:o,normals:i,elements:s,uvs:c,positionsSize:u}=e.attributes;let l;a.has(t)&&a.get(t).has(e)?l=a.get(t).get(e):(l=n.createVertexArray(),a.get(t).set(e,l)),Ae.vao=l,n.bindVertexArray(l);const{data:f,interleaved:p,byteStride:m,byteOffset:d}=Ke(o),g=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,g),n.bufferData(n.ARRAY_BUFFER,f,n.STATIC_DRAW);const h=n.getAttribLocation(r,"position");n.bindBuffer(n.ARRAY_BUFFER,g);const v=null!=u?u:3;if(n.vertexAttribPointer(h,v,n.FLOAT,!1,m,d),n.enableVertexAttribArray(h),e.attributes.normals){const{data:t,interleaved:e,byteStride:a,byteOffset:o}=Ke(i);if(!e){const e=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,e),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,e)}const s=n.getAttribLocation(r,"normal");-1!=s&&(n.vertexAttribPointer(s,3,n.FLOAT,!1,a,o),n.enableVertexAttribArray(s))}if(e.attributes.elements){const t=new Uint16Array(e.attributes.elements),r=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)}if(e.attributes.uvs){const t=new Float32Array(e.attributes.uvs),a=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,a),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW);const o=n.getAttribLocation(r,"uv");-1!=o&&(n.bindBuffer(n.ARRAY_BUFFER,a),n.vertexAttribPointer(o,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(o))}n.bindVertexArray(null)}}const Qe=It();ft(Qe);const Ze=(t,e,n,r=NaN)=>{const{subscribe:a,set:o}=ot(n||Qe);return{subscribe:a,set:n=>{o(n);const a=function(t){return s(de).find((e=>!0!==e.allMeshes&&e.meshes.includes(t)))}(t);isNaN(r)?(function(t,e){const{gl:n,programMap:r}=Ae,a=r.get(t),o=n.getUniformLocation(a,"world");n.useProgram(a),n.uniformMatrix4fv(o,!1,e)}(a,n),function(t,e){const{gl:n,programMap:r}=Ae,a=r.get(t),o=n.getUniformLocation(a,"normalMatrix");n.uniformMatrix4fv(o,!1,Xe(e))}(a,n)):He(a,t,n,r),e(s(he))}}};function tn(t,e=!1,n=[0,0,0]){e&&console.log("symmetry");const r={...t};return Kt(r)?r.matrix=Ze(r,he.set,r.matrix):Jt(r)&&(r.matrices=r.matrices.map(((t,e)=>Ze(r,he.set,t,e)))),r}const en=8900331,nn={0:"POINTS",1:"LINES",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN"};function rn(t,e){let n,r;function a(e){let a="mousemove",o="mouseup",s=e;"touchstart"===e.type&&(a="touchmove",o="touchend",s=e.touches[0]),t.addEventListener(a,i,{passive:!1}),n=s.clientX,r=s.clientY,t.addEventListener(o,u,{passive:!1}),e.preventDefault(),e.stopPropagation()}function o(t,e){const n=Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2));return{radius:n,polar:Math.acos(Math.max(-1,Math.min(1,(t[1]-e[1])/n))),azimuth:Math.atan2(t[0]-e[0],t[2]-e[2])}}function i(t){let a=t;"touchmove"===t.type&&(a=t.touches[0]);const i=a.clientX-n,u=a.clientY-r,l=s(e),{position:f,target:p,fov:m}=l,{radius:d,polar:g,azimuth:h}=o(f,p),v=c(d,Math.max(.01,Math.min(Math.PI-.01,g-u/100)),h-i/100);v[0]=v[0]+p[0],v[1]=v[1]+p[1],v[2]=v[2]+p[2],e.set({position:v,target:p,fov:m}),n=a.clientX,r=a.clientY}function c(t,e,n){const r=Math.sin(e)*t;return[r*Math.sin(n),Math.cos(e)*t,r*Math.cos(n)]}function u(e){let n="mousemove",r="mouseup";"touchend"===e.type&&(n="touchmove",r="touchend"),t.removeEventListener(n,i,{passive:!1}),t.removeEventListener(r,u,{passive:!1})}t.addEventListener("touchstart",a,{passive:!1}),t.addEventListener("mousedown",a,{passive:!1}),t.addEventListener("wheel",(function(t){const n=s(e),{position:r,target:a,fov:i}=n,{radius:u,polar:l,azimuth:f}=o(r,a),p=c(u+.001*t.deltaY*u,l,f);p[0]=p[0]+a[0],p[1]=p[1]+a[1],p[2]=p[2]+a[2],e.set({position:p,target:a,fov:i})}),{passive:!1})}function an(t){v(t,"svelte-7mcxv8","button.svelte-7mcxv8.svelte-7mcxv8{position:relative;font-family:Arial;font-size:20px;padding:10px}ul.svelte-7mcxv8.svelte-7mcxv8{position:relative;display:none;font-family:Arial;font-size:20px}li.svelte-7mcxv8.svelte-7mcxv8{padding:10px;background-color:white;width:fit-content}li.svelte-7mcxv8 a.svelte-7mcxv8{text-decoration:none;color:black}.menuOpened.svelte-7mcxv8.svelte-7mcxv8{display:block}.current.svelte-7mcxv8.svelte-7mcxv8{color:red}")}function on(t,e,n){const r=t.slice();return r[3]=e[n],r}function sn(e){let n,r,a,o=e[3].name+"";return{c(){n=A("li"),r=A("a"),a=y(o),P(r,"href",e[3].href),P(r,"class","svelte-7mcxv8"),P(n,"class","svelte-7mcxv8")},m(t,e){b(t,n,e),h(n,r),h(r,a)},p:t,d(t){t&&M(n)}}}function cn(e){let n;return{c(){n=A("li"),n.textContent=`${e[3].name}`,P(n,"class","current svelte-7mcxv8")},m(t,e){b(t,n,e)},p:t,d(t){t&&M(n)}}}function un(t){let e;let n=function(t,e){return window.location.pathname===t[3].href.substring(1)?cn:sn}(t),r=n(t);return{c(){r.c(),e=R()},m(t,n){r.m(t,n),b(t,e,n)},p(t,e){r.p(t,e)},d(t){t&&M(e),r.d(t)}}}function ln(e){let n,r,a,o,i,s=J(e[2]),c=[];for(let t=0;t<s.length;t+=1)c[t]=un(on(e,s,t));return{c(){n=A("button"),n.textContent="examples",r=L(),a=A("ul");for(let t=0;t<c.length;t+=1)c[t].c();P(n,"class","svelte-7mcxv8"),P(a,"class","svelte-7mcxv8"),F(a,"menuOpened",e[0])},m(t,s){b(t,n,s),b(t,r,s),b(t,a,s);for(let t=0;t<c.length;t+=1)c[t]&&c[t].m(a,null);o||(i=E(n,"click",e[1]),o=!0)},p(t,[e]){if(4&e){let n;for(s=J(t[2]),n=0;n<s.length;n+=1){const r=on(t,s,n);c[n]?c[n].p(r,e):(c[n]=un(r),c[n].c(),c[n].m(a,null))}for(;n<c.length;n+=1)c[n].d(1);c.length=s.length}1&e&&F(a,"menuOpened",t[0])},i:t,o:t,d(t){t&&(M(n),M(r),M(a)),x(c,t),o=!1,i()}}}function fn(t,e,n){let r=!1;return[r,function(){n(0,r=!r)},[{name:"Normal map and specular",href:"./golf-ball"},{name:"GLTF loader",href:"./"},{name:"Obj loader",href:"./venus"},{name:"Cube",href:"./cube"},{name:"rock",href:"./rock"},{name:"GLTF",href:"./gltf"},{name:"Contact Shadow",href:"./contact-shadow"},{name:"Transparency",href:"./transparency"},{name:"Instances",href:"./instances"},{name:"Matrix",href:"./matrix"},{name:"Texture",href:"./texture"},{name:"Lights",href:"./lights"},{name:"Vertex Animation",href:"./vertex-anim"},{name:"Scene Update",href:"./scene-update"},{name:"Skybox HDR",href:"./skybox"},{name:"Skybox  Cube Map",href:"./skybox-cube"}]]}class pn extends rt{constructor(t){super(),nt(this,t,fn,ln,o,{},an)}}export{dt as $,g as A,en as B,oe as C,Qt as D,tn as E,rn as F,D as G,ce as H,Ft as I,Pt as J,wt as K,nn as L,pn as M,bt as N,vt as O,s as P,Ut as Q,Ae as R,rt as S,xt as T,Tt as U,Rt as V,Et as W,Ne as X,Ie as Y,Ue as Z,Me as _,L as a,At as a0,$t as a1,Nt as a2,ut as a3,_t as a4,Bt as a5,Ct as a6,kt as a7,v as a8,P as a9,Ot as aA,E as aa,r as ab,u as ac,F as ad,h as ae,p as af,m as ag,f as ah,y as ai,w as aj,C as ak,d as al,zt as am,Wt as an,qt as ao,J as ap,R as aq,H as ar,G as as,x as at,Ht as au,lt as av,De as aw,Oe as ax,We as ay,pt as az,b,Q as c,K as d,A as e,M as f,tt as g,c as h,nt as i,st as j,ue as k,ie as l,Z as m,t as n,B as o,Xt as p,le as q,he as r,o as s,X as t,St as u,Mt as v,ht as w,gt as x,ft as y,It as z};

function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function a(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(e,...n){if(null==e){for(const t of n)t(void 0);return t}const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function s(t){let e;return i(t,(t=>e=t))(),e}function c(t,e,n){t.$$.on_destroy.push(i(e,n))}function u(t,e,n){return t.set(n),e}function l(t,e){t.appendChild(e)}function f(t,e,n){const r=function(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;if(e&&e.host)return e;return t.ownerDocument}(t);if(!r.getElementById(e)){const t=m("style");t.id=e,t.textContent=n,function(t,e){l(t.head||t,e),e.sheet}(r,t)}}function p(t,e,n){t.insertBefore(e,n||null)}function d(t){t.parentNode&&t.parentNode.removeChild(t)}function m(t){return document.createElement(t)}function h(t){return document.createTextNode(t)}function g(){return h(" ")}function v(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function b(t,e,n){t.classList.toggle(e,!!n)}let M;function A(t){M=t}function x(t){(function(){if(!M)throw new Error("Function called outside component initialization");return M})().$$.on_mount.push(t)}const y=[],L=[];let w=[];const R=[],E=Promise.resolve();let F=!1;function P(t){w.push(t)}const _=new Set;let S=0;function T(){if(0!==S)return;const t=M;do{try{for(;S<y.length;){const t=y[S];S++,A(t),$(t.$$)}}catch(t){throw y.length=0,S=0,t}for(A(null),y.length=0,S=0;L.length;)L.pop()();for(let t=0;t<w.length;t+=1){const e=w[t];_.has(e)||(_.add(e),e())}w.length=0}while(y.length);for(;R.length;)R.pop()();F=!1,_.clear(),A(t)}function $(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(P)}}const B=new Set;function C(t,e){t&&t.i&&(B.delete(t),t.i(e))}function D(t,e,n,r){if(t&&t.o){if(B.has(t))return;B.add(t),undefined.c.push((()=>{B.delete(t)})),t.o(e)}}function N(t){return void 0!==t?.length?t:Array.from(t)}function I(t){t&&t.c()}function U(t,n,a){const{fragment:i,after_update:s}=t.$$;i&&i.m(n,a),P((()=>{const n=t.$$.on_mount.map(e).filter(o);t.$$.on_destroy?t.$$.on_destroy.push(...n):r(n),t.$$.on_mount=[]})),s.forEach(P)}function O(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];w.forEach((r=>-1===t.indexOf(r)?e.push(r):n.push(r))),n.forEach((t=>t())),w=e}(n.after_update),r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function k(t,e){-1===t.$$.dirty[0]&&(y.push(t),F||(F=!0,E.then(T)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Y(e,o,a,i,s,c,u=null,l=[-1]){const f=M;A(e);const p=e.$$={fragment:null,ctx:[],props:c,update:t,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(f?f.$$.context:[])),callbacks:n(),dirty:l,skip_bound:!1,root:o.target||f.$$.root};u&&u(p.root);let m=!1;if(p.ctx=a?a(e,o.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&s(p.ctx[t],p.ctx[t]=o)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](o),m&&k(e,t)),n})):[],p.update(),m=!0,r(p.before_update),p.fragment=!!i&&i(p.ctx),o.target){if(o.hydrate){const t=function(t){return Array.from(t.childNodes)}(o.target);p.fragment&&p.fragment.l(t),t.forEach(d)}else p.fragment&&p.fragment.c();o.intro&&C(e.$$.fragment),U(e,o.target,o.anchor),T()}A(f)}class V{$$=void 0;$$set=void 0;$destroy(){O(this,1),this.$destroy=t}$on(e,n){if(!o(n))return t;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const t=r.indexOf(n);-1!==t&&r.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");const j=[];function z(e,n=t){let r;const o=new Set;function i(t){if(a(e,t)&&(e=t,r)){const t=!j.length;for(const t of o)t[1](),j.push(t,e);if(t){for(let t=0;t<j.length;t+=2)j[t][0](j[t+1]);j.length=0}}}function s(t){i(t(e))}return{set:i,update:s,subscribe:function(a,c=t){const u=[a,c];return o.add(u),1===o.size&&(r=n(i,s)||t),a(e),()=>{o.delete(u),0===o.size&&r&&(r(),r=null)}}}}function W(e,n,a){const s=!Array.isArray(e),c=s?[e]:e;if(!c.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const u=n.length<2;return l=(e,a)=>{let l=!1;const f=[];let p=0,d=t;const m=()=>{if(p)return;d();const r=n(s?f[0]:f,e,a);u?e(r):d=o(r)?r:t},h=c.map(((t,e)=>i(t,(t=>{f[e]=t,p&=~(1<<e),l&&m()}),(()=>{p|=1<<e}))));return l=!0,m(),function(){r(h),d(),l=!1}},{subscribe:z(a,l).subscribe};var l}var q=1e-6,G="undefined"!=typeof Float32Array?Float32Array:Array;function H(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function X(t,e,n){var r=e[0],o=e[1],a=e[2],i=e[3],s=e[4],c=e[5],u=e[6],l=e[7],f=e[8],p=e[9],d=e[10],m=e[11],h=e[12],g=e[13],v=e[14],b=e[15],M=n[0],A=n[1],x=n[2],y=n[3];return t[0]=M*r+A*s+x*f+y*h,t[1]=M*o+A*c+x*p+y*g,t[2]=M*a+A*u+x*d+y*v,t[3]=M*i+A*l+x*m+y*b,M=n[4],A=n[5],x=n[6],y=n[7],t[4]=M*r+A*s+x*f+y*h,t[5]=M*o+A*c+x*p+y*g,t[6]=M*a+A*u+x*d+y*v,t[7]=M*i+A*l+x*m+y*b,M=n[8],A=n[9],x=n[10],y=n[11],t[8]=M*r+A*s+x*f+y*h,t[9]=M*o+A*c+x*p+y*g,t[10]=M*a+A*u+x*d+y*v,t[11]=M*i+A*l+x*m+y*b,M=n[12],A=n[13],x=n[14],y=n[15],t[12]=M*r+A*s+x*f+y*h,t[13]=M*o+A*c+x*p+y*g,t[14]=M*a+A*u+x*d+y*v,t[15]=M*i+A*l+x*m+y*b,t}function K(t,e,n){var r,o,a,i,s,c,u,l,f,p,d,m,h=n[0],g=n[1],v=n[2];return e===t?(t[12]=e[0]*h+e[4]*g+e[8]*v+e[12],t[13]=e[1]*h+e[5]*g+e[9]*v+e[13],t[14]=e[2]*h+e[6]*g+e[10]*v+e[14],t[15]=e[3]*h+e[7]*g+e[11]*v+e[15]):(r=e[0],o=e[1],a=e[2],i=e[3],s=e[4],c=e[5],u=e[6],l=e[7],f=e[8],p=e[9],d=e[10],m=e[11],t[0]=r,t[1]=o,t[2]=a,t[3]=i,t[4]=s,t[5]=c,t[6]=u,t[7]=l,t[8]=f,t[9]=p,t[10]=d,t[11]=m,t[12]=r*h+s*g+f*v+e[12],t[13]=o*h+c*g+p*v+e[13],t[14]=a*h+u*g+d*v+e[14],t[15]=i*h+l*g+m*v+e[15]),t}function J(t,e,n){var r=n[0],o=n[1],a=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Q(t,e,n){var r=Math.sin(n),o=Math.cos(n),a=e[0],i=e[1],s=e[2],c=e[3],u=e[8],l=e[9],f=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*o-u*r,t[1]=i*o-l*r,t[2]=s*o-f*r,t[3]=c*o-p*r,t[8]=a*r+u*o,t[9]=i*r+l*o,t[10]=s*r+f*o,t[11]=c*r+p*o,t}function Z(t,e,n){var r=Math.sin(n),o=Math.cos(n),a=e[0],i=e[1],s=e[2],c=e[3],u=e[4],l=e[5],f=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*o+u*r,t[1]=i*o+l*r,t[2]=s*o+f*r,t[3]=c*o+p*r,t[4]=u*o-a*r,t[5]=l*o-i*r,t[6]=f*o-s*r,t[7]=p*o-c*r,t}function tt(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function et(t,e,n,r){var o=e[0],a=e[1],i=e[2],s=e[3],c=o+o,u=a+a,l=i+i,f=o*c,p=o*u,d=o*l,m=a*u,h=a*l,g=i*l,v=s*c,b=s*u,M=s*l,A=r[0],x=r[1],y=r[2];return t[0]=(1-(m+g))*A,t[1]=(p+M)*A,t[2]=(d-b)*A,t[3]=0,t[4]=(p-M)*x,t[5]=(1-(f+g))*x,t[6]=(h+v)*x,t[7]=0,t[8]=(d+b)*y,t[9]=(h-v)*y,t[10]=(1-(f+m))*y,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var nt=function(t,e,n,r,o){var a,i=1/Math.tan(e/2);return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(a=1/(r-o),t[10]=(o+r)*a,t[14]=2*o*r*a):(t[10]=-1,t[14]=-2*r),t};function rt(t,e,n,r,o,a,i){var s=1/(e-n),c=1/(r-o),u=1/(a-i);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*s,t[13]=(o+r)*c,t[14]=(i+a)*u,t[15]=1,t}function ot(t,e,n,r){var o,a,i,s,c,u,l,f,p,d,m=e[0],h=e[1],g=e[2],v=r[0],b=r[1],M=r[2],A=n[0],x=n[1],y=n[2];return Math.abs(m-A)<q&&Math.abs(h-x)<q&&Math.abs(g-y)<q?H(t):(l=m-A,f=h-x,p=g-y,o=b*(p*=d=1/Math.hypot(l,f,p))-M*(f*=d),a=M*(l*=d)-v*p,i=v*f-b*l,(d=Math.hypot(o,a,i))?(o*=d=1/d,a*=d,i*=d):(o=0,a=0,i=0),s=f*i-p*a,c=p*o-l*i,u=l*a-f*o,(d=Math.hypot(s,c,u))?(s*=d=1/d,c*=d,u*=d):(s=0,c=0,u=0),t[0]=o,t[1]=s,t[2]=l,t[3]=0,t[4]=a,t[5]=c,t[6]=f,t[7]=0,t[8]=i,t[9]=u,t[10]=p,t[11]=0,t[12]=-(o*m+a*h+i*g),t[13]=-(s*m+c*h+u*g),t[14]=-(l*m+f*h+p*g),t[15]=1,t)}const at=(t,e)=>{const n=Function.constructor(...Object.entries(e).map((([t,e])=>(""===e&&(e='""'),`${t}${null!=e?`=${e}`:""}`))),`return \`${t}\``);return t=>n(...Object.keys(e).map((e=>null!=t[e]?t[e]:void 0)))};function it(t){return Array.isArray(t)?[...t]:"number"==typeof t?st(t):"string"==typeof t&&t.startsWith("#")?st(parseInt(t.replace("#","0x"))):t}function st(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]}function ct(t,e){return 3===e?t:t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}const ut=0,lt=Math.PI/180;function ft(){const t=Ae.canvas.getBoundingClientRect();Ae.canvas.width=t.width,Ae.canvas.height=t.height;const e=Ae.canvas.getContext("webgl2");Ae.gl=e,e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.frontFace(e.CCW),e.cullFace(e.BACK)}function pt(){const{gl:t}=Ae;t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)}function dt(){const{gl:t}=Ae;t.disable(t.BLEND)}function mt(){const{gl:t,program:e}=Ae,n=t.getUniformLocation(e,"time");t.uniform1f(n,performance.now())}function ht(t,e,n){return function(){const{gl:r,program:o}=Ae,a=t.attributes.positionsSize??3,i=t.attributes.elements?t.attributes.elements.length:t.attributes.positions.length/a;e?r.drawArraysInstanced(r[n],0,i,e):t.attributes.elements?r.drawElements(r[n],i,r.UNSIGNED_SHORT,0):r.drawArrays(r[n],0,i),r.bindVertexArray(null)}}function gt(){const{gl:t,vao:e}=Ae;t.bindVertexArray(e)}function vt(t){return function(){const{gl:e}=Ae,n=e.createProgram();Ae.programMap.set(t,n),Ae.vaoMap.set(t,new Map),Ae.program=n}}function bt(){const{gl:t,program:e}=Ae;t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)||console.error("ERROR linking program!",t.getProgramInfoLog(e))}function Mt(){const{gl:t,program:e}=Ae;t.validateProgram(e),t.getProgramParameter(e,t.VALIDATE_STATUS)||console.error("ERROR validating program!",t.getProgramInfoLog(e))}function At(){const{gl:t,program:e}=Ae;t.useProgram(e)}function xt(){const{gl:t,backgroundColor:e}=Ae;t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,t.canvas.width,t.canvas.height),Ae.frameBufferWidth=t.canvas.width,Ae.frameBufferHeight=t.canvas.height,t.clearColor(...e),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}function yt(t,e,n,r){return function(){const{gl:o,program:a}=Ae;let i="",s="",c="",u="";const[l]=e,f=l.animations?.filter((({type:t})=>"vertex"===t));f?.length>0&&(c+=f.reduce(((t,e)=>t+e.shader({declaration:!0})),""),u+=f.reduce(((t,e)=>t+e.shader({position:!0})),""),i+=c,s+=u);const p=at("#version 300 es\r\nprecision mediump float;\r\n    \r\nin vec3 position;\r\nin vec3 normal;\r\nin vec2 uv;\r\n${instances ?\r\n`\r\nin mat4 world;\r\nin mat4 normalMatrix;\r\n` : `\r\nuniform mat4 world;\r\nuniform mat4 normalMatrix;\r\n`}\r\n\r\n\r\nuniform float time;\r\nuniform mat4 view;\r\nuniform mat4 projection;\r\n\r\n// Pass the color attribute down to the fragment shader\r\nout vec3 vertexColor;\r\nout vec3 vNormal;\r\nout vec3 vertex;\r\nout vec3 vViewPosition;\r\nout highp vec2 vUv;\r\n\r\n${declarations}\r\n\r\nvoid main() {\r\n    vec3 modifiedNormal = normal;\r\n    vec3 animatedPosition = position;\r\n    ${positionModifier}\r\n\r\n    vUv = vec3( uv, 1 ).xy;\r\n    // Pass the color down to the fragment shader\r\n    vertexColor = vec3(1.27,1.27,1.27);\r\n    // Pass the vertex down to the fragment shader\r\n    //vertex = vec3(world * vec4(position, 1.0));\r\n    vertex = vec3(world * vec4(animatedPosition, 1.0));\r\n    // Pass the normal down to the fragment shader\r\n    // todo : use modifiedNormal when effect is done\r\n    vNormal = vec3(normalMatrix * vec4(modifiedNormal , 1.0));\r\n    //vNormal = normal;\r\n    \r\n    // Pass the position down to the fragment shader\r\n    gl_Position = projection * view * world * vec4(animatedPosition, 1.0);\r\n    vViewPosition = -gl_Position.xyz;\r\n}",{instances:!1,declarations:"",positionModifier:""})({instances:l.instances>1,declarations:i,positionModifier:s}),d=o.createShader(o.VERTEX_SHADER);o.shaderSource(d,p),o.compileShader(d),o.getShaderParameter(d,o.COMPILE_STATUS)||console.error("ERROR compiling vertex shader!",o.getShaderInfoLog(d));let m="",h="";t.specular&&(h=t.specular.shader({declaration:!0}),m=t.specular.shader({irradiance:!0}));let g="",v="";t.diffuseMap&&(g=t.diffuseMap.shader({declaration:!0,declarationNormal:!1,mapType:t.diffuseMap.type}),v=t.diffuseMap.shader({diffuseMapSample:!0,mapType:t.diffuseMap.type,coordinateSpace:t.diffuseMap.coordinateSpace}));let b="",M="";t.normalMap&&(b=t.normalMap.shader({declaration:!0,declarationNormal:!0,mapType:t.normalMap.type}),M=t.normalMap.shader({normalMapSample:!0,mapType:t.normalMap.type}));let A="",x="";t.roughnessMap&&(A=t.roughnessMap.shader({declaration:!0,declarationNormal:!1,mapType:t.roughnessMap.type}),x=t.roughnessMap.shader({roughnessMapSample:!0,mapType:t.roughnessMap.type}));const y=at("#version 300 es\r\nprecision mediump float;\r\n\r\n${defines}\r\n\r\n#define RECIPROCAL_PI 0.3183098861837907\r\n\r\nuniform vec3 diffuse;\r\nuniform float opacity;\r\nuniform float metalness;\r\nuniform vec3 ambientLightColor;\r\nuniform vec3 cameraPosition;\r\n//uniform mat3 normalMatrix;\r\n\r\nin vec3 vertex;\r\nin vec3 vNormal;\r\nin highp vec2 vUv;\r\nin vec3 vViewPosition;\r\n\r\nout vec4 fragColor;\r\n\r\nstruct ReflectedLight {\r\n\tvec3 directDiffuse;\r\n\tvec3 directSpecular;\r\n\tvec3 indirectDiffuse;\r\n\tvec3 indirectSpecular;\r\n};\r\n\r\nstruct PhysicalMaterial {\r\n\tvec3 diffuseColor;\r\n\tfloat diffuseAlpha;\r\n\tfloat roughness;\r\n\tvec3 specularColor;\r\n\tfloat specularF90;\r\n\tfloat ior;\r\n};\r\n\r\nvec3 BRDF_Lambert(const in vec3 diffuseColor) {\r\n\treturn RECIPROCAL_PI * diffuseColor;\r\n}\r\n\r\n\r\n${declarations}\r\n\r\nvec4 sRGBTransferOETF(in vec4 value) {\r\n\treturn vec4(mix(pow(value.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), value.rgb * 12.92, vec3(lessThanEqual(value.rgb, vec3(0.0031308)))), value.a);\r\n}\r\n\r\nvec4 linearToOutputTexel(vec4 value) {\r\n\treturn (sRGBTransferOETF(value));\r\n}\r\n\r\nvoid main() {\r\n    PhysicalMaterial material;\r\n\tmaterial.diffuseAlpha = 1.0;\r\n\tmaterial.diffuseColor = diffuse.rgb * (1.0 - metalness);\r\n\t${diffuseMapSample}\r\n\t\r\n\r\n\tvec3 normal = normalize( vNormal );\r\n\t${normalMapSample}\r\n\t${roughnessMapSample}\r\n\r\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\r\n\r\n    reflectedLight.indirectDiffuse += ambientLightColor * BRDF_Lambert(material.diffuseColor);\r\n\r\n    vec3 totalIrradiance = vec3(0.0f);\r\n    ${irradiance}\r\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse + reflectedLight.directDiffuse + reflectedLight.directSpecular;\r\n    fragColor = vec4(outgoingLight, opacity*material.diffuseAlpha);\r\n    //fragColor = vec4(totalIrradiance, 1.0f);\r\n    ${toneMapping}\r\n\tfragColor = linearToOutputTexel(fragColor);\r\n}",{defines:"",declarations:"",diffuseMapSample:"",normalMapSample:"",roughnessMapSample:"",irradiance:"",toneMapping:"",numPointLights:0})({defines:(L={...n?{NUM_POINT_LIGHTS:n}:void 0},["",...Object.entries(L).map((([t,e])=>`#define ${t} ${e}`))].join("\n")),declarations:[...n?[r({declaration:!0,irradiance:!1})]:[],...Ae.toneMappings?.length>0?[...Ae.toneMappings.map((t=>t.shader({declaration:!0,exposure:t.exposure})))]:[],...t.specular?[h]:[],...t.diffuseMap?[g]:[],...t.normalMap?[b]:[],...t.roughnessMap?[A]:[]].join("\n"),diffuseMapSample:v,normalMapSample:M,roughnessMapSample:x,irradiance:[...n?[r({declaration:!1,irradiance:!0,specularIrradiance:m})]:[]].join("\n"),toneMapping:[...Ae.toneMappings?.length>0?[...Ae.toneMappings.map((t=>t.shader({color:!0})))]:[]].join("\n"),numPointLights:n});var L;const w=o.createShader(o.FRAGMENT_SHADER);o.shaderSource(w,y),o.compileShader(w),o.getShaderParameter(w,o.COMPILE_STATUS)||console.error("ERROR compiling fragment shader!",o.getShaderInfoLog(w)),o.attachShader(a,d),o.attachShader(a,w)}}function Lt({diffuse:t,metalness:e,opacity:n}){return function(){const{gl:r,program:o}=Ae,a=r.getUniformLocation(o,"diffuse");if(null==a)return;r.uniform3fv(a,new Float32Array(t.map(ct))),null==e&&console.log("metalness is null, material won't display correctly");const i=r.getUniformLocation(o,"metalness");r.uniform1f(i,e);const s=r.getUniformLocation(o,"opacity");r.uniform1f(s,n??1)}}function wt(){const{gl:t,program:e,ambientLightColor:n}=Ae,r=t.getUniformLocation(e,"ambientLightColor");t.uniform3fv(r,new Float32Array(n))}function Rt(t,e,n){return{projection:nt(new Float32Array(16),(r=t.fov,r*lt),e/n,t.near,t.far),view:ot(new Float32Array(16),t.position,t.target,t.up)};var r}function Et(t){return function(){const{gl:e,program:n,canvas:r}=Ae,{projection:o,view:a}=Rt(t,r.width,r.height),i=e.getUniformLocation(n,"projection");e.uniformMatrix4fv(i,!1,o);const s=e.getUniformLocation(n,"view");e.uniformMatrix4fv(s,!1,a);const c=e.getUniformLocation(n,"cameraPosition");e.uniform3fv(c,t.position)}}function Ft(t,e,n,r){return null==r?function(){const{gl:t,program:e}=Ae,r=t.getUniformLocation(e,"world");null!=r&&(n||H(n=new Float32Array(16)),Ae.transformMatrix=n,t.uniformMatrix4fv(r,!1,s(n)))}:function(){if(null==n)return;const{gl:t,program:e,vaoMap:o}=Ae;let a;a=(Ae.transformMatricesWindows=null)?[]:Ae.transformMatricesWindows;const i=n.reduce(((t,e)=>[...t,...s(e)]),[]),c=new Float32Array(i);for(let t=0;t<r;++t){const e=16*t*4,n=16;a.push(new Float32Array(c.buffer,e,n))}t.bindVertexArray(Ae.vao);const u=t.createBuffer();var l;l={matrixBuffer:u,transformMatricesWindows:a},Ae={...Ae,...l};const f=t.getAttribLocation(e,"world");t.bindBuffer(t.ARRAY_BUFFER,u),t.bufferData(t.ARRAY_BUFFER,c.byteLength,t.DYNAMIC_DRAW);for(let e=0;e<4;++e){const n=f+e;t.enableVertexAttribArray(n);const r=16*e;t.vertexAttribPointer(n,4,t.FLOAT,!1,64,r),t.vertexAttribDivisor(n,1)}t.bufferSubData(t.ARRAY_BUFFER,0,c),t.bindVertexArray(null)}}function Pt(t,e,n){return null==n?function(){const{gl:t,program:n}=Ae,r=t.getUniformLocation(n,"normalMatrix");null!=r&&t.uniformMatrix4fv(r,!1,_t(s(e.matrix)))}:function(){const{gl:t,program:e,vaoMap:r,transformMatricesWindows:o}=Ae,a=t.getAttribLocation(e,"normalMatrix");if(null==a)return;t.bindVertexArray(Ae.vao);const i=[];for(let t=0;t<n;t++)i.push(..._t(o[t]));const s=new Float32Array(i),c=t.createBuffer();Ae.normalMatrixBuffer=c,t.bindBuffer(t.ARRAY_BUFFER,c),t.bufferData(t.ARRAY_BUFFER,s.byteLength,t.DYNAMIC_DRAW),t.bufferSubData(t.ARRAY_BUFFER,0,s);for(let e=0;e<4;++e){const n=a+e;t.enableVertexAttribArray(n);const r=16*e;t.vertexAttribPointer(n,4,t.FLOAT,!1,64,r),t.vertexAttribDivisor(n,1)}t.bindVertexArray(null)}}function _t(t){const e=(n=new G(16),G!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n);var n;return function(t,e){var n=e[0],r=e[1],o=e[2],a=e[3],i=e[4],s=e[5],c=e[6],u=e[7],l=e[8],f=e[9],p=e[10],d=e[11],m=e[12],h=e[13],g=e[14],v=e[15],b=n*s-r*i,M=n*c-o*i,A=n*u-a*i,x=r*c-o*s,y=r*u-a*s,L=o*u-a*c,w=l*h-f*m,R=l*g-p*m,E=l*v-d*m,F=f*g-p*h,P=f*v-d*h,_=p*v-d*g,S=b*_-M*P+A*F+x*E-y*R+L*w;S&&(S=1/S,t[0]=(s*_-c*P+u*F)*S,t[1]=(o*P-r*_-a*F)*S,t[2]=(h*L-g*y+v*x)*S,t[3]=(p*y-f*L-d*x)*S,t[4]=(c*E-i*_-u*R)*S,t[5]=(n*_-o*E+a*R)*S,t[6]=(g*A-m*L-v*M)*S,t[7]=(l*L-p*A+d*M)*S,t[8]=(i*P-s*E+u*w)*S,t[9]=(r*E-n*P-a*w)*S,t[10]=(m*y-h*A+v*b)*S,t[11]=(f*A-l*y-d*b)*S,t[12]=(s*R-i*F-c*w)*S,t[13]=(n*F-r*R+o*w)*S,t[14]=(h*M-m*x-g*b)*S,t[15]=(l*x-f*M+p*b)*S)}(e,t),function(t,e){if(t===e){var n=e[1],r=e[2],o=e[3],a=e[6],i=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=o,t[13]=i,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(e,e),e}function St(t){let e,n;t.data?(e=t.data,n=t.interleaved):e=t;return{data:e.buffer&&e.buffer instanceof ArrayBuffer?e:new Float32Array(e),interleaved:n,...n?{byteStride:t.byteStride,byteOffset:t.byteOffset}:{}}}function Tt(t,e){return function(){const{gl:n,program:r,vaoMap:o}=Ae,{positions:a,normals:i,elements:s,uvs:c,positionsSize:u}=e.attributes;let l;o.has(t)&&o.get(t).has(e)?l=o.get(t).get(e):(l=n.createVertexArray(),o.get(t).set(e,l)),Ae.vao=l,n.bindVertexArray(l);const{data:f,interleaved:p,byteStride:d,byteOffset:m}=St(a),h=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,h),n.bufferData(n.ARRAY_BUFFER,f,n.STATIC_DRAW);const g=n.getAttribLocation(r,"position");n.bindBuffer(n.ARRAY_BUFFER,h);const v=null!=u?u:3;if(n.vertexAttribPointer(g,v,n.FLOAT,!1,d,m),n.enableVertexAttribArray(g),e.attributes.normals){const{data:t,interleaved:e,byteStride:o,byteOffset:a}=St(i);if(!e){const e=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,e),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,e)}const s=n.getAttribLocation(r,"normal");-1!=s&&(n.vertexAttribPointer(s,3,n.FLOAT,!1,o,a),n.enableVertexAttribArray(s))}if(e.attributes.elements){const t=new Uint16Array(e.attributes.elements),r=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)}if(e.attributes.uvs){const t=new Float32Array(e.attributes.uvs),o=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,o),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW);const a=n.getAttribLocation(r,"uv");-1!=a&&(n.bindBuffer(n.ARRAY_BUFFER,o),n.vertexAttribPointer(a,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(a))}n.bindVertexArray(null)}}function $t(t,e){if(null==t||null==e||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Bt(t){return(t=s(t)).shader instanceof Function&&t.setupLights instanceof Function&&t.updateOneLight instanceof Function}function Ct(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Dt(t,e){var n=e[0],r=e[1],o=e[2],a=n*n+r*r+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function Nt(t,e,n){var r=e[0],o=e[1],a=e[2],i=n[0],s=n[1],c=n[2];return t[0]=o*c-a*s,t[1]=a*i-r*c,t[2]=r*s-o*i,t}function It(t,e,n,r){var o=e[0],a=e[1],i=e[2];return t[0]=o+r*(n[0]-o),t[1]=a+r*(n[1]-a),t[2]=i+r*(n[2]-i),t}function Ut(t,e,n){var r=e[0],o=e[1],a=e[2],i=n[3]*r+n[7]*o+n[11]*a+n[15];return i=i||1,t[0]=(n[0]*r+n[4]*o+n[8]*a+n[12])/i,t[1]=(n[1]*r+n[5]*o+n[9]*a+n[13])/i,t[2]=(n[2]*r+n[6]*o+n[10]*a+n[14])/i,t}var Ot;Ot=new G(3),G!=Float32Array&&(Ot[0]=0,Ot[1]=0,Ot[2]=0);function kt(){return new Array(3).fill(0)}function Yt(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function Vt(t){for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],r=t[e+1],o=t[e+2],a=1/Math.sqrt(n*n+r*r+o*o);t[e+0]*=a,t[e+1]*=a,t[e+2]*=a}}function jt(t){const e=[];for(let n=0;n<t.length;n+=9){const r=kt(),o=kt(),a=kt();r[0]=t[n],r[1]=t[n+1],r[2]=t[n+2],o[0]=t[n+3],o[1]=t[n+4],o[2]=t[n+5],a[0]=t[n+6],a[1]=t[n+7],a[2]=t[n+8];const i=kt();Ct(i,a,o);const s=kt();Ct(s,r,o);const c=kt();Nt(c,i,s),Dt(c,c),e.push(...c,...c,...c)}return e}const zt=Math.PI/180;function Wt(t){return t*zt}const qt=t=>({type:"point",position:[0,0,0],color:[1,1,1],intensity:3,cutoffDistance:5,decayExponent:1,...t,shader:at("${declaration?\r\n`\r\n\r\nfloat pow4(const in float x) {\r\n    float x2 = x * x;\r\n    return x2 * x2;\r\n}\r\nfloat pow2(const in float x) {\r\n    return x * x;\r\n}\r\n\r\nfloat saturate(const in float a) {\r\n    return clamp(a, 0.0f, 1.0f);\r\n}\r\n\r\nstruct LightParams {\r\n    vec3 irradiance;\r\n    vec3 direction;\r\n    vec3 color;\r\n    float distance;\r\n};\r\n\r\nstruct PointLight {\r\n    vec3 position;\r\n    vec3 color;\r\n    float cutoffDistance;\r\n    float decayExponent;\r\n};\r\n\r\nlayout(std140) uniform PointLights {\r\n    PointLight pointLights[NUM_POINT_LIGHTS];\r\n};\r\n\r\nfloat getDistanceAttenuation(const in float lightDistance, const in float cutoffDistance, const in float decayExponent) {\r\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\r\n\t// page 32, equation 26: E[window1]\r\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\r\n    float distanceFalloff = 1.0f / max(pow(lightDistance, decayExponent), 0.01f);\r\n    if(cutoffDistance > 0.0f) {\r\n        distanceFalloff *= pow2(saturate(1.0f - pow4(lightDistance / cutoffDistance)));\r\n    }\r\n    return distanceFalloff;\r\n\r\n}\r\n\r\nLightParams getDirectDiffuse(const in PointLight pointLight,const in vec3 vertexPosition, const in vec3 normal,const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\r\n    LightParams lightParams = LightParams(vec3(0.0f), vec3(0.0f), vec3(0.0f), 0.0f);\r\n    vec3 lVector = pointLight.position - vertexPosition;\r\n    lightParams.distance = length(lVector);\r\n    lightParams.direction = normalize(lVector);\r\n    float dotNL = saturate(dot(normal, lightParams.direction));\r\n    lightParams.color = pointLight.color;\r\n    lightParams.color *= getDistanceAttenuation(lightParams.distance, pointLight.cutoffDistance, pointLight.decayExponent);\r\n    lightParams.irradiance = dotNL * lightParams.color;\r\n    \r\n    reflectedLight.directDiffuse += lightParams.irradiance * BRDF_Lambert(material.diffuseColor);\r\n    return lightParams;\r\n}\r\n\r\nfloat calculatePointLightBrightness(float lightDistance, float cutoffDistance, float decayExponent) {\r\n    return getDistanceAttenuation(lightDistance, cutoffDistance, decayExponent);\r\n}\r\n` : ''\r\n}\r\n${irradiance?\r\n`\r\n    vec3 irradiance = vec3(0.0f);\r\n    vec3 direction = vec3(0.0f);\r\n    for(int i = 0; i < NUM_POINT_LIGHTS; i++) {\r\n        PointLight pointLight = pointLights[i];\r\n        \r\n\r\n        LightParams lightParams = getDirectDiffuse(pointLight, vertex, normal, material, reflectedLight);\r\n        totalIrradiance += reflectedLight.directDiffuse;\r\n        ${specularIrradiance}\r\n    }\r\n` : ''\r\n}\r\n",{declaration:!1,irradiance:!1,specularIrradiance:""}),setupLights:Jt,updateOneLight:Qt});let Gt=null;const Ht=t=>{Gt=t},Xt=()=>Gt;function Kt(t,e,n){e.preMultipliedColor=[...e.color],Yt(e.preMultipliedColor,e.intensity),t[n]=e.position[0],t[n+1]=e.position[1],t[n+2]=e.position[2],t[n+4]=e.preMultipliedColor[0],t[n+5]=e.preMultipliedColor[1],t[n+6]=e.preMultipliedColor[2],t[n+7]=e.cutoffDistance,t[n+8]=e.decayExponent,t[n+9]=0,t[n+10]=0,t[n+11]=0,t[n+12]=0}function Jt(t){return function(){const{gl:e,program:n}=Ae;Xt()||function(t){const{gl:e}=Ae,n=t.length,r=new Float32Array(12*n);for(let e=0;e<n;e++)Kt(r,s(t[e]),12*e);const o=e.createBuffer();Ht(o),e.bindBufferBase(e.UNIFORM_BUFFER,ut,o),e.bufferData(e.UNIFORM_BUFFER,r,e.DYNAMIC_DRAW)}(t);const r=e.getUniformBlockIndex(n,"PointLights");e.uniformBlockBinding(n,r,ut)}}function Qt(t,e){const{gl:n}=Ae,r=t.filter((t=>"point"===s(t).type)).findIndex((t=>t===e)),o=Xt();if(-1!==r){const t=new Float32Array(12),a=12*r;Kt(t,s(e),0),n.bindBuffer(n.UNIFORM_BUFFER,o),n.bufferSubData(n.UNIFORM_BUFFER,a*Float32Array.BYTES_PER_ELEMENT,t)}}const Zt=function(){const t=z({position:[0,0,-1],target:[0,0,0],fov:80,near:.1,far:1e3,up:[0,1,0],matrix:null}),{subscribe:e,update:n}=t,r=z(0);function o(t){n((e=>{const n={...e,...t(e)};return r.update((t=>t+1)),n}))}return{subscribe:e,set:function(t){o((e=>t))},update:o,get revision(){return s(r)}}}(),te=function(){const t={canvas:null,loop:null,backgroundColor:16777215,ambientLightColor:[16777215,0],toneMappings:[],enabled:!1};let e=t,n=new Map;const r=z(t),{subscribe:o,update:a}=r,i=z(0);function c(t){a((r=>{const o=t(r);var a;return i.update((t=>t+1)),null!=e.canvas&&o.canvas!==e.canvas&&o.canvas,null!=e.loop&&o.loop!==e.loop&&o.loop,o.backgroundColor!==e.backgroundColor&&(a=o.backgroundColor,n.set("backgroundColor",[...it(a),1])),$t(o.ambientLightColor,e.ambientLightColor)||function([t,e]){n.set("ambientLightColor",it(t).map((t=>t*e)))}(o.ambientLightColor),$t(o.toneMappings,e.toneMappings)||o.toneMappings,o.enabled!==e.enabled&&o.enabled,e=o,o}))}return{subscribe:o,set:function(t){c((e=>t))},update:c,get processed(){const t=s(r);return Object.entries(t).map((([t,e])=>n.has(t)?[t,n.get(t)]:[t,e])).reduce(((t,[e,n])=>(t[e]=n,t)),{})},get revision(){return s(i)}}}();const ee=function(){const t=z([]),e=z(0),{subscribe:n,update:r}=t;function o(t){try{r((n=>{const r=t(n);return e.update((t=>t+1)),r}))}catch(t){console.log(t)}}return{subscribe:n,set:function(t){o((e=>t))},update:o,get revision(){return s(e)}}}(),ne=new Float32Array(16);H(ne);function re(t){return t.matrix=((t,e,n)=>{const{subscribe:r,set:o}=z(n||ne);return{subscribe:r,set:e=>{o(e),t(s(te))}}})(te.set,0,t.matrix),t}const oe=t=>{const{subscribe:e,set:n}=z(t),r={subscribe:e,set:t=>{n(t),Qt(s(ce),r),te.set(s(te))}};return r};let ae;const ie=W([ee],(([t])=>{const e=t.filter((t=>null!=t.attributes));if($t(ae,e))throw new Error("meshes unchanged");return ae=e,e}));let se;const ce=W([ee],(([t])=>{const e=t.filter(ve).filter(Bt);if($t(se,e))throw new Error("lights unchanged");return se=e,e})),ue=z([]);let le;const fe=W([ie],(([t])=>{const e=new Set;if(t.forEach((t=>{e.add(t.material)})),function(t,e){if(null==t||null==e||t.size!==e.size)return!1;for(let n of t)if(!e.has(n))return!1;return!0}(le,e))throw new Error("materials unchanged");return le=e,e}));function pe(t){return t?.opacity<1||t?.transparent}function de(t,e){return(pe(t.material)?1:-1)-(pe(e.material)?1:-1)}function me(t){if(0===t.length||null==s(te).canvas)return;let e=!1;const n=s(te).canvas,{projection:r,view:o}=Rt(s(Zt),n.width,n.height),a=X([],r,o);t.forEach((t=>{(e||pe(t.material))&&(e=!0,t.meshes.forEach(((t,e)=>{const n=tt([],t.matrix);t.clipSpacePosition=Ut([],n,a)})),t.meshes=t.meshes.sort(((t,e)=>e.clipSpacePosition[2]-t.clipSpacePosition[2])))}));return t.sort(((t,e)=>null==t.material||null==e.material||null==t.meshes[0].clipSpacePosition||null==e.meshes[0].clipSpacePosition?0:e.meshes[0].clipSpacePosition[2]-t.meshes[0].clipSpacePosition[2]))}const he=W([ie,ce,fe,ue],(([t,e,n,r])=>{let o=r.filter((t=>t.order<0)).reduce(((t,e)=>t.concat(...e.programs)),[]).map((e=>({...e,...e.allMeshes?{meshes:t}:{}}))),a=Array.from(n);const i=new Set(t.filter((t=>t.instances>1||t.animations?.some((t=>"vertex"===t.type)))));a=a.reduce(((e,n)=>{const r=t.filter((t=>t.material===n)),{currentNormalMeshes:o,currentSpecialMeshes:a}=r.reduce(((t,e)=>(i.has(e)?t.currentSpecialMeshes.push(e):t.currentNormalMeshes.push(e),t)),{currentNormalMeshes:[],currentSpecialMeshes:[]});return o.length>0&&e.push({material:n,meshes:o}),a.forEach((t=>{const r=t.animations?.some((t=>t.requireTime));e.push({requireTime:r,material:n,meshes:[t]})})),e}),[]),a=a.sort(de),me(a);const c=e.filter((t=>"point"===s(t).type)),u=c.length;let l;return u>0&&(l=s(c[0]).shader),[...o,...a.map(((t,n)=>{const r=0===n,o={...t,useProgram:At,setupMaterial:[wt],updateProgram:[],bindTextures:[],createProgram:vt,selectProgram:be};return o.setupProgram=[yt(t.material,t.meshes,u,l),bt,Mt],r&&(o.setFrameBuffer=xt),t.material?.specular&&o.setupMaterial.push(t.material.specular.setupSpecular),t.material?.diffuseMap&&(o.setupMaterial.push(t.material.diffuseMap.setupTexture),o.bindTextures.push(t.material.diffuseMap.bindTexture)),t.material?.normalMap&&(o.setupMaterial.push(t.material.normalMap.setupTexture),o.bindTextures.push(t.material.normalMap.bindTexture)),t.material?.roughnessMap&&(o.setupMaterial.push(t.material.roughnessMap.setupTexture),o.bindTextures.push(t.material.roughnessMap.bindTexture)),t.requireTime&&o.updateProgram.push(mt),o.setupMaterial.push(...Array.from(e.reduce(((t,e)=>{const n=s(e);return t.has(n.setupLights)?t.set(n.setupLights,[...t.get(n.setupLights),e]):t.set(n.setupLights,[e]),t}),new Map)).map((([t,e])=>t(e)))),o}))]})),ge=z({init:!1});function ve(t){return null!=t&&null!=t.subscribe}function be(t){return function(){const{programMap:e}=Ae,n=e.get(t);Ae.program=n}}function Me(t,e){return function(){const{vaoMap:n}=Ae,r=n.get(t).get(e);Ae.vao=r}}let Ae={programMap:new Map,vaoMap:new Map};const xe=[],ye=new Map;ye.set(te,0),ye.set(ee,0),ye.set(Zt,0);const Le=z(0),we=W([te,he,ee,Zt,Le],(([t,e,n,r,o])=>{if(!t.enabled||4===o||1===o)return xe;const a=function(){const t=new Set;return ye.get(te)!==te.revision&&t.add(te),ye.get(ee)!==ee.revision&&t.add(ee),ye.get(Zt)!==Zt.revision&&t.add(Zt),ye.set(te,te.revision),ye.set(ee,ee.revision),ye.set(Zt,Zt.revision),t}();if(0===a.length)return xe;const i=te.processed;let c={canvas:t.canvas,backgroundColor:i.backgroundColor,ambientLightColor:i.ambientLightColor,...t.toneMappings.length>0?{toneMappings:t.toneMappings}:void 0};const u=[];Ae={...Ae,...c};s(ge).init||u.push(ft);const l=me(e);let f=!1;return u.push(dt),u.push(...l.reduce(((t,e)=>(pe(e.material)&&!f&&(f=!0,t.push(pt)),[...t,...Ae.programMap.has(e)?[e.selectProgram(e),e.useProgram,...e.bindTextures,...e.updateProgram]:[e.createProgram(e),...e.setupProgram,e.useProgram,...e.setupMaterial,...e.updateProgram],...e.setupCamera?[e.setupCamera]:[...a.has(Zt)?[Et(r)]:[]],...e.setFrameBuffer?[e.setFrameBuffer]:[],...e.meshes.reduce(((t,n)=>[...t,...Ae.vaoMap.has(e)&&Ae.vaoMap.get(e).has(n)?[Me(e,n),...null==n.instances?[Ft(0,0,n.matrix),Pt(0,n)]:[]]:[Tt(e,n),...e.material?[Lt(e.material)]:[],Ft(0,0,null==n.instances?n.matrix:n.matrices,n.instances),Pt(0,n,n.instances),...n.animations?.map((t=>t.setupAnimation))||[]],gt,ht(n,n.instances,n.drawMode)]),[]),...e.postDraw?[e.postDraw]:[]])),[])),u}),xe);W([we],(([t])=>{if(0===t.length)return 0;if(!s(ge).init&&0===s(Le))return Le.set(1),t.forEach((t=>{t()})),ge.set({init:!0}),Le.set(2),1;if(2===s(Le))return Le.set(3),requestAnimationFrame((async function t(){Le.set(4),s(te).loop&&s(te).loop(),Le.set(3),s(we).forEach((t=>{t()})),Le.set(4),requestAnimationFrame(t)})),2})).subscribe((t=>{}));const Re=8900331,Ee={0:"POINTS",1:"LINES",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN"};function Fe(t,e){let n,r;function o(e){let o="mousemove",a="mouseup",s=e;"touchstart"===e.type&&(o="touchmove",a="touchend",s=e.touches[0]),t.addEventListener(o,i,{passive:!1}),n=s.clientX,r=s.clientY,t.addEventListener(a,u,{passive:!1}),e.preventDefault(),e.stopPropagation()}function a(t,e){const n=Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2));return{radius:n,polar:Math.acos(Math.max(-1,Math.min(1,(t[1]-e[1])/n))),azimuth:Math.atan2(t[0]-e[0],t[2]-e[2])}}function i(t){let o=t;"touchmove"===t.type&&(o=t.touches[0]);const i=o.clientX-n,u=o.clientY-r,l=s(e),{position:f,target:p,fov:d}=l,{radius:m,polar:h,azimuth:g}=a(f,p),v=c(m,h-u/100,g-i/100);v[0]=v[0]+p[0],v[1]=v[1]+p[1],v[2]=v[2]+p[2],e.set({position:v,target:p,fov:d}),n=o.clientX,r=o.clientY}function c(t,e,n){const r=Math.sin(e)*t;return[r*Math.sin(n),Math.cos(e)*t,r*Math.cos(n)]}function u(e){let n="mousemove",r="mouseup";"touchend"===e.type&&(n="touchmove",r="touchend"),t.removeEventListener(n,i,{passive:!1}),t.removeEventListener(r,u,{passive:!1})}t.addEventListener("touchstart",o,{passive:!1}),t.addEventListener("mousedown",o,{passive:!1}),t.addEventListener("wheel",(function(t){const n=s(e),{position:r,target:o,fov:i}=n,{radius:u,polar:l,azimuth:f}=a(r,o),p=c(u+.001*t.deltaY*u,l,f);p[0]=p[0]+o[0],p[1]=p[1]+o[1],p[2]=p[2]+o[2],e.set({position:p,target:o,fov:i})}),{passive:!1})}function Pe(t){f(t,"svelte-7mcxv8","button.svelte-7mcxv8.svelte-7mcxv8{position:relative;font-family:Arial;font-size:20px;padding:10px}ul.svelte-7mcxv8.svelte-7mcxv8{position:relative;display:none;font-family:Arial;font-size:20px}li.svelte-7mcxv8.svelte-7mcxv8{padding:10px;background-color:white;width:fit-content}li.svelte-7mcxv8 a.svelte-7mcxv8{text-decoration:none;color:black}.menuOpened.svelte-7mcxv8.svelte-7mcxv8{display:block}.current.svelte-7mcxv8.svelte-7mcxv8{color:red}")}function _e(t,e,n){const r=t.slice();return r[3]=e[n],r}function Se(e){let n,r,o,a=e[3].name+"";return{c(){n=m("li"),r=m("a"),o=h(a),v(r,"href",e[3].href),v(r,"class","svelte-7mcxv8"),v(n,"class","svelte-7mcxv8")},m(t,e){p(t,n,e),l(n,r),l(r,o)},p:t,d(t){t&&d(n)}}}function Te(e){let n;return{c(){n=m("li"),n.textContent=`${e[3].name}`,v(n,"class","current svelte-7mcxv8")},m(t,e){p(t,n,e)},p:t,d(t){t&&d(n)}}}function $e(t){let e;let n=function(t,e){return window.location.pathname===t[3].href.substring(1)?Te:Se}(t),r=n(t);return{c(){r.c(),e=h("")},m(t,n){r.m(t,n),p(t,e,n)},p(t,e){r.p(t,e)},d(t){t&&d(e),r.d(t)}}}function Be(e){let n,r,o,a,i,s=N(e[2]),c=[];for(let t=0;t<s.length;t+=1)c[t]=$e(_e(e,s,t));return{c(){n=m("button"),n.textContent="examples",r=g(),o=m("ul");for(let t=0;t<c.length;t+=1)c[t].c();v(n,"class","svelte-7mcxv8"),v(o,"class","svelte-7mcxv8"),b(o,"menuOpened",e[0])},m(t,s){p(t,n,s),p(t,r,s),p(t,o,s);for(let t=0;t<c.length;t+=1)c[t]&&c[t].m(o,null);var u,l,f,d;a||(u=n,l="click",f=e[1],u.addEventListener(l,f,d),i=()=>u.removeEventListener(l,f,d),a=!0)},p(t,[e]){if(4&e){let n;for(s=N(t[2]),n=0;n<s.length;n+=1){const r=_e(t,s,n);c[n]?c[n].p(r,e):(c[n]=$e(r),c[n].c(),c[n].m(o,null))}for(;n<c.length;n+=1)c[n].d(1);c.length=s.length}1&e&&b(o,"menuOpened",t[0])},i:t,o:t,d(t){t&&(d(n),d(r),d(o)),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(c,t),a=!1,i()}}}function Ce(t,e,n){let r=!1;return[r,function(){console.log("toggleMenu",r),n(0,r=!r)},[{name:"Normal map and specular",href:"./golf-ball"},{name:"GLTF loader",href:"./"},{name:"Obj loader",href:"./venus"},{name:"Cube",href:"./cube"},{name:"GLTF",href:"./gltf"},{name:"Contact Shadow",href:"./contact-shadow"},{name:"Transparency",href:"./transparency"},{name:"Matrix",href:"./matrix"},{name:"Texture",href:"./texture"},{name:"Lights",href:"./lights"},{name:"Vertex Animation",href:"./vertex-anim"}]]}class De extends V{constructor(t){super(),Y(this,t,Ce,Be,a,{},Pe)}}export{Vt as $,qt as A,re as B,Fe as C,L as D,Ee as E,Nt as F,Ct as G,Dt as H,Q as I,Ae as J,tt as K,rt as L,De as M,ot as N,bt as O,Mt as P,At as Q,be as R,V as S,X as T,et as U,jt as V,Wt as W,G as X,kt as Y,It as Z,Yt as _,g as a,s as a0,at as a1,p as b,I as c,D as d,m as e,d as f,O as g,c as h,Y as i,ee as j,Zt as k,ue as l,U as m,t as n,x as o,Ut as p,Z as q,te as r,a as s,C as t,J as u,K as v,H as w,u as x,Re as y,oe as z};

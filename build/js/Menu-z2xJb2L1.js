function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function a(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(e,...n){if(null==e){for(const t of n)t(void 0);return t}const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function s(t){let e;return i(t,(t=>e=t))(),e}function c(t,e,n){t.$$.on_destroy.push(i(e,n))}function u(t,e,n,r){if(t){const a=l(t,e,n,r);return t[0](a)}}function l(t,e,n,r){return t[1]&&r?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](r(e))):n.ctx}function f(t,e,n,r){if(t[2]&&r){const a=t[2](r(n));if(void 0===e.dirty)return a;if("object"==typeof a){const t=[],n=Math.max(e.dirty.length,a.length);for(let r=0;r<n;r+=1)t[r]=e.dirty[r]|a[r];return t}return e.dirty|a}return e.dirty}function p(t,e,n,r,a,o){if(a){const i=l(e,n,r,o);t.p(i,a)}}function d(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let t=0;t<n;t++)e[t]=-1;return e}return-1}function m(t){return null==t?"":t}function h(t,e,n){return t.set(n),e}function g(t,e){t.appendChild(e)}function v(t,e,n){const r=function(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;if(e&&e.host)return e;return t.ownerDocument}(t);if(!r.getElementById(e)){const t=x("style");t.id=e,t.textContent=n,function(t,e){g(t.head||t,e),e.sheet}(r,t)}}function b(t,e,n){t.insertBefore(e,n||null)}function M(t){t.parentNode&&t.parentNode.removeChild(t)}function A(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function x(t){return document.createElement(t)}function y(t){return document.createTextNode(t)}function L(){return y(" ")}function R(){return y("")}function E(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function w(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function F(t,e){e=""+e,t.data!==e&&(t.data=e)}function P(t,e,n){t.classList.toggle(e,!!n)}let _;function S(t){_=t}function T(){if(!_)throw new Error("Function called outside component initialization");return _}function B(t){T().$$.on_mount.push(t)}function $(){const t=T();return(e,n,{cancelable:r=!1}={})=>{const a=t.$$.callbacks[e];if(a){const o=function(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}(e,n,{cancelable:r});return a.slice().forEach((e=>{e.call(t,o)})),!o.defaultPrevented}return!0}}const C=[],D=[];let I=[];const N=[],U=Promise.resolve();let O=!1;function Y(t){I.push(t)}const k=new Set;let V=0;function j(){if(0!==V)return;const t=_;do{try{for(;V<C.length;){const t=C[V];V++,S(t),W(t.$$)}}catch(t){throw C.length=0,V=0,t}for(S(null),C.length=0,V=0;D.length;)D.pop()();for(let t=0;t<I.length;t+=1){const e=I[t];k.has(e)||(k.add(e),e())}I.length=0}while(C.length);for(;N.length;)N.pop()();O=!1,k.clear(),S(t)}function W(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Y)}}const q=new Set;let z;function G(){z={r:0,c:[],p:z}}function H(){z.r||r(z.c),z=z.p}function X(t,e){t&&t.i&&(q.delete(t),t.i(e))}function K(t,e,n,r){if(t&&t.o){if(q.has(t))return;q.add(t),z.c.push((()=>{q.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}else r&&r()}function J(t){return void 0!==t?.length?t:Array.from(t)}function Q(t){t&&t.c()}function Z(t,n,o){const{fragment:i,after_update:s}=t.$$;i&&i.m(n,o),Y((()=>{const n=t.$$.on_mount.map(e).filter(a);t.$$.on_destroy?t.$$.on_destroy.push(...n):r(n),t.$$.on_mount=[]})),s.forEach(Y)}function tt(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];I.forEach((r=>-1===t.indexOf(r)?e.push(r):n.push(r))),n.forEach((t=>t())),I=e}(n.after_update),r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function et(t,e){-1===t.$$.dirty[0]&&(C.push(t),O||(O=!0,U.then(j)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function nt(e,a,o,i,s,c,u=null,l=[-1]){const f=_;S(e);const p=e.$$={fragment:null,ctx:[],props:c,update:t,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a.context||(f?f.$$.context:[])),callbacks:n(),dirty:l,skip_bound:!1,root:a.target||f.$$.root};u&&u(p.root);let d=!1;if(p.ctx=o?o(e,a.props||{},((t,n,...r)=>{const a=r.length?r[0]:n;return p.ctx&&s(p.ctx[t],p.ctx[t]=a)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](a),d&&et(e,t)),n})):[],p.update(),d=!0,r(p.before_update),p.fragment=!!i&&i(p.ctx),a.target){if(a.hydrate){const t=function(t){return Array.from(t.childNodes)}(a.target);p.fragment&&p.fragment.l(t),t.forEach(M)}else p.fragment&&p.fragment.c();a.intro&&X(e.$$.fragment),Z(e,a.target,a.anchor),j()}S(f)}class rt{$$=void 0;$$set=void 0;$destroy(){tt(this,1),this.$destroy=t}$on(e,n){if(!a(n))return t;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const t=r.indexOf(n);-1!==t&&r.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");const at=[];function ot(e,n=t){let r;const a=new Set;function i(t){if(o(e,t)&&(e=t,r)){const t=!at.length;for(const t of a)t[1](),at.push(t,e);if(t){for(let t=0;t<at.length;t+=2)at[t][0](at[t+1]);at.length=0}}}function s(t){i(t(e))}return{set:i,update:s,subscribe:function(o,c=t){const u=[o,c];return a.add(u),1===a.size&&(r=n(i,s)||t),o(e),()=>{a.delete(u),0===a.size&&r&&(r(),r=null)}}}}function it(e,n,o){const s=!Array.isArray(e),c=s?[e]:e;if(!c.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const u=n.length<2;return l=(e,o)=>{let l=!1;const f=[];let p=0,d=t;const m=()=>{if(p)return;d();const r=n(s?f[0]:f,e,o);u?e(r):d=a(r)?r:t},h=c.map(((t,e)=>i(t,(t=>{f[e]=t,p&=~(1<<e),l&&m()}),(()=>{p|=1<<e}))));return l=!0,m(),function(){r(h),d(),l=!1}},{subscribe:ot(o,l).subscribe};var l}var st=1e-6,ct="undefined"!=typeof Float32Array?Float32Array:Array;function ut(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lt(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=e[4],c=e[5],u=e[6],l=e[7],f=e[8],p=e[9],d=e[10],m=e[11],h=e[12],g=e[13],v=e[14],b=e[15],M=n[0],A=n[1],x=n[2],y=n[3];return t[0]=M*r+A*s+x*f+y*h,t[1]=M*a+A*c+x*p+y*g,t[2]=M*o+A*u+x*d+y*v,t[3]=M*i+A*l+x*m+y*b,M=n[4],A=n[5],x=n[6],y=n[7],t[4]=M*r+A*s+x*f+y*h,t[5]=M*a+A*c+x*p+y*g,t[6]=M*o+A*u+x*d+y*v,t[7]=M*i+A*l+x*m+y*b,M=n[8],A=n[9],x=n[10],y=n[11],t[8]=M*r+A*s+x*f+y*h,t[9]=M*a+A*c+x*p+y*g,t[10]=M*o+A*u+x*d+y*v,t[11]=M*i+A*l+x*m+y*b,M=n[12],A=n[13],x=n[14],y=n[15],t[12]=M*r+A*s+x*f+y*h,t[13]=M*a+A*c+x*p+y*g,t[14]=M*o+A*u+x*d+y*v,t[15]=M*i+A*l+x*m+y*b,t}function ft(t,e,n){var r,a,o,i,s,c,u,l,f,p,d,m,h=n[0],g=n[1],v=n[2];return e===t?(t[12]=e[0]*h+e[4]*g+e[8]*v+e[12],t[13]=e[1]*h+e[5]*g+e[9]*v+e[13],t[14]=e[2]*h+e[6]*g+e[10]*v+e[14],t[15]=e[3]*h+e[7]*g+e[11]*v+e[15]):(r=e[0],a=e[1],o=e[2],i=e[3],s=e[4],c=e[5],u=e[6],l=e[7],f=e[8],p=e[9],d=e[10],m=e[11],t[0]=r,t[1]=a,t[2]=o,t[3]=i,t[4]=s,t[5]=c,t[6]=u,t[7]=l,t[8]=f,t[9]=p,t[10]=d,t[11]=m,t[12]=r*h+s*g+f*v+e[12],t[13]=a*h+c*g+p*v+e[13],t[14]=o*h+u*g+d*v+e[14],t[15]=i*h+l*g+m*v+e[15]),t}function pt(t,e,n){var r=n[0],a=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function dt(t,e,n){var r=Math.sin(n),a=Math.cos(n),o=e[4],i=e[5],s=e[6],c=e[7],u=e[8],l=e[9],f=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*a+u*r,t[5]=i*a+l*r,t[6]=s*a+f*r,t[7]=c*a+p*r,t[8]=u*a-o*r,t[9]=l*a-i*r,t[10]=f*a-s*r,t[11]=p*a-c*r,t}function mt(t,e,n){var r=Math.sin(n),a=Math.cos(n),o=e[0],i=e[1],s=e[2],c=e[3],u=e[8],l=e[9],f=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*a-u*r,t[1]=i*a-l*r,t[2]=s*a-f*r,t[3]=c*a-p*r,t[8]=o*r+u*a,t[9]=i*r+l*a,t[10]=s*r+f*a,t[11]=c*r+p*a,t}function ht(t,e,n){var r=Math.sin(n),a=Math.cos(n),o=e[0],i=e[1],s=e[2],c=e[3],u=e[4],l=e[5],f=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*a+u*r,t[1]=i*a+l*r,t[2]=s*a+f*r,t[3]=c*a+p*r,t[4]=u*a-o*r,t[5]=l*a-i*r,t[6]=f*a-s*r,t[7]=p*a-c*r,t}function gt(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function vt(t,e,n,r){var a=e[0],o=e[1],i=e[2],s=e[3],c=a+a,u=o+o,l=i+i,f=a*c,p=a*u,d=a*l,m=o*u,h=o*l,g=i*l,v=s*c,b=s*u,M=s*l,A=r[0],x=r[1],y=r[2];return t[0]=(1-(m+g))*A,t[1]=(p+M)*A,t[2]=(d-b)*A,t[3]=0,t[4]=(p-M)*x,t[5]=(1-(f+g))*x,t[6]=(h+v)*x,t[7]=0,t[8]=(d+b)*y,t[9]=(h-v)*y,t[10]=(1-(f+m))*y,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var bt=function(t,e,n,r,a){var o,i=1/Math.tan(e/2);return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(o=1/(r-a),t[10]=(a+r)*o,t[14]=2*a*r*o):(t[10]=-1,t[14]=-2*r),t};function Mt(t,e,n,r,a,o,i){var s=1/(e-n),c=1/(r-a),u=1/(o-i);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*s,t[13]=(a+r)*c,t[14]=(i+o)*u,t[15]=1,t}function At(t,e,n,r){var a,o,i,s,c,u,l,f,p,d,m=e[0],h=e[1],g=e[2],v=r[0],b=r[1],M=r[2],A=n[0],x=n[1],y=n[2];return Math.abs(m-A)<st&&Math.abs(h-x)<st&&Math.abs(g-y)<st?ut(t):(l=m-A,f=h-x,p=g-y,a=b*(p*=d=1/Math.hypot(l,f,p))-M*(f*=d),o=M*(l*=d)-v*p,i=v*f-b*l,(d=Math.hypot(a,o,i))?(a*=d=1/d,o*=d,i*=d):(a=0,o=0,i=0),s=f*i-p*o,c=p*a-l*i,u=l*o-f*a,(d=Math.hypot(s,c,u))?(s*=d=1/d,c*=d,u*=d):(s=0,c=0,u=0),t[0]=a,t[1]=s,t[2]=l,t[3]=0,t[4]=o,t[5]=c,t[6]=f,t[7]=0,t[8]=i,t[9]=u,t[10]=p,t[11]=0,t[12]=-(a*m+o*h+i*g),t[13]=-(s*m+c*h+u*g),t[14]=-(l*m+f*h+p*g),t[15]=1,t)}const xt=(t,e)=>{const n=Function.constructor(...Object.entries(e).map((([t,e])=>(""===e&&(e='""'),`${t}${null!=e?`=${e}`:""}`))),`return \`${t}\``);return t=>n(...Object.keys(e).map((e=>null!=t[e]?t[e]:void 0)))};function yt(t){return Array.isArray(t)?[...t]:"number"==typeof t?Lt(t):"string"==typeof t&&t.startsWith("#")?Lt(parseInt(t.replace("#","0x"))):t}function Lt(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]}function Rt(t,e){return 3===e?t:t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Et(t){return t.map((t=>Math.floor(255*t))).reduce(((t,e)=>t+e.toString(16).padStart(2,"0")),"#")}function wt(t){return"#"+t.toString(16).padStart(6,"0")}function Ft(t){return parseInt(t.slice(1),16)}function Pt(t){return[parseInt(t.slice(1,3),16)/255,parseInt(t.slice(3,5),16)/255,parseInt(t.slice(5,7),16)/255]}const _t=["diffuse","color"],St=0,Tt=Math.PI/180;function Bt(){const t=Ve.canvas.getBoundingClientRect();Ve.canvas.width=t.width,Ve.canvas.height=t.height;const e=Ve.canvas.getContext("webgl2");Ve.gl=e,e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.frontFace(e.CCW),e.cullFace(e.BACK)}function $t(){const{gl:t}=Ve;t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)}function Ct(){const{gl:t}=Ve;t.disable(t.BLEND)}function Dt(){const{gl:t,program:e}=Ve,n=t.getUniformLocation(e,"time");t.uniform1f(n,performance.now())}function It(t,e,n){return function(){const{gl:r,program:a}=Ve,o=t.attributes.positionsSize??3,i=t.attributes.elements?t.attributes.elements.length:t.attributes.positions.length/o;e?t.attributes.elements?r.drawElementsInstanced(r[n],i,r.UNSIGNED_SHORT,0,e):r.drawArraysInstanced(r[n],0,i,e):t.attributes.elements?r.drawElements(r[n],i,r.UNSIGNED_SHORT,0):r.drawArrays(r[n],0,i),r.bindVertexArray(null)}}function Nt(){const{gl:t,vao:e}=Ve;t.bindVertexArray(e)}function Ut(t){return function(){const{gl:e}=Ve,n=e.createProgram();Ve.programMap.set(t,n),Ve.vaoMap.set(t,new Map),Ve.program=n}}function Ot(){const{gl:t,program:e}=Ve;t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)||console.error("ERROR linking program!",t.getProgramInfoLog(e))}function Yt(){const{gl:t,program:e}=Ve;t.validateProgram(e),t.getProgramParameter(e,t.VALIDATE_STATUS)||console.error("ERROR validating program!",t.getProgramInfoLog(e))}function kt(){const{gl:t,program:e}=Ve;t.useProgram(e)}function Vt(){const{gl:t,backgroundColor:e}=Ve;t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,t.canvas.width,t.canvas.height),Ve.frameBufferWidth=t.canvas.width,Ve.frameBufferHeight=t.canvas.height,t.clearColor(...e),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}function jt(t,e,n,r){return function(){const{gl:a,program:o}=Ve;let i="",s="",c="",u="";const[l]=e,f=l.animations?.filter((({type:t})=>"vertex"===t));f?.length>0&&(c+=f.reduce(((t,e)=>t+e.shader({declaration:!0})),""),u+=f.reduce(((t,e)=>t+e.shader({position:!0})),""),i+=c,s+=u);const p=xt("#version 300 es\r\nprecision mediump float;\r\n    \r\nin vec3 position;\r\nin vec3 normal;\r\nin vec2 uv;\r\n${instances ?\r\n`\r\nin mat4 world;\r\nin mat4 normalMatrix;\r\n` : `\r\nuniform mat4 world;\r\nuniform mat4 normalMatrix;\r\n`}\r\n\r\n\r\nuniform float time;\r\nuniform mat4 view;\r\nuniform mat4 projection;\r\n\r\n// Pass the color attribute down to the fragment shader\r\nout vec3 vertexColor;\r\nout vec3 vNormal;\r\nout vec3 vertex;\r\nout vec3 vViewPosition;\r\nout highp vec2 vUv;\r\n\r\n${declarations}\r\n\r\nvoid main() {\r\n    vec3 modifiedNormal = normal;\r\n    vec3 animatedPosition = position;\r\n    ${positionModifier}\r\n\r\n    vUv = vec3( uv, 1 ).xy;\r\n    // Pass the color down to the fragment shader\r\n    vertexColor = vec3(1.27,1.27,1.27);\r\n    // Pass the vertex down to the fragment shader\r\n    //vertex = vec3(world * vec4(position, 1.0));\r\n    vertex = vec3(world * vec4(animatedPosition, 1.0));\r\n    // Pass the normal down to the fragment shader\r\n    // todo : use modifiedNormal when effect is done\r\n    vNormal = vec3(normalMatrix * vec4(modifiedNormal , 1.0));\r\n    //vNormal = normal;\r\n    \r\n    // Pass the position down to the fragment shader\r\n    gl_Position = projection * view * world * vec4(animatedPosition, 1.0);\r\n    vViewPosition = -gl_Position.xyz;\r\n}",{instances:!1,declarations:"",positionModifier:""})({instances:l.instances>1,declarations:i,positionModifier:s}),d=a.createShader(a.VERTEX_SHADER);a.shaderSource(d,p),a.compileShader(d),a.getShaderParameter(d,a.COMPILE_STATUS)||console.error("ERROR compiling vertex shader!",a.getShaderInfoLog(d));let m="",h="";t.specular&&(h=t.specular.shader({declaration:!0}),m=t.specular.shader({irradiance:!0}));let g="",v="";t.diffuseMap&&(g=t.diffuseMap.shader({declaration:!0,declarationNormal:!1,mapType:t.diffuseMap.type}),v=t.diffuseMap.shader({diffuseMapSample:!0,mapType:t.diffuseMap.type,coordinateSpace:t.diffuseMap.coordinateSpace}));let b="",M="";t.normalMap&&(b=t.normalMap.shader({declaration:!0,declarationNormal:!0,mapType:t.normalMap.type}),M=t.normalMap.shader({normalMapSample:!0,mapType:t.normalMap.type}));let A="",x="";t.roughnessMap&&(A=t.roughnessMap.shader({declaration:!0,declarationNormal:!1,mapType:t.roughnessMap.type}),x=t.roughnessMap.shader({roughnessMapSample:!0,mapType:t.roughnessMap.type}));const y=xt("#version 300 es\r\nprecision mediump float;\r\n\r\n${defines}\r\n\r\n#define RECIPROCAL_PI 0.3183098861837907\r\n\r\nuniform vec3 diffuse;\r\nuniform float opacity;\r\nuniform float metalness;\r\nuniform vec3 ambientLightColor;\r\nuniform vec3 cameraPosition;\r\n//uniform mat3 normalMatrix;\r\n\r\nin vec3 vertex;\r\nin vec3 vNormal;\r\nin highp vec2 vUv;\r\nin vec3 vViewPosition;\r\n\r\nout vec4 fragColor;\r\n\r\nstruct ReflectedLight {\r\n\tvec3 directDiffuse;\r\n\tvec3 directSpecular;\r\n\tvec3 indirectDiffuse;\r\n\tvec3 indirectSpecular;\r\n};\r\n\r\nstruct PhysicalMaterial {\r\n\tvec3 diffuseColor;\r\n\tfloat diffuseAlpha;\r\n\tfloat roughness;\r\n\tvec3 specularColor;\r\n\tfloat specularF90;\r\n\tfloat ior;\r\n};\r\n\r\nvec3 BRDF_Lambert(const in vec3 diffuseColor) {\r\n\treturn RECIPROCAL_PI * diffuseColor;\r\n}\r\n\r\n\r\n${declarations}\r\n\r\nvec4 sRGBTransferOETF(in vec4 value) {\r\n\treturn vec4(mix(pow(value.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), value.rgb * 12.92, vec3(lessThanEqual(value.rgb, vec3(0.0031308)))), value.a);\r\n}\r\n\r\nvec4 linearToOutputTexel(vec4 value) {\r\n\treturn (sRGBTransferOETF(value));\r\n}\r\n\r\nvoid main() {\r\n    PhysicalMaterial material;\r\n\tmaterial.diffuseAlpha = 1.0;\r\n\tmaterial.diffuseColor = diffuse.rgb * (1.0 - metalness);\r\n\t${diffuseMapSample}\r\n\t\r\n\r\n\tvec3 normal = normalize( vNormal );\r\n\t${normalMapSample}\r\n\t${roughnessMapSample}\r\n\r\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\r\n\r\n    reflectedLight.indirectDiffuse += ambientLightColor * BRDF_Lambert(material.diffuseColor);\r\n\r\n    vec3 totalIrradiance = vec3(0.0f);\r\n    ${irradiance}\r\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse + reflectedLight.directDiffuse + reflectedLight.directSpecular;\r\n    fragColor = vec4(outgoingLight, opacity*material.diffuseAlpha);\r\n    //fragColor = vec4(totalIrradiance, 1.0f);\r\n    ${toneMapping}\r\n\tfragColor = linearToOutputTexel(fragColor);\r\n}",{defines:"",declarations:"",diffuseMapSample:"",normalMapSample:"",roughnessMapSample:"",irradiance:"",toneMapping:"",numPointLights:0})({defines:(L={...n?{NUM_POINT_LIGHTS:n}:void 0},["",...Object.entries(L).map((([t,e])=>`#define ${t} ${e}`))].join("\n")),declarations:[...n?[r({declaration:!0,irradiance:!1})]:[],...Ve.toneMappings?.length>0?[...Ve.toneMappings.map((t=>t.shader({declaration:!0,exposure:t.exposure})))]:[],...t.specular?[h]:[],...t.diffuseMap?[g]:[],...t.normalMap?[b]:[],...t.roughnessMap?[A]:[]].join("\n"),diffuseMapSample:v,normalMapSample:M,roughnessMapSample:x,irradiance:[...n?[r({declaration:!1,irradiance:!0,specularIrradiance:m})]:[]].join("\n"),toneMapping:[...Ve.toneMappings?.length>0?[...Ve.toneMappings.map((t=>t.shader({color:!0})))]:[]].join("\n"),numPointLights:n});var L;const R=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(R,y),a.compileShader(R),a.getShaderParameter(R,a.COMPILE_STATUS)||console.error("ERROR compiling fragment shader!",a.getShaderInfoLog(R)),a.attachShader(o,d),a.attachShader(o,R)}}function Wt({diffuse:t,metalness:e,opacity:n}){return function(){const{gl:r,program:a}=Ve,o=r.getUniformLocation(a,"diffuse");if(null==o)return;r.uniform3fv(o,new Float32Array(t.map(Rt))),null==e&&console.log("metalness is null, material won't display correctly");const i=r.getUniformLocation(a,"metalness");r.uniform1f(i,e);const s=r.getUniformLocation(a,"opacity");r.uniform1f(s,n??1)}}function qt(t,e){const{gl:n,program:r,ambientLightColor:a}=Ve,o=t??r,i=e??a,s=n.getUniformLocation(o,"ambientLightColor");n.uniform3fv(s,new Float32Array(i))}function zt(t,e,n){return{projection:bt(new Float32Array(16),(r=t.fov,r*Tt),e/n,t.near,t.far),view:At(new Float32Array(16),t.position,t.target,t.up)};var r}function Gt(t){return function(){const{gl:e,program:n,canvas:r}=Ve,{projection:a,view:o}=zt(t,r.width,r.height),i=e.getUniformLocation(n,"projection");e.uniformMatrix4fv(i,!1,a);const s=e.getUniformLocation(n,"view");e.uniformMatrix4fv(s,!1,o);const c=e.getUniformLocation(n,"cameraPosition");e.uniform3fv(c,t.position)}}function Ht(t,e,n,r){return null==r?function(){const{gl:t,program:e}=Ve,r=t.getUniformLocation(e,"world");null!=r&&(n||ut(n=new Float32Array(16)),Ve.transformMatrix=n,t.uniformMatrix4fv(r,!1,s(n)))}:function(){if(null==n)return;const{gl:a,program:o,vaoMap:i}=Ve;let c;c=null==Ve.transformMatricesWindows?[]:Ve.transformMatricesWindows;const u=n.reduce(((t,e)=>[...t,...s(e)]),[]),l=new Float32Array(u);for(let t=0;t<r;++t){const e=16*t*4,n=16;c.push(new Float32Array(l.buffer,e,n))}const f=i.get(t).get(e);a.bindVertexArray(f);const p=a.createBuffer();var d;d={matrixBuffer:p,transformMatricesWindows:c},Ve={...Ve,...d};const m=a.getAttribLocation(o,"world");a.bindBuffer(a.ARRAY_BUFFER,p),a.bufferData(a.ARRAY_BUFFER,l.byteLength,a.DYNAMIC_DRAW);for(let t=0;t<4;++t){const e=m+t;a.enableVertexAttribArray(e);const n=16*t;a.vertexAttribPointer(e,4,a.FLOAT,!1,64,n),a.vertexAttribDivisor(e,1)}a.bufferSubData(a.ARRAY_BUFFER,0,l),a.bindVertexArray(null)}}function Xt(t,e,n,r){const{gl:a,vaoMap:o,matrixBuffer:i}=Ve;a.bindVertexArray(o.get(t).get(e)),a.bindBuffer(a.ARRAY_BUFFER,i);a.bufferSubData(a.ARRAY_BUFFER,64*r,n),a.bindVertexArray(null),function(t,e,n,r){const{gl:a,vaoMap:o,normalMatrixBuffer:i}=Ve;a.bindVertexArray(o.get(t).get(e)),a.bindBuffer(a.ARRAY_BUFFER,i);const s=64;a.bufferSubData(a.ARRAY_BUFFER,r*s,n),a.bindVertexArray(null)}(t,e,Jt(n),r)}function Kt(t,e,n){return null==n?function(){const{gl:t,program:n}=Ve,r=t.getUniformLocation(n,"normalMatrix");null!=r&&t.uniformMatrix4fv(r,!1,Jt(s(e.matrix)))}:function(){const{gl:r,program:a,vaoMap:o,transformMatricesWindows:i}=Ve,s=r.getAttribLocation(a,"normalMatrix");if(null==s)return;const c=o.get(t).get(e);r.bindVertexArray(c);const u=[];for(let t=0;t<n;t++)u.push(...Jt(i[t]));const l=new Float32Array(u),f=r.createBuffer();Ve.normalMatrixBuffer=f,r.bindBuffer(r.ARRAY_BUFFER,f),r.bufferData(r.ARRAY_BUFFER,l.byteLength,r.DYNAMIC_DRAW),r.bufferSubData(r.ARRAY_BUFFER,0,l);for(let t=0;t<4;++t){const e=s+t;r.enableVertexAttribArray(e);const n=16*t;r.vertexAttribPointer(e,4,r.FLOAT,!1,64,n),r.vertexAttribDivisor(e,1)}r.bindVertexArray(null)}}function Jt(t){const e=(n=new ct(16),ct!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n);var n;return function(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],c=e[6],u=e[7],l=e[8],f=e[9],p=e[10],d=e[11],m=e[12],h=e[13],g=e[14],v=e[15],b=n*s-r*i,M=n*c-a*i,A=n*u-o*i,x=r*c-a*s,y=r*u-o*s,L=a*u-o*c,R=l*h-f*m,E=l*g-p*m,w=l*v-d*m,F=f*g-p*h,P=f*v-d*h,_=p*v-d*g,S=b*_-M*P+A*F+x*w-y*E+L*R;S&&(S=1/S,t[0]=(s*_-c*P+u*F)*S,t[1]=(a*P-r*_-o*F)*S,t[2]=(h*L-g*y+v*x)*S,t[3]=(p*y-f*L-d*x)*S,t[4]=(c*w-i*_-u*E)*S,t[5]=(n*_-a*w+o*E)*S,t[6]=(g*A-m*L-v*M)*S,t[7]=(l*L-p*A+d*M)*S,t[8]=(i*P-s*w+u*R)*S,t[9]=(r*w-n*P-o*R)*S,t[10]=(m*y-h*A+v*b)*S,t[11]=(f*A-l*y-d*b)*S,t[12]=(s*E-i*F-c*R)*S,t[13]=(n*F-r*E+a*R)*S,t[14]=(h*M-m*x-g*b)*S,t[15]=(l*x-f*M+p*b)*S)}(e,t),function(t,e){if(t===e){var n=e[1],r=e[2],a=e[3],o=e[6],i=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=a,t[13]=i,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(e,e),e}function Qt(t){let e,n;t.data?(e=t.data,n=t.interleaved):e=t;return{data:e.buffer&&e.buffer instanceof ArrayBuffer?e:new Float32Array(e),interleaved:n,...n?{byteStride:t.byteStride,byteOffset:t.byteOffset}:{}}}function Zt(t,e){return function(){const{gl:n,program:r,vaoMap:a}=Ve,{positions:o,normals:i,elements:s,uvs:c,positionsSize:u}=e.attributes;let l;a.has(t)&&a.get(t).has(e)?l=a.get(t).get(e):(l=n.createVertexArray(),a.get(t).set(e,l)),Ve.vao=l,n.bindVertexArray(l);const{data:f,interleaved:p,byteStride:d,byteOffset:m}=Qt(o),h=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,h),n.bufferData(n.ARRAY_BUFFER,f,n.STATIC_DRAW);const g=n.getAttribLocation(r,"position");n.bindBuffer(n.ARRAY_BUFFER,h);const v=null!=u?u:3;if(n.vertexAttribPointer(g,v,n.FLOAT,!1,d,m),n.enableVertexAttribArray(g),e.attributes.normals){const{data:t,interleaved:e,byteStride:a,byteOffset:o}=Qt(i);if(!e){const e=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,e),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,e)}const s=n.getAttribLocation(r,"normal");-1!=s&&(n.vertexAttribPointer(s,3,n.FLOAT,!1,a,o),n.enableVertexAttribArray(s))}if(e.attributes.elements){const t=new Uint16Array(e.attributes.elements),r=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)}if(e.attributes.uvs){const t=new Float32Array(e.attributes.uvs),a=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,a),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW);const o=n.getAttribLocation(r,"uv");-1!=o&&(n.bindBuffer(n.ARRAY_BUFFER,a),n.vertexAttribPointer(o,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(o))}n.bindVertexArray(null)}}function te(t,e){if(null==t||null==e||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function ee(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function ne(t,e){var n=e[0],r=e[1],a=e[2],o=n*n+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function re(t,e,n){var r=e[0],a=e[1],o=e[2],i=n[0],s=n[1],c=n[2];return t[0]=a*c-o*s,t[1]=o*i-r*c,t[2]=r*s-a*i,t}function ae(t,e,n,r){var a=e[0],o=e[1],i=e[2];return t[0]=a+r*(n[0]-a),t[1]=o+r*(n[1]-o),t[2]=i+r*(n[2]-i),t}function oe(t,e,n){var r=e[0],a=e[1],o=e[2],i=n[3]*r+n[7]*a+n[11]*o+n[15];return i=i||1,t[0]=(n[0]*r+n[4]*a+n[8]*o+n[12])/i,t[1]=(n[1]*r+n[5]*a+n[9]*o+n[13])/i,t[2]=(n[2]*r+n[6]*a+n[10]*o+n[14])/i,t}var ie;ie=new ct(3),ct!=Float32Array&&(ie[0]=0,ie[1]=0,ie[2]=0);function se(){return new Array(3).fill(0)}function ce(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function ue(t){for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],r=t[e+1],a=t[e+2],o=1/Math.sqrt(n*n+r*r+a*a);t[e+0]*=o,t[e+1]*=o,t[e+2]*=o}}function le(t){const e=[];for(let n=0;n<t.length;n+=9){const r=se(),a=se(),o=se();r[0]=t[n],r[1]=t[n+1],r[2]=t[n+2],a[0]=t[n+3],a[1]=t[n+4],a[2]=t[n+5],o[0]=t[n+6],o[1]=t[n+7],o[2]=t[n+8];const i=se();ee(i,o,a);const s=se();ee(s,r,a);const c=se();re(c,i,s),ne(c,c),e.push(...c,...c,...c)}return e}const fe=Math.PI/180;function pe(t){return t*fe}const de=t=>({type:"point",position:[0,0,0],color:[1,1,1],intensity:3,cutoffDistance:5,decayExponent:1,...t,shader:xt("${declaration?\r\n`\r\n\r\nfloat pow4(const in float x) {\r\n    float x2 = x * x;\r\n    return x2 * x2;\r\n}\r\nfloat pow2(const in float x) {\r\n    return x * x;\r\n}\r\n\r\nfloat saturate(const in float a) {\r\n    return clamp(a, 0.0f, 1.0f);\r\n}\r\n\r\nstruct LightParams {\r\n    vec3 irradiance;\r\n    vec3 direction;\r\n    vec3 color;\r\n    float distance;\r\n};\r\n\r\nstruct PointLight {\r\n    vec3 position;\r\n    vec3 color;\r\n    float cutoffDistance;\r\n    float decayExponent;\r\n};\r\n\r\nlayout(std140) uniform PointLights {\r\n    PointLight pointLights[NUM_POINT_LIGHTS];\r\n};\r\n\r\nfloat getDistanceAttenuation(const in float lightDistance, const in float cutoffDistance, const in float decayExponent) {\r\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\r\n\t// page 32, equation 26: E[window1]\r\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\r\n    float distanceFalloff = 1.0f / max(pow(lightDistance, decayExponent), 0.01f);\r\n    if(cutoffDistance > 0.0f) {\r\n        distanceFalloff *= pow2(saturate(1.0f - pow4(lightDistance / cutoffDistance)));\r\n    }\r\n    return distanceFalloff;\r\n\r\n}\r\n\r\nLightParams getDirectDiffuse(const in PointLight pointLight,const in vec3 vertexPosition, const in vec3 normal,const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\r\n    LightParams lightParams = LightParams(vec3(0.0f), vec3(0.0f), vec3(0.0f), 0.0f);\r\n    vec3 lVector = pointLight.position - vertexPosition;\r\n    lightParams.distance = length(lVector);\r\n    lightParams.direction = normalize(lVector);\r\n    float dotNL = saturate(dot(normal, lightParams.direction));\r\n    lightParams.color = pointLight.color;\r\n    lightParams.color *= getDistanceAttenuation(lightParams.distance, pointLight.cutoffDistance, pointLight.decayExponent);\r\n    lightParams.irradiance = dotNL * lightParams.color;\r\n    \r\n    reflectedLight.directDiffuse += lightParams.irradiance * BRDF_Lambert(material.diffuseColor);\r\n    return lightParams;\r\n}\r\n\r\nfloat calculatePointLightBrightness(float lightDistance, float cutoffDistance, float decayExponent) {\r\n    return getDistanceAttenuation(lightDistance, cutoffDistance, decayExponent);\r\n}\r\n` : ''\r\n}\r\n${irradiance?\r\n`\r\n    vec3 irradiance = vec3(0.0f);\r\n    vec3 direction = vec3(0.0f);\r\n    for(int i = 0; i < NUM_POINT_LIGHTS; i++) {\r\n        PointLight pointLight = pointLights[i];\r\n        \r\n\r\n        LightParams lightParams = getDirectDiffuse(pointLight, vertex, normal, material, reflectedLight);\r\n        totalIrradiance += reflectedLight.directDiffuse;\r\n        ${specularIrradiance}\r\n    }\r\n` : ''\r\n}\r\n",{declaration:!1,irradiance:!1,specularIrradiance:""}),setupLights:be,updateOneLight:Me});let me=null;const he=t=>{me=t},ge=()=>me;function ve(t,e,n){e.preMultipliedColor=[...e.color],ce(e.preMultipliedColor,e.intensity),t[n]=e.position[0],t[n+1]=e.position[1],t[n+2]=e.position[2],t[n+4]=e.preMultipliedColor[0],t[n+5]=e.preMultipliedColor[1],t[n+6]=e.preMultipliedColor[2],t[n+7]=e.cutoffDistance,t[n+8]=e.decayExponent,t[n+9]=0,t[n+10]=0,t[n+11]=0,t[n+12]=0}function be(t){return function(){const{gl:e,program:n}=Ve;ge()||function(t){const{gl:e}=Ve,n=t.length,r=new Float32Array(12*n);for(let e=0;e<n;e++)ve(r,s(t[e]),12*e);const a=e.createBuffer();he(a),e.bindBufferBase(e.UNIFORM_BUFFER,St,a),e.bufferData(e.UNIFORM_BUFFER,r,e.DYNAMIC_DRAW)}(t);const r=e.getUniformBlockIndex(n,"PointLights");e.uniformBlockBinding(n,r,St)}}function Me(t,e){const{gl:n}=Ve,r=t.filter((t=>"point"===s(t).type)).findIndex((t=>t===e)),a=ge();if(-1!==r){const t=new Float32Array(12),o=12*r;ve(t,s(e),0),n.bindBuffer(n.UNIFORM_BUFFER,a),n.bufferSubData(n.UNIFORM_BUFFER,o*Float32Array.BYTES_PER_ELEMENT,t)}}const Ae=function(){const t=ot({position:[0,0,-1],target:[0,0,0],fov:80,near:.1,far:1e3,up:[0,1,0],matrix:null}),{subscribe:e,update:n}=t,r=ot(0);function a(t){n((e=>{const n={...e,...t(e)};return r.update((t=>t+1)),n}))}return{subscribe:e,set:function(t){a((e=>t))},update:a,get revision(){return s(r)}}}(),xe=function(){const t={canvas:null,loop:null,backgroundColor:16777215,ambientLightColor:[16777215,0],toneMappings:[],enabled:!1};let e=t,n=new Map;const r=ot(t),{subscribe:a,update:o}=r,i=ot(0);function c(t){o((r=>{const a=t(r);var o;if(i.update((t=>t+1)),null!=e.canvas&&a.canvas!==e.canvas&&a.canvas,null!=e.loop&&a.loop!==e.loop&&a.loop,a.backgroundColor!==e.backgroundColor&&(o=a.backgroundColor,n.set("backgroundColor",[...yt(o),1])),!te(a.ambientLightColor,e.ambientLightColor)){!function([t,e]){n.set("ambientLightColor",yt(t).map((t=>t*e)))}(a.ambientLightColor);const t=Re();t&&t.forEach((t=>{qt(Ve.programMap.get(t),n.get("ambientLightColor"))}))}return te(a.toneMappings,e.toneMappings)||a.toneMappings,a.enabled!==e.enabled&&a.enabled,e=a,a}))}return{subscribe:a,set:function(t){c((e=>t))},update:c,get processed(){const t=s(r);return Object.entries(t).map((([t,e])=>n.has(t)?[t,n.get(t)]:[t,e])).reduce(((t,[e,n])=>(t[e]=n,t)),{})},get revision(){return s(i)}}}();const ye=function(){const t=ot([]),e=ot(0),{subscribe:n,update:r}=t;function a(t){try{r((n=>{const r=t(n);return e.update((t=>t+1)),r}))}catch(t){console.log(t)}}return{subscribe:n,set:function(t){a((e=>t))},update:a,get revision(){return s(e)}}}(),Le=new Float32Array(16);function Re(){return s(Ue).filter((t=>0!==t.meshes?.length&&!0!==t.allMeshes))}ut(Le);const Ee=(t,e,n,r=NaN)=>{const{subscribe:a,set:o}=ot(n||Le);return{subscribe:a,set:n=>{o(n);const a=function(t){return s(Ue).find((e=>!0!==e.allMeshes&&e.meshes.includes(t)))}(t);isNaN(r)?function(t,e){const{gl:n,programMap:r}=Ve,a=r.get(t),o=n.getUniformLocation(a,"world");n.useProgram(a),n.uniformMatrix4fv(o,!1,e)}(a,n):Xt(a,t,n,r),e(s(xe))}}};function we(t){return null!=t.matrix?t.matrix=Ee(t,xe.set,t.matrix):null!=t.matrices&&(t.matrices=t.matrices.map(((e,n)=>Ee(t,xe.set,e,n)))),t}let Fe;const Pe=it([ye],(([t])=>{const e=t.filter((t=>null!=t.attributes));if(te(Fe,e))throw new Error("meshes unchanged");return Fe=e,e}));const _e=function(){const{subscribe:t,set:e}=ot([]);return{subscribe:t,set:t=>{e(t)}}}(),Se=it([_e],(([t])=>t.length)),Te=t=>{const{subscribe:e,set:n}=ot(t),r={subscribe:e,set:t=>{n(t),Me(s(_e),r),_e.set(s(_e)),xe.set(s(xe))}};return r},Be=ot([]);function $e(t){const{subscribe:e,set:n}=ot(t);return{subscribe:e,set:t=>{n(t),Ce.set(s(Ce))}}}const Ce=ot([]);function De(t){return t?.opacity<1||t?.transparent}function Ie(t,e){return(De(t.material)?1:-1)-(De(e.material)?1:-1)}function Ne(t){if(0===t.length||null==s(xe).canvas)return;let e=!1;const n=s(xe).canvas,{projection:r,view:a}=zt(s(Ae),n.width,n.height),o=lt([],r,a);t.forEach((t=>{(e||De(t.material))&&(e=!0,t.meshes.forEach(((t,e)=>{const n=gt([],t.matrix);t.clipSpacePosition=oe([],n,o)})),t.meshes=t.meshes.sort(((t,e)=>e.clipSpacePosition[2]-t.clipSpacePosition[2])))}));return t.sort(((t,e)=>null==t.material||null==e.material||null==t.meshes[0].clipSpacePosition||null==e.meshes[0].clipSpacePosition?0:e.meshes[0].clipSpacePosition[2]-t.meshes[0].clipSpacePosition[2]))}const Ue=it([Pe,Se,Ce,Be],(([t,e,n,r])=>{let a=r.filter((t=>t.order<0)).reduce(((t,e)=>t.concat(...e.programs)),[]).map((e=>({...e,updateProgram:[],...e.allMeshes?{meshes:t}:{}}))),o=Array.from(n);const i=new Set(t.filter((t=>t.instances>1||t.animations?.some((t=>"vertex"===t.type)))));o=o.reduce(((e,n)=>{const r=t.filter((t=>t.material===n)),{currentNormalMeshes:a,currentSpecialMeshes:o}=r.reduce(((t,e)=>(i.has(e)?t.currentSpecialMeshes.push(e):t.currentNormalMeshes.push(e),t)),{currentNormalMeshes:[],currentSpecialMeshes:[]});return a.length>0&&e.push({material:s(n),meshes:a}),o.forEach((t=>{const r=t.animations?.some((t=>t.requireTime));e.push({requireTime:r,material:s(n),meshes:[t]})})),e}),[]),o=o.sort(Ie),Ne(o);const c=e;let u;c>0&&(u=s(s(_e)[0]).shader);const l=[...a,...o.map(((t,e)=>{const n=0===e,r={...t,useProgram:kt,setupMaterial:[qt],updateProgram:[],bindTextures:[],createProgram:Ut,selectProgram:Ye};return function(t,e){const{programMap:n,vaoMap:r}=Ve;let a,o;if(n.forEach(((e,n)=>{n.material===t.material&&(a=n,o=e)})),null!=a){const t=r.get(a);null!=t&&(r.delete(a),r.set(e,t)),n.delete(a),n.set(e,o)}}(t,r),r.setupProgram=[jt(t.material,t.meshes,c,u),Ot,Yt],n&&(r.setFrameBuffer=Vt),t.material?.specular&&r.setupMaterial.push(t.material.specular.setupSpecular),t.material?.diffuseMap&&(r.setupMaterial.push(t.material.diffuseMap.setupTexture),r.bindTextures.push(t.material.diffuseMap.bindTexture)),t.material?.normalMap&&(r.setupMaterial.push(t.material.normalMap.setupTexture),r.bindTextures.push(t.material.normalMap.bindTexture)),t.material?.roughnessMap&&(r.setupMaterial.push(t.material.roughnessMap.setupTexture),r.bindTextures.push(t.material.roughnessMap.bindTexture)),t.requireTime&&r.updateProgram.push(Dt),r.setupMaterial.push(...Array.from(s(_e).reduce(((t,e)=>{const n=s(e);return t.has(n.setupLights)?t.set(n.setupLights,[...t.get(n.setupLights),e]):t.set(n.setupLights,[e]),t}),new Map)).map((([t,e])=>t(e)))),r}))];return function(t){const{programMap:e,vaoMap:n}=Ve;e.forEach(((r,a)=>{t.some((t=>t.material===a.material))||(e.delete(a),n.delete(a))})),t.forEach((t=>{let r;if(e.forEach(((e,n)=>{n.material===t.material&&(r=n)})),null!=r){const e=n.get(r);e.forEach(((n,r)=>{t.meshes.includes(r)||(console.log("delete mesh",r),e.delete(r))}))}}))}(l),l})),Oe=ot({init:!1});function Ye(t){return function(){const{programMap:e}=Ve,n=e.get(t);Ve.program=n}}function ke(t,e){return function(){const{vaoMap:n}=Ve,r=n.get(t).get(e);Ve.vao=r}}let Ve={programMap:new Map,vaoMap:new Map};const je=[],We=new Map;We.set(xe,0),We.set(ye,0),We.set(Ae,0);const qe=ot(0),ze=it([xe,Ue,ye,Ae,qe],(([t,e,n,r,a])=>{if(!t.enabled||4===a||1===a)return je;const o=function(){const t=new Set;return We.get(xe)!==xe.revision&&t.add(xe),We.get(ye)!==ye.revision&&t.add(ye),We.get(Ae)!==Ae.revision&&t.add(Ae),We.set(xe,xe.revision),We.set(ye,ye.revision),We.set(Ae,Ae.revision),t}();if(0===o.length)return je;const i=xe.processed;let c={canvas:t.canvas,backgroundColor:i.backgroundColor,ambientLightColor:i.ambientLightColor,...t.toneMappings.length>0?{toneMappings:t.toneMappings}:void 0};const u=[];Ve={...Ve,...c};s(Oe).init||u.push(Bt);const l=Ne(e);let f=!1;return u.push(Ct),u.push(...l.reduce(((t,e)=>(De(e.material)&&!f&&(f=!0,t.push($t)),[...t,...Ve.programMap.has(e)?[e.selectProgram(e),e.useProgram,...e.bindTextures,...e.updateProgram]:[e.createProgram(e),...e.setupProgram,e.useProgram,...e.setupMaterial,...e.updateProgram],...e.setupCamera?[e.setupCamera]:[...o.has(Ae)?[Gt(r)]:[]],...e.setFrameBuffer?[e.setFrameBuffer]:[],...e.meshes.reduce(((t,n)=>[...t,...Ve.vaoMap.has(e)&&Ve.vaoMap.get(e).has(n)?[ke(e,n),...null==n.instances?[Ht(e,n,n.matrix),Kt(e,n)]:[]]:[Zt(e,n),...e.material?[Wt(e.material)]:[],Ht(e,n,null==n.instances?n.matrix:n.matrices,n.instances),Kt(e,n,n.instances),...n.animations?.map((t=>t.setupAnimation))||[]],Nt,It(n,n.instances,n.drawMode)]),[]),...e.postDraw?[e.postDraw]:[]])),[])),u}),je);it([ze],(([t])=>{if(0===t.length)return 0;if(!s(Oe).init&&0===s(qe))return qe.set(1),t.forEach((t=>{t()})),Oe.set({init:!0}),qe.set(2),1;if(2===s(qe))return qe.set(3),requestAnimationFrame((async function t(){qe.set(4),s(xe).loop&&s(xe).loop(),qe.set(3),s(ze).forEach((t=>{t()})),qe.set(4),requestAnimationFrame(t)})),2})).subscribe((t=>{}));const Ge=8900331,He={0:"POINTS",1:"LINES",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN"};function Xe(t,e){let n,r;function a(e){let a="mousemove",o="mouseup",s=e;"touchstart"===e.type&&(a="touchmove",o="touchend",s=e.touches[0]),t.addEventListener(a,i,{passive:!1}),n=s.clientX,r=s.clientY,t.addEventListener(o,u,{passive:!1}),e.preventDefault(),e.stopPropagation()}function o(t,e){const n=Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2));return{radius:n,polar:Math.acos(Math.max(-1,Math.min(1,(t[1]-e[1])/n))),azimuth:Math.atan2(t[0]-e[0],t[2]-e[2])}}function i(t){let a=t;"touchmove"===t.type&&(a=t.touches[0]);const i=a.clientX-n,u=a.clientY-r,l=s(e),{position:f,target:p,fov:d}=l,{radius:m,polar:h,azimuth:g}=o(f,p),v=c(m,h-u/100,g-i/100);v[0]=v[0]+p[0],v[1]=v[1]+p[1],v[2]=v[2]+p[2],e.set({position:v,target:p,fov:d}),n=a.clientX,r=a.clientY}function c(t,e,n){const r=Math.sin(e)*t;return[r*Math.sin(n),Math.cos(e)*t,r*Math.cos(n)]}function u(e){let n="mousemove",r="mouseup";"touchend"===e.type&&(n="touchmove",r="touchend"),t.removeEventListener(n,i,{passive:!1}),t.removeEventListener(r,u,{passive:!1})}t.addEventListener("touchstart",a,{passive:!1}),t.addEventListener("mousedown",a,{passive:!1}),t.addEventListener("wheel",(function(t){const n=s(e),{position:r,target:a,fov:i}=n,{radius:u,polar:l,azimuth:f}=o(r,a),p=c(u+.001*t.deltaY*u,l,f);p[0]=p[0]+a[0],p[1]=p[1]+a[1],p[2]=p[2]+a[2],e.set({position:p,target:a,fov:i})}),{passive:!1})}function Ke(t){v(t,"svelte-7mcxv8","button.svelte-7mcxv8.svelte-7mcxv8{position:relative;font-family:Arial;font-size:20px;padding:10px}ul.svelte-7mcxv8.svelte-7mcxv8{position:relative;display:none;font-family:Arial;font-size:20px}li.svelte-7mcxv8.svelte-7mcxv8{padding:10px;background-color:white;width:fit-content}li.svelte-7mcxv8 a.svelte-7mcxv8{text-decoration:none;color:black}.menuOpened.svelte-7mcxv8.svelte-7mcxv8{display:block}.current.svelte-7mcxv8.svelte-7mcxv8{color:red}")}function Je(t,e,n){const r=t.slice();return r[3]=e[n],r}function Qe(e){let n,r,a,o=e[3].name+"";return{c(){n=x("li"),r=x("a"),a=y(o),w(r,"href",e[3].href),w(r,"class","svelte-7mcxv8"),w(n,"class","svelte-7mcxv8")},m(t,e){b(t,n,e),g(n,r),g(r,a)},p:t,d(t){t&&M(n)}}}function Ze(e){let n;return{c(){n=x("li"),n.textContent=`${e[3].name}`,w(n,"class","current svelte-7mcxv8")},m(t,e){b(t,n,e)},p:t,d(t){t&&M(n)}}}function tn(t){let e;let n=function(t,e){return window.location.pathname===t[3].href.substring(1)?Ze:Qe}(t),r=n(t);return{c(){r.c(),e=R()},m(t,n){r.m(t,n),b(t,e,n)},p(t,e){r.p(t,e)},d(t){t&&M(e),r.d(t)}}}function en(e){let n,r,a,o,i,s=J(e[2]),c=[];for(let t=0;t<s.length;t+=1)c[t]=tn(Je(e,s,t));return{c(){n=x("button"),n.textContent="examples",r=L(),a=x("ul");for(let t=0;t<c.length;t+=1)c[t].c();w(n,"class","svelte-7mcxv8"),w(a,"class","svelte-7mcxv8"),P(a,"menuOpened",e[0])},m(t,s){b(t,n,s),b(t,r,s),b(t,a,s);for(let t=0;t<c.length;t+=1)c[t]&&c[t].m(a,null);o||(i=E(n,"click",e[1]),o=!0)},p(t,[e]){if(4&e){let n;for(s=J(t[2]),n=0;n<s.length;n+=1){const r=Je(t,s,n);c[n]?c[n].p(r,e):(c[n]=tn(r),c[n].c(),c[n].m(a,null))}for(;n<c.length;n+=1)c[n].d(1);c.length=s.length}1&e&&P(a,"menuOpened",t[0])},i:t,o:t,d(t){t&&(M(n),M(r),M(a)),A(c,t),o=!1,i()}}}function nn(t,e,n){let r=!1;return[r,function(){console.log("toggleMenu",r),n(0,r=!r)},[{name:"Normal map and specular",href:"./golf-ball"},{name:"GLTF loader",href:"./"},{name:"Obj loader",href:"./venus"},{name:"Cube",href:"./cube"},{name:"GLTF",href:"./gltf"},{name:"Contact Shadow",href:"./contact-shadow"},{name:"Transparency",href:"./transparency"},{name:"Instances",href:"./instances"},{name:"Matrix",href:"./matrix"},{name:"Texture",href:"./texture"},{name:"Lights",href:"./lights"},{name:"Vertex Animation",href:"./vertex-anim"},{name:"Scene Update",href:"./scene-update"}]]}class rn extends rt{constructor(t){super(),nt(this,t,nn,en,o,{},Ke)}}export{pe as $,Te as A,de as B,we as C,Xe as D,D as E,He as F,re as G,ee as H,ne as I,mt as J,Ve as K,gt as L,rn as M,Mt as N,At as O,Ot as P,Yt as Q,kt as R,rt as S,Ye as T,lt as U,vt as V,Ce as W,$e as X,le as Y,s as Z,dt as _,L as a,ct as a0,se as a1,ae as a2,ce as a3,ue as a4,xt as a5,v as a6,w as a7,E as a8,r as a9,u as aa,g as ab,p as ac,d as ad,f as ae,y as af,F as ag,$ as ah,m as ai,wt as aj,Et as ak,Ft as al,J as am,R as an,G as ao,H as ap,A as aq,Pt as ar,_t as as,Pe as at,P as au,b,Q as c,K as d,x as e,M as f,tt as g,c as h,nt as i,ye as j,Ae as k,_e as l,Z as m,t as n,B as o,Be as p,oe as q,xe as r,o as s,X as t,ht as u,pt as v,ft as w,ut as x,h as y,Ge as z};
